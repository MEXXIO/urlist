(function(exports){"use strict";var ul={},protect=[];function register(key,obj){var tokens=key.split("."),last=ul,token;if(_.indexOf(protect,tokens[0])!=-1)throw"Trying to override core function, abort";for(var i=0;i<tokens.length;i++){token=tokens[i];if(i==tokens.length-1){if(last[token]!==undefined){console.warning("Override {0} with".format(key),obj)}last[token]=obj}else if(last[token]===undefined){last[token]={}}last=last[token]}}register("register",register);for(var registered in ul)protect.push(registered);exports.ul=ul})(typeof exports==="undefined"?this:exports);(function(){"use strict";var Ticker=function(options){this.options=options;this.buffer=[];this.intervalId=null};_.extend(Ticker.prototype,Backbone.Events,{push:function(data){this.last=Date.now();this.buffer.push(data);if(!this.intervalId)this.intervalId=setInterval(_.bind(this.check,this),this.options.threshold/2)},check:function(){if(Date.now()-this.last<this.options.threshold)return;clearInterval(this.intervalId);this.intervalId=null;this.flush()},flush:function(){this.trigger("flush",this.buffer);this.buffer=[]}});ul.register("Ticker",Ticker)})();(function(){var Model=Backbone.Model.extend({inc:function(key,val,options){if(typeof val==="undefined")val=1;return this.set(key,this.get(key)+val,options)},update:function(key,func,options){return this.set(key,func(this.get(key)),options)},isReady:function(){throw"isReady is not defined in your Model extension"},whenReady:function(){var that=this;if(this._deferred)return this._deferred;this._deferred=$.Deferred();if(this.isReady()){this._deferred.resolve()}else{this.fetch({success:function(){that._deferred.resolve()},error:function(){console.error("Error loading resource.",that.url(),that);that._deferred.reject()}})}return this._deferred}});ul.register("bbext.Model",Model)})();(function(){var View=Backbone.View.extend({initialize:function(){this.template=this.options.template},render:function(){if(this.model){this.$el.html(this.template(this.model.toJSON()))}else{this.$el.html(this.template())}return this.$el},_unbindMe:function(){},unbindMe:function(){this._unbindMe();this.undelegateEvents();this.$el.removeData().unbind();this.$el.remove();this.stopListening()}});ul.register("bbext.View",View)})();(function(){var Collection=Backbone.Collection;Collection.prototype.move=function(model,toIndex){var fromIndex=this.indexOf(model);if(fromIndex==-1)throw new Error("Can't move a model that's not in the collection");if(fromIndex!==toIndex)this.models.splice(toIndex,0,this.models.splice(fromIndex,1)[0]);this.trigger("move")};ul.register("bbext.Collection",Collection)})();(function(){var calculated_extras={calculated:function(func,key,context){if(context)func=_.bind(func,context);this.calculatedAttributes||(this.calculatedAttributes={});this.calculatedAttributes[key]=func},toJSON:function(options){options||(options={});var json=Backbone.Model.prototype.toJSON.call(this);if(options.calculated)for(var k in this.calculatedAttributes)try{json[k]=this.calculatedAttributes[k]()}catch(e){}return json}};_.extend(ul.bbext.Model.prototype,calculated_extras)})();(function(){var mbMessageMap={id:0,action:1,target:2,payload:3},sync=Backbone.sync,ticker=new ul.Ticker({threshold:100});Backbone.mbHyperDriveSync=function(method,model,options){var deferred=$.Deferred();if(options.success)deferred.done(options.success);if(options.error)deferred.fail(options.error);deferred.done(function(resp,status,xhr){model.trigger("sync",model,resp,options)});deferred.fail(function(xhr,status,thrown){model.trigger("error",model,xhr,options)});ticker.push([method,model,deferred]);return deferred};ticker.on("flush",function(buffer){var messages=[],deferredMap={};for(var i=0;i<buffer.length;i++){var target={},model=buffer[i][1],deferred=buffer[i][2],user_id=C.get("user").get("is_anonymous")?"anonymous":C.get("user").get("user_id"),id=[user_id,model.mbAction,model.id].join(":");if(deferredMap[id]===undefined){target[model.mbKey]=model.id;messages.push([id,model.mbAction,target,{},{}]);deferredMap[id]=deferred}else{if(!_.isArray(deferredMap[id]))deferredMap[id]=[deferredMap[id]];deferredMap[id].push(deferred)}}$.ajax({url:API_ROOT+"hyperdrive",type:"POST",data:JSON.stringify(messages),contentType:"application/json",dataType:"json",xhrFields:{withCredentials:true}}).done(function(resp,status,xhr){for(var i=0;i<resp.length;i++){var message=resp[i],isError=message[mbMessageMap.action]=="Exception"||message[mbMessageMap.action]=="OperationalError",data=message[mbMessageMap.payload],id=message[mbMessageMap.id],deferred=deferredMap[id];if(isError)console.error("hyperdrive",message[mbMessageMap.payload]);if(_.isArray(deferred))_.each(deferred,function(d){if(isError)d.reject(xhr,status,data);else d.resolve(data,status,xhr)});else{if(isError)deferred.reject(xhr,status,data);else deferred.resolve(data,status,xhr)}}}).fail(function(xhr,status,thrown){console.log("FAIL HyperDrive sync",arguments);_.each(deferredMap,function(deferred){deferred.reject(xhr,status,"Server error")})})});Backbone.mbSync=function(method,model,options){var deferred=$.Deferred();if(options.success)deferred.done(options.success);if(options.error)deferred.fail(options.error);deferred.done(function(resp,status,xhr){model.trigger("sync",model,resp,options)});deferred.fail(function(xhr,status,thrown){model.trigger("error",model,xhr,options)});var target={};target[model.mbKey]=model.id;$.ajax({url:API_ROOT+"motherbrain",type:"POST",data:JSON.stringify([uuid(),model.mbAction,target,{},{}]),contentType:"application/json",dataType:"json",xhrFields:{withCredentials:true}}).done(function(resp,status,xhr){deferred.resolve.call(this,resp[mbMessageMap.payload],status,xhr)}).fail(function(){deferred.reject.apply(this,arguments)});return deferred};Backbone.sync=function(method,model,options){if(method=="delete")return;if(method=="read"&&model.mbFetch===true&&UL.config.hyperdrive.boost){return Backbone.mbHyperDriveSync(method,model,options)}else{return sync(method,model,options)}}})();(function(){"use strict";ul.register("dialog.login",function(options){options||(options={closeOnOverlay:true});var dialog=new view.dialog.LoginModal(options);dialog.render()});ul.register("dialog.signup",function(options){options||(options={closeOnOverlay:true});var dialog=new view.dialog.SignupModal(options);dialog.render()});ul.register("dialog.signupContinue",function(options){options||(options={closeOnOverlay:true});options.beta=true;var dialog=new view.dialog.SignupModal(options);dialog.render()});ul.register("dialog.requireLogin",function(options){if(C.get("user").get("is_anonymous")){ul.dialog.login(options);return true}});ul.register("dialog.requireSignup",function(options){if(C.get("user").get("is_anonymous")){ul.dialog.signup(options);return true}})})(typeof exports==="undefined"?this:exports);(function(){"use strict";ul.register("util.kato",function(sourceArray,parentKey,childKey){var toObject=function(array){var hashes=[];if(!array)return hashes;for(var i=0;i<array.length;i=i+1){if(array[i]!==undefined){var tempHash={};tempHash[childKey]=array[i];hashes.push(tempHash)}}return hashes};var output={};if(!!sourceArray[parentKey]){output[parentKey]=toObject(sourceArray[parentKey])}else{output[parentKey]=toObject(sourceArray.lists)}return output});ul.register("util.t",function(name){return TEMPLATES[name]});ul.register("util.getCurrentProfile",function(){var tempModel=C.get("user");var profileModel=new model.Profile({username:tempModel.get("username")});return profileModel});ul.register("util.prettydate",function(dt,verbose){var date=new Date(dt).getTime(),now=(new Date).getTime(),offset=(now-date)/1e3,unit="s",other={s:"seconds ago",m:"minutes ago",h:"hours ago",d:"days ago"};if(offset>60){offset/=60;unit="m";if(offset>60){offset/=60;unit="h";if(offset>24){offset/=24;unit="d";if(offset>60){offset=null}}}}if(offset)return"{0}{1}".format(parseInt(offset),verbose?" "+other[unit]:unit);else return"time"})})(typeof exports==="undefined"?this:exports);if(!Date.now){Date.now=function(){return(new Date).valueOf()}}function uuid(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c=="x"?r:r&3|8;return v.toString(16)})}String.prototype.format=function(){var formatted=this;for(var i=0;i<arguments.length;i++){var regexp=new RegExp("\\{"+i+"\\}","gi");formatted=formatted.replace(regexp,arguments[i])}return formatted};String.prototype.toTitleCase=function(){return this.replace(/\w\S*/g,function(txt){return txt.charAt(0).toUpperCase()+txt.substr(1).toLowerCase()})};String.prototype.crop=function(len){if(this.length>len)return this.substr(0,len)+"…";else return this};Date.prototype.toUTCISOString=function(){return JSON.parse(JSON.stringify(new Date))};Date.prototype.getCohort=function(){var d,yearStart,weekNo,quarter;d=new Date(this);d.setHours(0,0,0);d.setDate(d.getDate()+4-(d.getDay()||7));yearStart=new Date(d.getFullYear(),0,1);weekNo=Math.ceil(((d-yearStart)/864e5+1)/7);weekNo=weekNo<10?"0"+weekNo:""+weekNo;quarter=parseInt(d.getMonth()/3)+1;return"{0}{1}".format(d.getFullYear(),weekNo)};function isEmail(s){return s.split("@").length==2&&s.split(".").length>1}function getURLParameter(url,name,fallback){fallback=fallback===undefined?null:fallback;var param,parser;switch(typeof fallback){case"boolean":parser=function(v){return v==="true"};break;case"number":parser=function(v){return parseInt(v)};break;default:parser=function(v){return v}}param=decodeURIComponent((new RegExp("[?|&]"+name+"="+"([^&;]+?)(&|#|;|$)").exec(url)||["",""])[1].replace(/\+/g,"%20"));if(parser&&param.length>0)return parser(param);return fallback}function getLocationParameter(name,fallback){return getURLParameter(location.search,name,fallback)}function setDocumentTitle(title){var regex=/^(\().+?(\)) /g,prefix=document.title.match(regex),title=title;if(prefix){title=prefix+title}$(document).attr("title",title+" — Urlist")}function setNotifCountDocumentTitle(n){var title=document.title,regex=/^(\().+?(\)) /g,replaced=title.search(regex)>=0,nTmpl="";if(n>0){if(n>9){nTmpl="(9+) "}else{nTmpl="("+n+") "}}if(replaced){title=title.replace(regex,nTmpl)}else{title=nTmpl+title}document.title=title}function slugify(val,prefix){prefix||(prefix="");if(val){val=$.trim(val);if(prefix)val=prefix+" "+val;return val.toLowerCase().replace(/[^\w ]+/g,"").replace(/ +/g,"-")}}function normalizeUrl(url){var relative;url=$.trim(url);if(!url.match(/^.*:\/\/.+/))url="http://"+url;relative=parseUri(url).relative;if(!relative)url=url+"/";return url}function deleteAllCookies(){var cookies=document.cookie.split(";");for(var i=0;i<cookies.length;i++){var cookie=cookies[i];var eqPos=cookie.indexOf("=");var name=eqPos>-1?cookie.substr(0,eqPos):cookie;document.cookie=name+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT; domain=.urli.st"}}function isScrolledIntoView(elem){var docViewTop=$(window).scrollTop();var docViewBottom=docViewTop+$(window).height();var elemTop=$(elem).offset().top;var elemBottom=elemTop+$(elem).height();return elemBottom>=docViewTop&&elemTop<=docViewBottom&&elemBottom<=docViewBottom&&elemTop>=docViewTop}function addParamToUrl(fullurl,key,val){var tokens=fullurl.split("#"),url=tokens[0],fragment=tokens[1];if(url.indexOf("?")==-1){url="{0}?{1}={2}".format(url,key,val)}else{url="{0}&{1}={2}".format(url,key,val)}if(fragment)url=[url,fragment].join("#");return url}(function(w){var _deltaMillis;var _serverDate;var ULDate=function(s,parse){this.raw=s;if(parse)this.parse(s)};ULDate.sync=function(){_deltaMillis=(new Date).getTimezoneOffset()*6e4;$.getJSON(API_ROOT+"datetime").done(function(s){var oldDelta=_deltaMillis,serverDate=new ULDate(s.now),delta=(new Date).getTime()-serverDate.getTime();console.log("Delta is",delta);_serverDate=serverDate;_deltaMillis=delta})};ULDate.prototype.getTime=function(){if(!this.date)this.parse();return this.date.getTime()};ULDate.prototype.parse=function(s){var i,tokens,parsed;this.raw=s||this.raw;for(i=0,tokens=this.raw.split(/[-T:.]/),parsed=[0,0,0,0,0,0];i<Math.min(tokens.length,parsed.length);parsed[i]=parseInt(tokens[i]),i++);this.date=new Date(parsed[0],parsed[1]-1,parsed[2],parsed[3],parsed[4],parsed[5])};ULDate.prototype.getDelta=function(uldate){date=uldate||new ULDate;var delta=this.getTime()-date.getTime()+_deltaMillis;return parseInt(delta/1e3)};w.ULDate=ULDate})(window);var UL={config:{hyperdrive:{}},tests:{utils:{}}},main={},mustacheTemplate={},view={urlist:{},utils:{},dialog:{},discovery:{},dashboard:{},widget:{},navigation:{},suggestion:{},message:{},search:{}},model={},collection={urlists:{}},embed={},router={},testdata={},actions={},policies={},helpers={};var API_ROOT=API_ROOT||"",C=new ul.bbext.Model;function T(name){console.error("Using deprecated function T. Use ul.util.t");return TEMPLATES[name]}$.ajaxSetup({xhrFields:{withCredentials:true}});UL.config.origin=window.location.protocol+"//"+window.location.host;UL.config.sections_limit=12;UL.CATEGORIES={"51837d3e1caceef887c30478":{position:0,label:"Information & Media",slug:"information-media"},"51837d3e1caceef887c30476":{position:1,label:"Education",slug:"education"},"51837d3e1caceef887c3047c":{position:2,label:"Society & Politics",slug:"society-politics"},"51837d3e1caceef887c30479":{position:3,label:"Business",slug:"business"},"51837d3e1caceef887c3047d":{position:4,label:"Passions & Hobbies",slug:"passions-hobbies"},"51837d3e1caceef887c3047b":{position:5,label:"Cooking",slug:"cooking"},"51837d3e1caceef887c3047e":{position:6,label:"Culture & Arts",slug:"culture-arts"},"51837d3e1caceef887c30477":{position:7,label:"Science & Nature",slug:"science-nature"},"51837d3e1caceef887c3047a":{position:8,label:"Activism",slug:"activism"},"51837d3e1caceef887c30475":{position:9,label:"Technology",slug:"technology"},"51837d3e1caceef887c3047f":{position:10,label:"Controversial",slug:"controversial"},"520900d3ed92b7ad01e9ab5b":{position:11,label:"Places",slug:"places"}};UL.ORDERED_CATEGORIES=_.chain(UL.CATEGORIES).map(function(v,k){v.id=k;return v}).sortBy("position").value();if(window.location.hash=="#_=_")window.location.hash="";(function(){_.get=function(obj,key,missing){var keys=key.split("."),current=obj;for(var i=0;i<keys.length;i++){try{current=current[keys[i]]}catch(e){current=undefined;break}}return current==null?missing:current};_.purge=function(obj,what){var cleaned={};for(var key in obj)obj[key]!==what&&(cleaned[key]=obj[key]);return cleaned}})();(function(){UL.DialogStack=[];UL.DialogStack.cleanAll=function(){_.each(_.clone(UL.DialogStack).reverse(),function(dialog){dialog.unbindAll()})};Backbone.Dialog=ul.bbext.View.extend({events:function(){var base={"click .js-dialog-close":"_cancel","click .js-cancel":"_cancel","submit form":"_submit","keydown textarea":"checkSubmit","keyup textarea[data-count='chars']":"countChars","click .js-simple-textarea":"growTextarea","click .js-for-clipboard":"selectForClipboard"};if(this.options.closeOnOverlay!==false)_.extend(base,{"click .dialog-centering":"overlayCallback"});if(this.options.closeOnKey!==false)_.extend(base,{"keyup .dialog-wrapper":"unbindAllByKey"});return _.extend(base,this.subevents)},subinitialize:function(){},initialize:function(){this.template=this.options.template||this.template;this.dialogTemplate=ul.util.t("utils/dialog");this.subinitialize()},getSource:function(){if(!this.options.sourceEvent)return{};return this.options.sourceEvent.getSource()},subrender:function(){if(this.model&&this.model.toJSON)return $(this.template(this.model.toJSON({calculated:true})));else return $(this.template())},render:function(){ul.view.util.clearMessages();if(this.options.standalone)UL.DialogStack.cleanAll();this.$el.html(this.dialogTemplate({dialog_class:this.dialogClass,is_wizard:this.options.isWizard}));$("#urlist-content").append(this.$el).addClass("dialog-placing");this.$(".js-dialog--hook").append(this.subrender());if(this.options.skipAnimation){this.$(".dialog-centering, .dialog-wrapper").addClass("dialog-animation--skip")}this.$(".dialog-wrapper").attr("tabindex","1").focus();this.documentScript();this.afterRender();UL.DialogStack.push(this);return this.$el},unbindAll:function(e){if(typeof e!=="undefined"&&typeof e.preventDefault=="function")e.preventDefault();this.trigger("close");UL.DialogStack.pop();if(UL.DialogStack.length==0)$("body").removeClass("dialog-placing");this.unbindMe()},unbindAllByKey:function(e){if(e.keyCode==27)this._cancel()},submit:function(e){if(this.options.submit)this.options.submit(e)},afterRender:function(){this.$(".dialog-centering").scrollTop(0)},cancel:function(){},_submit:function(e){this.trigger("submit");this.submit(e)!==false&&this.unbindAll();return false},overlayCallback:function(e){if($(e.target).is(".dialog-centering")){this._cancel()}},_cancel:function(){if(this.options.onlySubmit===true)return;this.trigger("cancel");this.cancel()!==false&&this.unbindAll();return false},toggleActions:function(active){this.$(".js-cancel").toggleClass("inactive",!active);this.$("[type='submit']").toggleClass("inactive",!active)},documentScript:function(){},growTextarea:function(e){var t=$(e.target),h=t.height(),d=70;t.height(h+d).removeClass("js-simple-textarea")},selectForClipboard:function(e){$(e.target).select()},checkSubmit:function(e){if(e.ctrlKey&&e.keyCode==13){this._submit()}},countChars:function(e){var $me=$(e.target),limitChars=parseInt($me.attr("data-count-limit")),usedChars=$me.val().length,totChars=limitChars-usedChars,charsCounter=$("#"+$me.attr("rel"));charsCounter.html(totChars);if(totChars<0){charsCounter.addClass("alert-text");this.$("input[type='submit']").addClass("inactive")}else{charsCounter.removeClass("alert-text");this.$("input[type='submit']").removeClass("inactive")}}})})();Handlebars.registerHelper("hostify",function(val){var parsed=parseUri(val);return parsed.host.replace(/^www\./,"")});Handlebars.registerHelper("highlight",function(terms,text){var safeText=Handlebars.Utils.escapeExpression(text);for(var i=0,term=terms[0];i<terms.length;term=terms[++i])safeText=safeText.replace(new RegExp("({0}\\w*)".format(term),"gi"),"<span class='highlight'>$1</span>");return new Handlebars.SafeString(safeText)});Handlebars.registerHelper("onoff",function(val,comp,what){return val?"on":"off"});Handlebars.registerHelper("prettydate",function(val){return ul.util.prettydate(val,true)});Handlebars.registerHelper("slugify",function(val){return slugify(val)});Handlebars.registerHelper("decodeURIComponent",function(val){return decodeURIComponent(val)});Handlebars.registerHelper("titlecase",function(val){return val.toTitleCase()});Handlebars.registerHelper("toLowerCase",function(val){return!!val&&typeof val==="string"?val.toLowerCase():""});Handlebars.registerHelper("normalizeUrl",function(val){return normalizeUrl(val)});Handlebars.registerHelper("or",function(val,alternative){return val?val:alternative});Handlebars.registerHelper("show-if",function(val){if(!val){return"hide"}});Handlebars.registerHelper("if-equal",function(a,b,options){return a==b?options.fn(this):options.inverse(this)});Handlebars.registerHelper("if-not-equal",function(a,b,options){return a!=b?options.fn(this):options.inverse(this)});Handlebars.registerHelper("hide-if",function(a,b){if(b===undefined){if(a)return"hide"}else if(a==b){return"hide"}});Handlebars.registerHelper("hide-if-gt",function(a,b){if(b===undefined){if(a)return"hide"}else if(a>b){return"hide"}});Handlebars.registerHelper("len",function(val){if(val)return val.length});Handlebars.registerHelper("crop",function(val,length){if(val)return val.crop(length)});Handlebars.registerHelper("if-length-gt",function(val,length,options){return val&&val.length>length?options.fn(this):options.inverse(this)});Handlebars.registerHelper("appendiftrue",function(val,what){if(val){return what}});Handlebars.registerHelper("appendiffalse",function(val,what){if(!val){return what}});Handlebars.registerHelper("appendif",function(val,comp,what){if(val==comp){return what}});Handlebars.registerHelper("appendifnot",function(val,comp,what){if(val!=comp){return what}});Handlebars.registerHelper("selectedif",function(val,comp){if(val==comp){return"selected"}});Handlebars.registerHelper("checkedifeq",function(value,comp){if(_.isArray(value))return _.any(_.map(value,function(v){return v==comp}))?"checked":"";if(value==comp)return"checked"});Handlebars.registerHelper("checkediffalse",function(value){if(!value)return"checked"});Handlebars.registerHelper("checkedif",function(value){if(value)return"checked"});Handlebars.registerHelper("pluralize",function(amount,singular){if(singular==="link"&&amount===1){return"link"}else if(singular==="link"){return"links"}});Handlebars.registerHelper("plural",function(value){if(value==0||value>1)return"s"});Handlebars.registerHelper("randomize",function(options){var options=options||0,number=Math.floor(Math.random()*options)+1;return"randomize-"+number});Handlebars.registerHelper("CURRENT",function(model,attribute){return C.get(model).get(attribute)});Handlebars.registerHelper("IF-NEWBIE",function(options){return C.get("user").getMyListsCount()==1?options.fn(this):options.inverse(this)});Handlebars.registerHelper("IF-ADMIN",function(options){return C.get("user").get("__notrack")?options.fn(this):options.inverse(this)});Handlebars.registerHelper("LOGGED",function(options){return!C.get("user").get("is_anonymous")?options.fn(this):options.inverse(this)});Handlebars.registerHelper("ANON",function(options){return C.get("user").get("is_anonymous")?options.fn(this):options.inverse(this)});Handlebars.registerHelper("NOT-LOGGED",function(options){return C.get("user").get("is_anonymous")?options.fn(this):options.inverse(this)});Handlebars.registerHelper("A-GROUP",function(options){return C.get("user").ABGroup()=="A"?options.fn(this):options.inverse(this)});Handlebars.registerHelper("B-GROUP",function(options){return C.get("user").ABGroup()=="B"?options.fn(this):options.inverse(this)});Handlebars.registerHelper("ENABLED",function(permissions,options){var has=C.get("user").get("__permissions")||[],req=permissions.split(","),adm=C.get("user").get("__notrack"),can=_.some(_.map(has,function(h){return req.indexOf(h)!=-1}));return can||adm?options.fn(this):options.inverse(this)});(function(){_.extend(jQuery.Event.prototype,{getSource:function(){var source=$(this.target).closest("[data-source]").attr("data-source");if(source)return{source:source};else return{}}})})();(function(){var NavigationExtras=function(){this.lastExtras=null};_.extend(NavigationExtras.prototype,Backbone.Events,{push:function(extras){this.lastExtras=extras},pop:function(){var extras=this.lastExtras;this.lastExtras=null;return extras}});UL.EventOriginator=new NavigationExtras})();function mdma(text,parseHashtags){var escape={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};var badChars=/[&<>"'`]/g;var possible=/[&<>"'`]/;var escapeChar=function(chr){return escape[chr]||"&amp;"};function safe(text){if(text==null||text===false)return"";if(!possible.test(text))return text;return text.replace(badChars,escapeChar)}function detab(text){if(!/\t/.test(text))return text;var spaces=["    ","   ","  "," "],skew=0,v;return text.replace(/[\n\t]/g,function(match,offset){if(match==="\n"){skew=offset+1;return match}v=(offset-skew)%4;skew=offset+1;return spaces[v]})}function attributeEncode(text){return text.replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")}function doAnchors(text){text=text.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,writeAnchorTag);text=text.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\]\([ \t]*()<?((?:\([^)]*\)|[^()\s])*?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,writeAnchorTag);text=text.replace(/(\[([^\[\]]+)\])()()()()()/g,writeAnchorTag);return text}var _problemUrlChars=/(?:["'*()[\]:]|~D)/g;function encodeProblemUrlChars(url){if(!url)return"";var len=url.length;return url.replace(_problemUrlChars,function(match,offset){if(match=="~D")return"%24";if(match==":"){if(offset==len-1||/[0-9\/]/.test(url.charAt(offset+1)))return":"}return"%"+match.charCodeAt(0).toString(16)})}function escapeCharacters(text,charsToEscape,afterBackslash){var regexString="(["+charsToEscape.replace(/([\[\]\\])/g,"\\$1")+"])";if(afterBackslash){regexString="\\\\"+regexString}var regex=new RegExp(regexString,"g");text=text.replace(regex,escapeCharacters_callback);return text}function escapeCharacters_callback(wholeMatch,m1){var charCodeToEscape=m1.charCodeAt(0);return"~E"+charCodeToEscape+"E"}function writeAnchorTag(wholeMatch,m1,m2,m3,m4,m5,m6,m7){if(m7==undefined)m7="";var whole_match=m1;var link_text=m2.replace(/:\/\//g,"~P");var link_id=m3.toLowerCase();var url=m4;var title=m7;if(url==""){if(link_id==""){link_id=link_text.toLowerCase().replace(/ ?\n/g," ")}url="#"+link_id;if(whole_match.search(/\(\s*\)$/m)>-1){url=""}else{return whole_match}}url=escapeCharacters(url,"*_");var result;if(url.substring(0,1)=="/"){result='<a class="js-navigate" href="'+url+'"'}else{result='<a target="_blank" href="'+url+'"'}if(title!=""){title=attributeEncode(title);title=escapeCharacters(title,"*_");result+=' title="'+title+'"'}result+=">"+link_text+"</a>";return result}text=safe(text);text=text.replace(/~/g,"~T");text=text.replace(/\$/g,"~D");text="\n\n"+text+"\n\n";text=detab(text);text=text.replace(/^[ \t]+$/gm,"");text=text.replace(/([\W_]|^)(\*\*|__)(?=\S)([^\r]*?\S[\*_]*)\2([\W_]|$)/g,"$1<em>$3</em>$4");text=text.replace(/([\W_]|^)(\*|_)(?=\S)([^\r\*_]*?\S)\2([\W_]|$)/g,"$1<strong>$3</strong>$4");text=doAnchors(text);text=text.replace(/(^|\s)(https?|ftp)(:\/\/[-A-Z0-9+&@#\/%?=~_|\[\]\(\)!:,\.;]*[-A-Z0-9+&@#\/%=~_|\[\]])($|\W)/gi,"$1<$2$3>$4");var replacer=function(wholematch,m1){return'<a href="'+m1+'">'+m1+"</a>"};var hashtag=function(wholematch,m1){return"<a class='js-navigate' href=\"/hashtag/"+m1.toLowerCase()+'">#'+m1+"</a>"};text=text.replace(/<((https?|ftp):[^'">\s]+)>/gi,replacer);if(parseHashtags){text=text.replace(/#(\w+)/gi,hashtag)}text=text.slice(2,-2);text=text.replace(/~D/g,"$$");text=text.replace(/~T/g,"~");return text}(function(){function deferredWrapper(template,data){var deferred=$.Deferred();return deferred}UL.Embed=function(json){var url=json.url,host=parseUri(url).host.replace(/^www\./,"").replace(/\./,""),deferred;try{for(var e in embed)if(host.indexOf(e)!=-1){return embed[e](json)}}catch(exc){console.error("Error embeddig resource",url,exc)}deferred=$.Deferred();if(json.embed_handler=="unsupported")deferred.resolve(ul.util.t("embed/__not_embeddable")(json));else deferred.resolve(ul.util.t("embed/iframe")(json));return deferred};_.extend(embed,{vimeo:function(data){var r=/https?:\/\/(?:www\.)?vimeo.com\/(?:channels\/|groups\/([^\/]*)\/videos\/|album\/(\d+)\/video\/|)(\d+)(?:$|\/|\?|#)/;m=r.exec(data.url),deferred=$.Deferred();data=_.extend(data,{video_id:m[3]});deferred.resolve(ul.util.t("embed/vimeo")(data));return deferred},youtube:function(data){var getStart=function(url){var match=/(\d+)m(\d+)s/.exec(getURLParameter(data.url,"t"));if(match){return parseInt(match[1])*60+parseInt(match[2])}return 0},r=/(v=|\/)([\w-]+)(&.+)?$/,m=r.exec(data.url),deferred=$.Deferred(),data=_.extend(data,{video_id:m[2],start:getStart(data.url)});deferred.resolve(ul.util.t("embed/youtube")(data));return deferred},soundcloud:function(data){var deferred=$.Deferred(),endpoint="http://soundcloud.com/oembed?url={0}&format=js".format(encodeURIComponent(data.url));$.ajax({url:endpoint,dataType:"jsonp",timeout:3e3}).done(function(soundcloudData){data=_.extend(data,soundcloudData);deferred.resolve(ul.util.t("embed/soundcloud")(data))}).fail(function(){deferred.resolve(ul.util.t("embed/__not_embeddable")(data))});return deferred},amazon:function(data){var target="{0}/embed?url={1}".format(API_ROOT,encodeURIComponent(data.url)),deferred=$.Deferred();$.ajax({url:target,dataType:"json"}).done(function(remote){remote.formatted_author=remote.authors.join(", ");data.remote=remote;deferred.resolve(ul.util.t("embed/amazon")(data))}).fail(function(){deferred.reject()});return deferred}})})();function openWindow(url,width,height){width=width?width:550;height=height?height:420;var windowOptions="scrollbars=no,resizable=yes,toolbar=no,location=yes",winHeight=screen.height,winWidth=screen.width,left,top;left=Math.round(winWidth/2-width/2);top=0;if(winHeight>height){top=Math.round(winHeight/2-height/2)}window.open(url,"popup",windowOptions+",width="+width+",height="+height+",left="+left+",top="+top)}function twitterShare(text){var base="https://twitter.com/intent/tweet";base+="?text="+encodeURIComponent(text);base+="&hashtags=urlist";base+="&related=urlist";openWindow(base)}function googleShare(url){var base="https://plus.google.com/share";base+="?url="+encodeURIComponent(url);openWindow(base)}function facebookShare(url){var base="https://www.facebook.com/sharer/sharer.php";base+="?u="+encodeURIComponent(url);openWindow(base,640,352)}(function(){actions.Action=function(broker,options){this.broker=broker;this.options=options};_.extend(actions.Action.prototype,Backbone.Events,{bindToBroker:function(){for(var e in this.events)this.listenTo(this.broker,e,this[this.events[e]])}});actions.Action.extend=Backbone.View.extend})();(function(){var mbMessageMap={id:0,action:1,target:2,payload:3};var Broker=function(val,options){};Broker.extend=Backbone.View.extend;_.extend(Broker.prototype,Backbone.Events,{push:function(action,target,payload,extras){var requestId=uuid(),deferred=new jQuery.Deferred;payload||(payload={});console.debug("[base.broker]","Local message'",action,"'","target:",target,"payload:",payload,"requestId:",requestId,"extras:",extras);this.trigger(action,target,_.clone(payload),deferred,extras);this._doAjax([requestId,action,target,payload,{}],deferred);return deferred},trigger:function(){var args=Array.prototype.slice.call(arguments),originator=UL.EventOriginator.pop();args.push(originator);Backbone.Events.trigger.apply(this,args)},_doAjax:function(message,deferred){$.ajax({url:API_ROOT+"motherbrain",type:"POST",data:JSON.stringify(message),contentType:"application/json",dataType:"json",xhrFields:{withCredentials:true}}).done(function(data){console.debug("[base.broker]	","Remote message '{0}'".format(data[0]),data[1],data[2],data[3]);if(data[mbMessageMap.action]=="Exception")deferred.reject(data);else if(data[mbMessageMap.action]=="OperationalError")deferred.reject(data[mbMessageMap.payload]);else deferred.resolve(data[mbMessageMap.payload])}).fail(function(data){console.debug("fail",data);deferred.reject(data)})}});UL.Broker=new Broker})();TEMPLATES["landing/main"]=Handlebars.compile('<div class="landing-header"> <div class="line content-std-elastic"> <a class="logo" href="/"> <img src="/static/assets/landing/logo.png" alt="Urlist" /> </a> <p class="app-access"> {{#LOGGED}} <a class="js-navigate" href="/dashboard">Go to your Dashboard &raquo;</a> {{/LOGGED}} {{#ANON}} Already registered? <a class="js-login" href="/login">Login</a> {{/ANON}} </p> </div> </div> <div class="landing-content"> {{#A-GROUP}} <div class="landing-welcome"> <div class="landing-welcome-fold clearfix"> <div class="line content-std-elastic"> <h1 class="landing-heading-main"> Share your Knowledge </h1> <h4 class="landing-subheading"> Create lists with your favorite links on topics you’re passionate about. <br> <strong>Keep your links always at hand</strong>, from work or home. Easily <strong>share</strong> your lists with your friends or coworkers, on presentations and blogs. </h4> <a href="#" class="button button-landing confirm js-signup">Create your Library!</a> </div> <!-- / .line --> </div> <!-- / .line --> </div> <!-- / .landing-welcome --> {{/A-GROUP}} {{#B-GROUP}} <div class="landing-welcome landing-welcome-video"> <div class="landing-welcome-fold clearfix"> <div class="line content-std-elastic is--fluid"> <div class="column five"> <h1 class="landing-heading-main"> Share your Knowledge </h1> <p class="landing-subheading"> Create lists with your favorite links on topics you’re passionate about. <strong>Keep your links always at hand</strong>, from work or home. </p> <p class="landing-subheading"> Easily <strong>share</strong> your lists with your friends or coworkers, on presentations and blogs. </p> <a href="#" class="button button-landing confirm js-learn-more">Create your Library!</a> {{!<a href="#" class="button button-landing confirm js-signup">Make your List!</a>}} </div> <div class="column seven"> <iframe class="video-trailer" src="http://player.vimeo.com/video/70849830" width="535" height="301" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe> </div> </div> <!-- / .line --> </div> <!-- / .line --> </div> <!-- / .landing-welcome.landing-welcome-video --> {{/B-GROUP}} <div class="landing-preview" data-source="Landing:preview"> <div class="line content-std-elastic is--fluid"> <div class="widget-wrapper"></div> <a href="/discover" class="button button-landing action js-navigate"> Discover more </a> </div> </div> <div class="landing-promo" data-source="user-quotes"> <div class="line content-std-elastic is--fluid"> <div class="landing-slider js-landing-slider"> <div class="slide"> <div class="media slide-content"> <div class="medium"> <div class="avatar"> <img src="//static.urli.st/website/landing/raabeatslesse.jpg" alt="" > </div> </div> <div class="content"> <h4 class="profile-details"> <span class="profile-username">Raabster Raabe</span> <span class="profile-profession">Educator</span> </h4> <p class="profile-description"> <span class="profile-quote"> “Personally, I find Urlist invaluable for researching; I have used it for my own course work and for planning my curriculum.” </span> <a href="/library/raabeatslesse" class="profile-cta js-navigate">view profile</a> </p> </div> </div> </div> <div class="slide"> <div class="media slide-content"> <div class="medium"> <div class="avatar"> <img src="//urli.st/media/profile_images/504f7899ee99851e43000011.png" alt="" > </div> </div> <div class="content"> <h4 class="profile-details"> <span class="profile-username">Michele Gesser</span> <span class="profile-profession">K12 Technology Coach</span> </h4> <p class="profile-description"> <span class="profile-quote"> “I am a huge fan of Urlist! I teach technology professional development to K-12 educators and there’s nothing better than a one-stop-shop URList link with all of my resources.” </span> <a href="/library/k12techcoach" class="profile-cta js-navigate">view profile</a> </p> </div> </div> </div> {{! <div class="slide"> <div class="media slide-content"> <div class="medium"> <div class="avatar"> <img src="//placehold.it/98x98" alt="" > </div> </div> <div class="content"> <h4 class="profile-details"> <span class="profile-username">Kate P.</span> <span class="profile-profession">Blogger 3</span> </h4> <p class="profile-description"> <span class="profile-quote"> Home or work, school or library: you can access your lists from your own devices public computers. </span> <a href="#" class="profile-cta">view profile</a> </p> </div> </div> </div> }} </div> </div> </div> <!-- / .landing-promo --> <div class="landing-features"> <h3 class="claim"> Organize your surfing in a clever way </h3> <ul class="feature-grid"> <li class="feature-item feature-item-01"> <div class="line content-std-elastic"> <div class="feature-item-fold"> <div class="image"> <img src="/static/assets/landing/nice.png" alt=""> </div> <div class="text"> <h4 class="title"> Simple, handy, beautiful </h4> <p class="description"> Urlist is designed to be as <strong>easy</strong> as possible. <br> No tags, no weird options, just links and lists. <br> Add notes and customize the cover image to <strong>make your lists more personal</strong> and beautiful. Browse the links in a snap, using our <strong>slideshow</strong> feature. </p> </div> </div> </div> </li> <li class="feature-item feature-item-02"> <div class="line content-std-elastic"> <div class="feature-item-fold"> <div class="image"> <img src="/static/assets/landing/easy.png" alt=""> </div> <div class="text"> <h4 class="title"> The content that matters <br> in one short link </h4> <p class="description"> Make a <strong>collaborative search</strong> with your team at work. Share references on a <strong>presentation</strong>. Help a friend sharing some good links about <strong>a topic you rule</strong>. Using Urlist you need only one <strong>short link</strong> to share a group of links together. </p> </div> </div> </div> </li> <li class="feature-item feature-item-03"> <div class="line content-std-elastic"> <div class="feature-item-fold"> <div class="image"> <img src="/static/assets/landing/friendly.png" alt=""> </div> <div class="text"> <h4 class="title"> Your favorite links, every <br> time you need them </h4> <p class="description"> Home or work, school or library: you can access <br> your lists from your <strong>own devices</strong> or <strong>from public computers</strong>. With Urlist you’ll never need to backup your browser’s favorite again: all your links are saved and always accessible online. </p> </div> </div> </div> </li> <li class="feature-item feature-item-04"> <div class="line content-std-elastic"> <div class="feature-item-fold"> <div class="image"> <img src="/static/assets/landing/discover.png" alt=""> </div> <div class="text"> <h4 class="title"> Find great content, shared <br> by like-minded people </h4> <p class="description"> Every day teachers, designers, developers, <br> and Internet addicts, collect their best resources using Urlist. <strong>Discover</strong> what they are sharing, follow like-minded people to build your <strong>network <br> of interests</strong>, and relist the links you like. </p> </div> </div> </div> </li> </ul> </div> <!-- / .landing-promo --> <div class="landing-closing"> <div class="line content-std-elastic"> <h3 class="claim"> Everyone is an expert. <br> <strong>Ready to share your passions?</strong> </h3> <a href="#" class="button button-landing confirm js-signup">Sign Up for free!</a> </div> </div> </div> <!-- / .landing-content -->');
TEMPLATES["suggestion/urlists"]=Handlebars.compile('<ul class="sidebar-suggest-lists"> </ul>');TEMPLATES["suggestion/urlist"]=Handlebars.compile('<a href="/{{hash}}" class="list-title js-navigate">{{title}}</a> <span class="list-stats"> By <a href="/library/{{username}}" class="list-author js-related-author js-navigate">Screen Name</a> </span>');TEMPLATES["category/popular"]=Handlebars.compile('<div class="discovery-page"> <div class="page-header header-category"> <div class="content-std-elastic is--fluid"> <h1 class="page-title">Popular</h1> </div> </div> <div class="page-actions"></div> <div class="content-full-elastic"> <div class="widget-wrapper last {{#ANON}}not-logged{{/ANON}}" data-view="popular"></div> </div> </div> {{#ANON}} <div class="discovery-bannercta-signup"> <div class="content-std-elastic is--fluid"> <p>Start organizing your surfing in a clever way! <a href="#" class="button action wider js-signup">Learn More</a></p> </div> </div> {{/ANON}}');TEMPLATES["category/category"]=Handlebars.compile('<div class="discovery-page"> <div class="page-header header-category category--{{name}}"> <div class="inner content-std-elastic is--fluid"> <h1 class="page-title">{{label}}</h1> </div> </div> <div class="page-actions"> <div class="content-std-elastic is--fluid"> <div class="toolbar actions js-toolbar"> <ul class="nav left nav--navigation"> <li> <a href="/category/{{slugify label}}/popular" class="js-navigate js-popularity">Popular</a> </li> <li> <a href="/category/{{slugify label}}/new" class="js-navigate js--creation_time">Recent</a> </li> {{#LOGGED}} <li> <a href="/category/{{slugify label}}/network" class="js-navigate js-network">My Network</a> </li> {{/LOGGED}} </ul> </div> </div> </div> <div class="content-std-elastic is--fluid"> {{#if-equal name "education"}} <div class="message-box is--upon"> Are you a teacher or an educator? We would love to have your feedback on Urlist! <a href="https://docs.google.com/a/urli.st/forms/d/1D3ZnK5fzJ2iNIn5AGImBxYlnji43eejTdLEXkj3lXDQ" class="button action" target="_blank">Take the survey</a> </div> {{/if-equal}} </div> <div class="content-full-elastic"> <div class="widget-wrapper"></div> </div> </div>');TEMPLATES["messages/bookmark_feedback"]=Handlebars.compile("<b>Great!</b> Updates from this list will be visible on your <b>Network</b>");TEMPLATES["messages/ask_to_join"]=Handlebars.compile('<div class="message message-alert">You have been invited to join this list! <div class="button-group"> <a href="#" class="button small action js-message-accept">Accept</a> <a href="#" class="button small js-message-decline">Decline</a> </div> <a href="#" class="button-close js-message-close">&times;</a> </div>');TEMPLATES["messages/learn_more"]=Handlebars.compile('<div class="message message-alert"> {{#A-GROUP}} Want to keep all your favorite links at hand? {{/A-GROUP}} {{#B-GROUP}} Never lose a link anymore. (yup, it\'s free) {{/B-GROUP}} <a href="#" class="js-signup button action narrow wider" data-source="top-cta">Learn more!</a> <a href="#" class="button-close js-message-close">&times;</a> </div>');TEMPLATES["messages/add_category"]=Handlebars.compile('<div class="message message-alert">In which Categories this list will be visible? <a href="#" class="button action js-open-dialog" data-dialog="select-category" data-hash="{{hash}}">Add a category</a> <a href="#" class="button-close js-message-close">&times;</a> </div>');TEMPLATES["layout/bookmarklet"]=Handlebars.compile('<div class="container"> <div id="header"> <div class="header-bookmarklet"> <ul class="nav left"> <li> <a class="bookmarklet-logo" href="//urli.st" target="_blank" title="Go to Urlist website"> <img src="/static/assets/logo-bookmarklet.png" alt="Urlist" /> </a> </li> </ul> <ul class="nav right"> <li> {{#LOGGED}} <span class="log-info">You\'re logged in as <b class="screenname">{{CURRENT "user" "screen_name"}}</b></span> {{/LOGGED}} {{#ANON}} <span class="log-info">Please login</span> {{/ANON}} </li> </ul> </div> </div> <div id="content" class="content-bookmarklet"></div> </div>');TEMPLATES["layout/onboarding"]=Handlebars.compile('<div class="container"> <div id="header"> <div class="header-app clearfix app-navigation"> <div class="content-std-elastic is--fluid"> <a class="app-logo js-navigate" href="/"> <img src="/static/assets/logo.png" alt="Urlist" /> </a> </div> </div> </div> <div id="content" class="content"></div> </div>');TEMPLATES["layout/main"]=Handlebars.compile('<div id="main" class="container"> <div id="header"></div> <div id="content"></div> <div id="footer" class="hide js-footer-main"> <div class="line content-std-elastic is--fluid navbar"> <ul class="nav left"> <li> <a class="logo-footer" href="//urli.st" title="Urlist"> <img src="/static/assets/logo-footer.png" alt="Urlist" /> </a> </li> <li><a href="/resources/about" class="js-navigate">About</a></li> <li><a href="/resources/terms" class="js-navigate">Terms &amp; Privacy</a></li> <li><a href="/resources/help" class="js-navigate">Urlist Basics</a></li> <li><a href="http://blog.urli.st" class="external">Blog</a></li> <li> <a title="Visit Us on Facebook" href="https://www.facebook.com/urlist" class="external" target="_blank">Facebook</a> </li> <li> <a title="Follow Us on Twitter" href="https://twitter.com/urlist" class="external" target="_blank">Twitter</a> </li> </ul> <ul class="nav right"> <li> <span>Copyright 2013 Urlist srl</span> </li> </ul> </div> </div> <a class="sticker-scrollTop js-scrolltop" href="#">Back to Top</a> </div>');TEMPLATES["layout/error"]=Handlebars.compile('<div style="margin: 40px auto; text-align: center; font-family: sans-serif; "> We are updating Urlist, we will be back in minutes! </div>');TEMPLATES["dashboard/dashboard"]=Handlebars.compile('<div class="content-dashboard clearfix" data-source="Dashboard:main"> <div class="library-page" data-source="Dashboard:main"> <div class="library-header"> <div class="line content-std-elastic is--fluid"> <div class="column twelve"> <div class="media"> <div class="medium avatar avatar-library"> <img src="{{profile_image}}" alt=""> </div> <div class="content content-library"> <h1 class="screenname">{{screen_name}}</h1> <p class="shortbio">{{short_bio}}</p> <dl class="user-info"> {{#if location}} <dt class="user-location">From <b class="location-value">{{location}}</b></dt> {{/if}} {{#show_facebook_link}} {{#has_facebook}} <dt class="user-facebook">Fb <a href="https://facebook.com/{{facebook_username}}" target="_blank">{{facebook_username}}</a></dt> {{/has_facebook}} {{/show_facebook_link}} {{#has_twitter}} <dt class="user-twitter"><a href="https://twitter.com/{{twitter_username}}" target="_blank">@{{twitter_username}}</a></dt> {{/has_twitter}} <dt class="user-website"><a href="{{normalizeUrl website}}" target="_blank">{{hostify website}}</a></dt> </dl> {{#is_mine}} {{#unless progress}} <a href="/settings" class="button edit-profile js-navigate">Edit Profile</a> {{/unless}} {{/is_mine}} {{#is_mine}} {{#if progress}} <div class="profile-progression"> <a href="/settings" class="edit-profile-inline js-navigate">Click here to complete your profile</a> <div class="progressbar progressbar--profile js-profile-progressbar" data-progress="{{progress_num}}" data-total="{{progress_tot}}"> <div class="progressbar-total"></div> <div class="progressbar-value"></div> </div> </div> {{/if}} {{/is_mine}} {{^is_mine}} <a class="user-actions {{#following}}status-following{{/following}}" href="#"> <span class="button action iconed follow-user js-follow-user"> <i class="mini-icon icon-small-add-user"></i> Follow </span> <span class="button following-user js-unfollow-user">Following</i></span> <span class="button unfollow-user js-unfollow-user">Unfollow</i></span> </a> {{/is_mine}} </div> </div> </div> </div> <div class="toolbar toolbar-page"> <div class="content-std-elastic is--fluid"> <ul class="nav left js-dashboard-nav"> <li class="js-my-lists"> <a class="js-navigate" href="/library/{{username}}"> Lists <b class="cnt cnt-list-count js-my-lists-counter">{{my_lists_count}}</b> </a> </li> <li class="js-my-bookmarks"> <a class="js-navigate" href="/library/{{username}}/bookmarks"> Bookmarks <b class="cnt cnt-list-following js-following-lists-counter">{{following_lists_count}}</b> </a> </li> </ul> <ul class="nav right"> <li> <a class="js-following-stats" href="#">Following <b class="cnt-following-length">{{following_users_count}}</b></a> </li> <li> <a class="js-followers-stats" href="#">Followers <b class="cnt-following-length">{{followed_by_users_count}}</b></a> </li> </ul> </div> </div> </div><!--  / .toolbar-header  --> </div><!--  / .library-page  --> <div class="content-std-elastic is--fluid js-changedisplay hide"> <div class="toolbar toolbar-changedisplay"> <ul class="nav center"> <li> <div class="input-toggle {{!changedisplay-switcher}} js-changedisplay-switcher"> <div class="controls"> <a class="state state-a js-navigate js-route js-route-all" href="/library/{{username}}">All</a> <a class="state state-b js-navigate js-route js-route-authored" href="/library/{{username}}/created">Created</a> <a class="state state-c js-navigate js-route js-route-joined" href="/library/{{username}}/joined">Joined</a> </div> </div> </li> </ul> </div> </div> <div class="content-full-elastic js-dashboard-page"> <div class="js-dashboard-content"></div> </div> </div>');TEMPLATES["dashboard/savedsearches.item"]=Handlebars.compile('<a class="has-action js-navigate" href="/search/me/{{query}}">{{query}}</a> <a class="search-delete js-search-delete" href="#" title="Delete this search">Delete this search</a>');TEMPLATES["dashboard/notifications"]=Handlebars.compile('<div class="content-std-elastic"> <h4 class="activity-heading">What\'s happening?</h4> <ul class="indepth-notification-list" data-view="notifications"></ul> {{#if empty}} <div class="empty-placeholder empty-placeholder-notifications"> <p>No notifications</p> </div> {{/if}} </div>');TEMPLATES["dashboard/empty_lists"]=Handlebars.compile('<div class="empty-placeholder empty-placeholder-dashboard" data-source="Dashboard:onboarding"> {{^is_mine}} <p>No Lists created yet</p> {{/is_mine}} {{#is_mine}} <p>There is nothing here :(</p> <a href="#" class="button action js-new-list">Create your first list</a> {{/is_mine}} </div>');TEMPLATES["dashboard/savedsearches"]=Handlebars.compile('<ul class="saved-searches"> <li><span class="saved-searches-summary">Saved searches (<i class="js-amount">{{searches_amount}}</i>)</span></li> </ul>');TEMPLATES["dashboard/settings"]=Handlebars.compile('<div class="line user-settings-page"> <div class="column twelve"> <h1 class="page-title">Edit Settings</h1>  <div class="button-group-killme"> <a href="/library/{{username}}" class="button js-navigate">Back to profile</a> <input class="button action settings-save js-settings-save" type="submit" value="Save changes" /> </div> {{#if progress}} <div class="message message-box progress js-progress-box"> <h4>Your profile is <strong class="js-progress_percentage"></strong> complete. </h4> <ul class="js-completion-ul"> <li class="progress" data-progress="screen_name" style="text-decoration:line-through;">add your Name (or a nickname. We don\'t ask for your real name)</li> <li class="progress" data-progress="short_bio" style="text-decoration:line-through;">add a short biography in 80 chars</li> <li class="progress" data-progress="profile_image" style="text-decoration:line-through;">upload a Profile Picture</li> </ul> </div> {{/if}}  <h4 class="section-title">Profile</h4> <p class="section-info">These info will appear on your public profile</p> <div class="line form-section form-section-profile"> <div class="column six"> <label class="simple-label"> Name <input class="simple-input js-screen-name" placeholder="Your profile name" type="text" name="screen_name" value="{{original_screen_name}}" data-validator="not-empty" /> </label> <label class="simple-label"> Short Bio <input class="simple-input" type="text" placeholder="Tell us why you are awesome! (max 80 chars)" name="short_bio" value="{{short_bio}}" maxlength="80" /> </label> <label class="simple-label"> Location <input class="simple-input" type="text" placeholder="City, Country" name="location" value="{{location}}" /> </label> <label class="simple-label"> <input type="checkbox" name="show_facebook_link" {{checkedif show_facebook_link}} /> Show a link to my Facebook profile on my profile </label> </div> <div class="column six"> <fieldset class="media avatar-change-field"> <div class="medium avatar js-profile-image-container"> <img src="{{profile_image}}" alt="Your profile image" class="js-profile-image" /> </div> <form action="{{api_root}}user/profile-image" method="post" target="submit-profile-picture" enctype="multipart/form-data"> <div class="content context"> <h5 class="field-subheader">Profile Picture</h5> <p class="field-info">PNG, GIF or JPG. Max size of 700K</p> <a href="#" class="button small js-upload">Upload Picture</a> <span class="js-upload-name"></span> <input class="js-upload-real hide" type="file" accept="image/*" name="profile-image" /> </div> <iframe class="hide js-submit-profile-picture" name="submit-profile-picture"></iframe> </form> </fieldset> <label class="simple-label"> Website <input class="simple-input" type="text" name="website" value="{{website}}" /> </label> </div> </div> <p class="section-notice"><b>*Do not include any sensitive information</b> (phone number, bank account number, etc.) in these boxes.</p> <h4 class="section-title">Account Settings</h4> <p class="section-info">Email/Password and social logins</p> <div class="line form-section form-section-account-settings"> <div class="column six"> <label class="simple-label">Username {{#if username_changed_at}} <div class="simple-value"> http://urli.st/library/<em>{{username}}</em> </div> {{else}} <div class="simple-value"> http://urli.st/library/<input value="{{username}}" class="simple-input input-with-label" name="username" /> </div> {{/if}} </label> {{#if can_edit_username}}<p class="simple-label"><b>Note: you can change username just once!</b></p>{{/if}} <label class="simple-label">Email <input class="simple-input" type="text" value="{{email}}" disabled /></label> {{! <label class="simple-label">Add a password for login <a class="button button-edit js-password-add" href="#">Add Password</a></label> }} <label class="simple-label">Password <a class="button button-edit button-edit-shfted js-password-edit" href="#">Change Password</a></label> </div> <div class="column six"> <fieldset class="connect-social-field"> <h5 class="field-subheader">Social Networks Connections</h5> <label class="label-connection"> Log in with <b>Facebook</b> <input class="js-oauth" type="checkbox" {{checkedif facebook_username}} data-provider="facebook" /> <span class="connect-status {{#if facebook_username}}established{{/if}} js-connect-status"> {{#if facebook_username}} Connected! {{else}} Not connected! {{/if}} </span> </label> <br /> <label class="label-connection"> Log in with <b>Twitter</b> <input class="js-oauth" type="checkbox" {{checkedif twitter_username}} data-provider="twitter" /> <span class="connect-status {{#if twitter_username}}established{{/if}} js-connect-status"> {{#if twitter_username}} Connected! {{else}} Not connected! {{/if}} </span> </label> <br /> <label class="label-connection"> Log in with <b>Google</b> <input class="js-oauth" type="checkbox" {{checkedif google_username}} data-provider="google" /> <span class="connect-status {{#if google_username}}established{{/if}} js-connect-status"> {{#if google_username}} Connected! {{else}} Not connected! {{/if}} </span> </label> </fieldset> </div> </div> {{!<p class="section-notice"><a class="click-me js-deactivate-account" href="#">Deactivate Account</a></p>}} <h4 class="section-title">Notifications</h4> <p class="section-info">Control when Urlist sends emails to you</p> <div class="line form-section form-section-notifications"> <div class="column three section-info"> Send me an email when: </div> <div class="column five"> <label class="simple-label"> <input type="checkbox" name="notify_add_url" {{checkedif notify_add_url}} /> There is a <b>new link</b> on my lists </label> <label class="simple-label"> <input type="checkbox" name="notify_relist" {{checkedif notify_relist}} /> My links are <b>relisted</b> </label> <label class="simple-label"> <input type="checkbox" name="notify_follow_user" {{checkedif notify_follow_user}} /> I\'m <b>followed</b> by someone new </label> <label class="simple-label"> <input type="checkbox" name="notify_follow_list" {{checkedif notify_follow_list}} /> Someone is <b>following</b> my lists </label> <label class="simple-label"> <input type="checkbox" name="notify_suggest_url" {{checkedif notify_suggest_url}} /> Someone is <b>suggesting</b> a link </label> </div> </div> </div> </div>');TEMPLATES["dashboard/people"]=Handlebars.compile('<div class="contributors-area"> <ul class="contributors-list clearfix"> </ul> <a href="#" class="load-more-contributors button small js-load-more hide">See more</a> </div>');TEMPLATES["dashboard/people.item"]=Handlebars.compile('<li class="contributor-item" data-username="{{username}}"> <a class="contributor-avatar js-navigate js-has-tooltip" href="/library/{{username}}" title="{{screen_name}}" data-tooltip> <img src="{{profile_image}}" alt="{{screen_name}}" /> </a> </li>');TEMPLATES["header/header"]=Handlebars.compile('<div class="header-app js-header-main clearfix"> <div class="content-std-elastic is--fluid"> <a class="app-logo js-navigate" href="/"> <img src="/static/assets/logo.png" alt="Urlist" /> </a> <ul class="nav left app-navigation"> {{#LOGGED}} <li class="nav-item new-list"> <span> <a class="button js-new-list" rel="new-list" data-source="header" href="#"> <i class="mini-icon icon-small-add"></i> New list </a> </span> </li> {{/LOGGED}} </ul> <ul class="nav right app-navigation"> {{#LOGGED}} <li class="nav-item action js-nav-item js-item-library"> <a class="js-navigate" href="/library/{{username}}"> <i class="avatar"><img src="{{profile_image}}" alt="" /></i> <span>My Profile</span> </a> <div class="dropdown dropdown--floating"> <ul class="menu-list"> <li><a class="js-navigate" href="/library/{{username}}">View my Profile</a></li> <li><a class="js-navigate" href="/settings">Account settings</a></li> <li><a class="js-navigate" href="/resources/help">Help</a></li> <li class="divider"></li> <li class="secondary"><a href="/logout" class="js-navigate">Log out</a></li> </ul> </div> </li> <li class="nav-item item-dashboard item-activity js-nav-item js-notifications"> <a class="js-navigate" href="/activity"> <span class="notification-button"> <i class="mini-icon icon-small-activity"></i> <span class="notification-badge js-notifications-counter" data-count="{{notifications_counter}}"></span> </span> <span class="item-label hidden">Notifications</span> </a> </li> <li class="nav-item"> <span> <form class="nav-item-search js-search-form"> <input class="search-input js-search-input" type="text" placeholder="Search"> <input class="search-submit" type="submit" value="Find"> <div class="search_cta-list"> <ul class="sublist ac-cutted js-load-astype"> <li><a class="js-search-globally" href=""><i class="mini-icon icon-small-search"></i> Global</a></li> <li><a class="js-search-in-library" href=""><i class="mini-icon icon-small-search"></i> My Library</a></li> </ul> <div class="sublist-savedsearch js-saved-searches"></div> </div> </form> </span> </li> {{/LOGGED}} {{#ANON}} <li class="nav-signup"><a class="button js-signup" href="#">Make a list</a></li> <li class="nav-login"> <a class="js-login" href="#">Login</a></span> </li> {{/ANON}} </ul> </div> </div>');TEMPLATES["header/notifications"]=Handlebars.compile('{{#if render}} <div class="dropdown dropdown--floating dropdown--notifications js-dropdown--notifications"> <ul class="notification-list"> </ul> <div class="subfooter"> <a class="cta js-navigate" href="/activity">Go to Activity</a> </div> </div> {{/if}}');TEMPLATES["utils/dialog"]=Handlebars.compile('<div class="dialog-centering {{appendiftrue is_wizard \'is--wizard\'}}"> <div class="dialog-overlay"></div> <div class="dialog-wrapper {{dialog_class}}"> <form class="js-dialog--hook"></form> </div> </div>');TEMPLATES["utils/list_selector.summary"]=Handlebars.compile('<dl class="form-item form-item--nested"> <!-- <dt class="column six"> --> <label class="hide">Choose section</label> <!-- </dt> --> <dt class="column twelve"> <input type="hidden" name="list-type" value="reference" /> <select name="target-list-section" aria-label="Choose section"> {{#sections}} <option value="{{section_id}}">{{or title empty_title}}</option> {{/sections}} </select> </dt> </dl>');TEMPLATES["utils/list_selector"]=Handlebars.compile('<div class="list-selector"> <div class="line break-mobile"> <div class="column column-main"> <input class="input-relist-to js-input-relist-to" type="text" name="target-name" placeholder="Search your lists" /> <span class="status js-relister-trigger"> <i class="mini-icon icon-small-search"></i> </span> <input class="js-input-relist-to-store" name="target-list" type="hidden" /> <div class="section-relist"></div> </div> <div class="column column-sub contiguous-next"> <a href="#" class="start-new-list js-start-new-list">+ New List</a> </div> </div> <div class="list-selector__sub_section js-sub-section clearfix"></div> </div>');TEMPLATES["hashtag/hashtag"]=Handlebars.compile('<div class="discovery-page"> <div class="page-header"> <div class="content-std-elastic is--fluid"> <h1 class="page-title">#{{titlecase hashtag}}</h1> </div> </div> <div class="page-actions"> <div class="content-std-elastic is--fluid"> <div class="toolbar actions js-toolbar"> <ul class="nav left nav--navigation"> <li> <a href="/hashtag/{{slugify hashtag}}/popular" class="js-navigate js-popularity">Popular</a> </li> <li> <a href="/hashtag/{{slugify hashtag}}/new" class="js-navigate js--creation_time">Recent</a> </li> {{#LOGGED}} <li> <a href="/hashtag/{{slugify hashtag}}/network" class="js-navigate js-network">My Network</a> </li> {{/LOGGED}} {{^saved}} {{!<li> <a href="#" class="button js-save-search"> <i class="mini-icon icon-small-add"></i> Save this search </a> </li>}} {{/saved}} </ul> </div> </div> </div> <div class="content-full-elastic"> <div class="widget-wrapper"></div> </div> </div>');TEMPLATES["dialog/signup.success"]=Handlebars.compile('<div class="dialog-header"> Thank you! {{^onboarding}} <a href="#" class="dialog-close js-dialog-close">&times;</a> {{/onboarding}} </div> <div class="dialog-content"> <dl class="form-item"> <dt class="column twelve"> <h5 class="question is--important"> To complete the process you must activate your account. </h5> <p class="description--lead"> We’ve sent a confirmation email. Please <strong>check your inbox</strong> and <strong>click on the link</strong> to activate your account. </p> </dt> </dl> </div> {{^onboarding}} <div class="toolbar dialog-actions"> <ul class="nav right"> <li> <a class="button button-dialog-close js-dialog-close" href="#">Close</a> </li> </ul> </div> {{/onboarding}}');TEMPLATES["dialog/delete_list"]=Handlebars.compile('<div class="dialog-header"> Delete List <a href="#" class="dialog-close js-dialog-close">&times;</a> </div> <div class="dialog-content"> <dl class="form-item"> <dt class="column twelve"> <p class="description description--lead"> You\'re deleting <strong>{{title}}</strong>. This action cannot be undone. </p> </dt> </dl> </div> <div class="toolbar dialog-actions"> <ul class="nav right"> <li> <input class="button action js-url-save" type="submit" value="Delete" /> </li> <li> <button class="button js-dialog-close js-cancel">Cancel</button> </li> </ul> </div>');TEMPLATES["dialog/search_image.emptyitem"]=Handlebars.compile('<li class="search-result-item placeholder empty"> <p> <i class="mini-icon icon-small-search"></i> <strong>No results found</strong> </p> </li>');TEMPLATES["dialog/delete_contributor"]=Handlebars.compile('<div class="dialog-header"> Remove contributor <a href="#" class="dialog-close js-dialog-close">&times;</a> </div> <div class="dialog-content"> <dl class="form-item"> <dt class="column twelve"> <p class="description description--lead"> Are you sure you want to remove <strong>{{screen_name}}</strong> from this list? </p> </dt> </dl> </div> <div class="toolbar dialog-actions"> <ul class="nav right"> <li> <input class="button action js-url-save" type="submit" value="Remove" /> </li> <li> <button class="button js-dialog-close js-cancel">Cancel</button> </li> </ul> </div>');TEMPLATES["dialog/deactivate_account"]=Handlebars.compile('<div class="dialog-header"> Delete Account <a href="#" class="dialog-close js-dialog-close">&times;</a> </div> <div class="dialog-content"> <dl class="form-item"> <dt class="column twelve"> <h5 class="question is--important">Are you sure to delete your Urlist account?</h5> </dt> </dl> <dl class="form-item"> <dt class="column twelve"> <p> If there’s nothing we can do for you to make you happy, click “YES” and all your data will be deleted. <strong>This action cannot be undone.</strong> </p> </dt> </dl> </div> <div class="toolbar dialog-actions"> <ul class="nav right"> <li> <a href="#" class="button button--verbose js-deactivate-account--yes">Yes, delete me!</a> </li> <li> <a href="#" class="button action button--verbose js-deactivate-account--no">No, I want to stay!</a> </li> </ul> </div>');TEMPLATES["dialog/share_list"]=Handlebars.compile('<div class="dialog-header"> {{#if embed}} List widget {{/if}} {{#unless embed}} Share this List {{/unless}} <a href="#" class="dialog-close js-dialog-close">&times;</a> </div> <div class="dialog-content"> {{#unless embed}} <dl class="form-item"> <dt class="column four"> <label>Copy &amp; paste the link</label> </dt> <dd class="column eight"> <input class="textfield" type="text" value="{{full_url}}" autofocus readonly /> </dd> </dl> <dl class="form-item"> <dt class="column four"> <label>Or use instead</label> </dt> <dd class="column eight"> <div class="toolbar share_option-bar"> <ul class="nav left share_option-list"> <li class="share_option-item share_option-email"><a class="js-trigger-share--email" title="Share via Email" href="#">Email</a></li> <li class="share_option-item share_option-gplus"><a class="js-trigger-share--gplus" title="Share on Google+"href="#">Google +</a></li> <li class="share_option-item share_option-twitter"><a class="js-trigger-share--twitter" title="Share by Twitter" href="#">Twitter</a></li> <li class="share_option-item share_option-facebook"><a class="js-trigger-share--facebook" title="Share to Facebook" href="#">Facebook</a></li> </ul> </div> </dd> </dl> {{/unless}} {{#if embed}} <dl class="form-item"> <dt class="column four"> <label>Copy &amp; Paste this code</label> {{!<div class="notice">Copy and paste the provided HTML code</div>}} </dt> <dd class="column eight js-toggle"> <textarea class="has--code js-for-clipboard js-simple-textarea js-toggle-one" readonly autofocus> &lt;blockquote class="urlist-list" id="urlist-{{hash}}"&gt; &lt;h4&gt;{{urls_amount}} Links from: &lt;a href="{{full_url}}"&gt;{{title}}&lt;/a&gt;&lt;/h4&gt; {{#if description}}&lt;p&gt;{{{html_description}}}&lt;/p&gt;{{/if}} &lt;small&gt;&mdash;&lt;a href="//urli.st/library/{{author_username}}"&gt;{{author_screenname}}&lt;/a&gt;, via &lt;a href="//urli.st"&gt;Urlist&lt;/a&gt;&lt;/small&gt; &lt;/blockquote&gt; &lt;script async src="{{embedroot}}/widget/libs/embed.js"&gt;&lt;/script&gt; </textarea> <textarea class="has--code js-for-clipboard js-simple-textarea js-toggle-two" readonly> &lt;iframe id=&quot;list-widget-{{hash}}&quot; style=&quot;box-shadow: 0 1px 3px rgba(188,188,188,0.25);border-radius: 3px;-moz-box-sizing: border-box;-webkit-box-sizing: border-box;box-sizing: border-box;-webkit-background-clip: border-box;border: 1px solid #d9d9d9;display: block;overflow: hidden; background-color: transparent;width: 100%;max-width: 620px;margin: 0 auto 20px autopadding: 0;padding: 0;border: 0;height:320px&quot; src=&quot;http://urli.st/widget/{{hash}}&quot;&gt;&lt;/iframe&gt; </textarea> <label class="toggle-label"> <input class="js-toggle-advanced-embedding" type="checkbox"> No Javascript <span class="small">(works best on Wordpress)</span> </label> </dd> </dl> {{/if}} </div> <div class="toolbar dialog-actions"> <ul class="nav right"> <li> <button class="button js-dialog-close js-cancel">Close</button> </li> </ul> </div>');TEMPLATES["dialog/search_image.item"]=Handlebars.compile('<li class="search-result-item js-result-from-search" style="background-image: url({{url_q}})"> <img src="/static/assets/_utils/spacer.gif" class="js-result-from-search" data-authorurl="{{author_url}}" data-fullsrc="{{url_l}}"> </li>');TEMPLATES["dialog/image_url_dialog"]=Handlebars.compile('<div class="dialog-header"> Upload from Link <a href="#" class="dialog-close js-dialog-close">&times;</a> </div> <div class="dialog-content"> <dl class="form-item"> <dt class="column twelve"> <input class="textfield js-url-input" type="text" name="text" placeholder="http://"/> </dt> </dl> </div> <div class="toolbar dialog-actions"> <ul class="nav right"> <li> <input class="button action" type="submit" value="Upload" /> </li> <li> <button class="button js-dialog-close">Cancel</button> </li> </ul> </div>');TEMPLATES["dialog/suggest_link.success"]=Handlebars.compile('<dl class="form-item"> <dt class="column twelve"> <h5 class="information">Thanks! Your link is waiting for approval.</h5> <a class="button big button-view-list js-dialog-close" href="#">Close</a> </dt> </dl>');TEMPLATES["dialog/login_modal"]=Handlebars.compile('<div class="dialog-header"> Not registered? <a class="js-signup" href="#">Sign up here</a> <a href="#" class="dialog-close js-dialog-close">&times;</a> </div> <div class="dialog-content"> <h4 class="heading">Login into your account</h4> <div class="content-alert alert-error alert-small js-login-error hide"> Please, provide a valid email or username and password, or get access to Urlist through the Social buttons </div> <div class="line break-mobile"> <!-- <div class="column six main-column"> --> <div class="column six sub-column"> <ul class="buttons-social"> <li><a class="button big wide facebook" href="{{facebook_url}}">Facebook</a></li> <li><a class="button big wide gplus" href="{{google_url}}">Google+</a></li> <li><a class="button big wide twitter" href="{{twitter_url}}">Twitter</a></li> </ul> </div> <div class="column six main-column"> <label class="form-item form-item--alone"> <label class="hidden">Username or Email</label> <input class="textfield" type="text" name="username" placeholder="Email or Username" data-validator="not-empty" /> </label> <label class="form-item form-item--alone"> <label class="hidden">Password</label> <input class="textfield" type="password" name="password" placeholder="Password" data-validator="not-empty"/> </label> <p class="align-right"><a class="dialog-notice_middle js-recover-password" href="#">Forgot your password?</a></p> <input class="button wide confirm button-login" type="submit" value="Log In" /> </div> </div> </div>');TEMPLATES["dialog/search_image"]=Handlebars.compile('<div class="dialog-header"> Search cover image <a href="#" class="dialog-close js-dialog-close">&times;</a> </div> <div class="dialog-content"> <dl class="form-item"> <dt class="column ten"> <input class="textfield js-make-search-input" type="text" name="text" /> <p class="dialog-notice align-right">Source: Flickr.com</p> </dt> <dd class="column two"> <a href="#" class="button js-make-search">Search</a> </dd> </dl> <ul class="search-result-list js-render-results"> </ul> </div> <div class="toolbar dialog-actions"> <ul class="nav right"> <li> <input class="button action" type="submit" value="Upload" /> </li> <li> <button class="button js-dialog-close">Cancel</button> </li> </ul> </div>');TEMPLATES["dialog/edit_password"]=Handlebars.compile('<div class="dialog-header"> Edit Password <a href="#" class="dialog-close js-dialog-close">&times;</a> </div> <div class="dialog-content"> <div class="line"> <div class="column twelve"> <p class="content-alert alert-error alert-small js-error-message hide" data-error="not-match"> Passwords don\'t match </p> <p class="content-alert alert-error alert-small js-error-message hide" data-error="too-short"> Password must be at least 6 characters </p> <p class="content-alert alert-error alert-small js-error-message hide" data-error="wrong-password"> The current password you\'ve entered is incorrect </p> </div> </div> <dl class="form-item"> <dt class="column three"> <label>Old Password</label> </dt> <dd class="column seven"> <input class="textfield" type="password" name="old_password" /> <div class="line align-right"> <a class="js-recover-password" href="#">Forgot your Password?</a> </div> </dd> </dl> <dl class="form-item"> <dt class="column three"> <label>New Password</label> </dt> <dd class="column seven"> <input class="textfield" type="password" name="new_password" /> </dd> </dl> <dl class="form-item"> <dt class="column three"> <label>Type it again</label> </dt> <dd class="column seven"> <input class="textfield" type="password" name="confirm_password" /> </dd> </dl> </div> <div class="dialog-actions"> <input class="button action js-url-save" type="submit" value="Save" /> <button class="button neutral js-dialog-close js-cancel">Cancel</button> </div>');
TEMPLATES["dialog/suggest_link"]=Handlebars.compile('<div class="dialog-header"> Suggest a link <a href="#" class="dialog-close js-dialog-close">&times;</a> </div> <div class="dialog-content"> <dl class="form-item"> <dt class="column twelve"> <input class="textfield" type="text" name="url" value="{{suggested_url}}" autocomplete="off" data-error="Enter the URL of the link" data-validator="not-empty" placeholder="http://" /> </dt> </dl> <dl class="form-item"> <dt class="column twelve"> <span class="textarea-with-toolbar on-bottom"> <textarea class="simple-textarea js-simple-textarea" name="description" data-count="chars" data-count-limit="400" rel="description-counter" placeholder="Comment this link">{{suggested_description}}</textarea> <div class="toolbar"> <ul class="nav left"> <li class="secondary"> <span>* formatting with markdown is <span class="help-area"> <i class="click-me">possible</i> <cite class="tooltip-help"> Links are automatically hyperlinked. Use *for bold words* and **for italic words** </cite> </span> </span> </li> {{!<li><a class="button small" href="#">Add Image</a></li>}} </ul> <ul class="nav right"> {{! <li><span class="button small make-text-bold js-wrap-text-bold">Bold</span></li> <li><span class="button small make-text-italic js-wrap-text-italic">Italic</span></li> }} <li> <span class="counter-chars"><b id="description-counter">400</b> char</span> </li> </ul> </div> </span> </dt> </dl> {{#if sections}} <dl class="form-item"> <dt class="column twelve"> <select name="section" id="" aria-label="Choose section"> {{#sections}} <option value="{{section_id}}">{{or title empty_title}}</option> {{/sections}} </select> </dt> </dl> {{/if}} </div> <div class="toolbar dialog-actions"> <ul class="nav right"> <li> <input class="button action js-url-save" type="submit" value="Send!" /> </li> <li> <button class="button js-dialog-close js-cancel">Cancel</button> </li> </ul> </div>');TEMPLATES["dialog/report"]=Handlebars.compile('<div class="dialog-header"> Report list <a href="#" class="dialog-close js-dialog-close">&times;</a> </div> <div class="dialog-content"> <dl class="form-item is--important"> <dt class="column twelve"> <h5 class="information">Report list</h5> <p>Please specify why we should remove this content</p> </dt> </dl> <dl class="form-item"> <dt class="column four"> <label>Your email address (optional)</label> </dt> <dd class="column eight"> <input class="textfield" type="text" name="email" /> </dd> </dl> <dl class="form-item"> <dt class="column four"> <label>Why are you reporting this list?</label> </dt> <dd class="column eight"> <textarea class="js-simple-textarea" name="message" placeholder="Spam, inappropriate content, violence, hateful content..."></textarea> </dd> </dl> </div> <div class="toolbar dialog-actions"> <ul class="nav right"> <li> <input class="button action js-url-save" type="submit" value="Report" /> </li> <li> <button class="button js-dialog-close js-cancel">Cancel</button> </li> </ul> </div>');TEMPLATES["dialog/migrate_list"]=Handlebars.compile('<div class="dialog-header"> Go Public <a href="#" class="dialog-close js-dialog-close">&times;</a> </div> <div class="dialog-content"> <h5 class="information">Great!</h5> <p class="description"> By pressing <strong>yes</strong>, people will be able to follow, relist and share this list. </p> </div> <div class="toolbar dialog-actions"> <ul class="nav right"> <li> <input class="button action js-url-save" type="submit" value="Yes!" /> </li> <li> <button class="button js-dialog-close js-cancel">Cancel</button> </li> </ul> </div>');TEMPLATES["dialog/settings_list_sections.item"]=Handlebars.compile('<li class="section-item js-section-item" data-cid="{{cid}}"> <span class="label-section label-{{position}}"></span> <input type="text" value="{{title}}" placeholder="{{empty_title}}" /> <a href="#" class="button button-faux button-delete-section js-delete-section">delete</a> </li>');TEMPLATES["dialog/new_list"]=Handlebars.compile('<div class="dialog-header"> New List <a href="#" class="dialog-close js-dialog-close">&times;</a> </div> <div class="dialog-content"> <!-- <div class="js-title"> ? --> <dl class="form-item"> <dt class="column three"> <label>Title</label> </dt> <dd class="column nine"> <input id="title-list-{{hash}}" class="textfield" type="text" name="title" value="" autocomplete="off" data-error="Enter the title of the list" data-validator="not-empty" placeholder="ex. Best Tiramisu Recipes" /> </dd> </dl> {{#if secret_lists_left}} <dl class="form-item"> <dt class="column three"> <label>Change Visibility</label> </dt> <dd class="column nine"> <div class="textbox"> <div class="input-switcher"> <input id="is-public" class="control" type="radio" name="secret" value="false" checked="checked"> <label for="is-public" class="state state-a">Public</label> <input id="is-secret" class="control" type="radio" name="secret" value="true"> <label for="is-secret" class="state state-b">Unpublished</label> </div> <div class="dialog-notice"><b>{{secret_lists_left}}</b> unpublished left</div> </div> </dd> </dl> {{/if}} </div> <div class="toolbar dialog-actions"> <ul class="nav right"> <li> <input class="button action js-url-save" type="submit" value="Go!" /> </li> <li> <button class="button js-dialog-close js-cancel">Cancel</button> </li> </ul> </div>');TEMPLATES["dialog/contributors.item"]=Handlebars.compile('<li class="media contributor-item {{#author}}contributor-author{{/author}} {{#if-equal status \'pending\'}}pending{{/if-equal}} js-contributor" data-user-id="{{user_id}}"> <span class="medium avatar"> <img class="img" src="{{profile_image}}" alt="" /> </span> <span class="content username"> {{screen_name}} {{#author}}<i>(author)</i>{{/author}} {{#itsme}}<i>(you)</i>{{/itsme}} {{#if-equal status "pending"}}<i>(invite sent)</i>{{/if-equal}} </span> {{#unless author}} {{#if itsme}} <a class="contributor-delete js-contributor-delete" href="#" title="Leave the list"> Leave </a> {{else}} <a class="contributor-delete js-contributor-delete" href="#" title="Remove Contributor"> Remove </a> {{/if}} {{/unless}} </li>');TEMPLATES["dialog/relist_url.success"]=Handlebars.compile('<dl class="form-item"> <dt class="column twelve"> <h5 class="information">Great! Link relisted in <cite>‘{{title}}’</cite></h5> <a class="button big button-view-list js-navigate" href="/{{hash}}">View the list</a> </dt> </dl>');TEMPLATES["dialog/delete_section"]=Handlebars.compile('<div class="dialog-header"> Delete Section <a href="#" class="dialog-close js-dialog-close">&times;</a> </div> <div class="dialog-content"> <dl class="form-item"> <dt class="column twelve"> <p class="description description--lead"> All the links in this section will be deleted. This action cannot be undone. </p> </dt> </dl> </div> <div class="toolbar dialog-actions"> <ul class="nav right"> <li> <input class="button action js-url-save" type="submit" value="Delete" /> </li> <li> <button class="button js-dialog-close js-cancel">Cancel</button> </li> </ul> </div>');TEMPLATES["dialog/reset_password"]=Handlebars.compile('<div class="dialog-header"> Reset Password <a href="#" class="dialog-close js-dialog-close">&times;</a> </div> <div class="dialog-content"> <div class="line"> <div class="column twelve"> <p class="content-alert alert-error alert-small js-error-message hide" data-error="not-match">Passwords don\'t match</p> <p class="content-alert alert-error alert-small js-error-message hide" data-error="too-short">Password must be at least 6 characters</p> </div> </div> <dl class="form-item"> <dt class="column four"> <label>New Password</label> </dt> <dd class="column eight"> <input class="textfield" type="password" name="new_password" /> </dd> </dl> <dl class="form-item"> <dt class="column four"> <label>Type it again</label> </dt> <dd class="column eight"> <input class="textfield" type="password" name="confirm_password" /> </dd> </dl> </div> <div class="toolbar dialog-actions"> <ul class="nav right"> <li> <input class="button action js-url-save" type="submit" value="Save" /> </li> </ul> </div>');TEMPLATES["dialog/delete_cover"]=Handlebars.compile('<div class="dialog-header"> Delete Cover Image <a href="#" class="dialog-close js-dialog-close">&times;</a> </div> <div class="dialog-content"> <dl class="form-item"> <dt class="column twelve"> <p class="description description--lead"> Are you sure you want to remove the cover image? </p> </dt> </dl> </div> <div class="toolbar dialog-actions"> <ul class="nav right"> <li> <input class="button action js-url-save" type="submit" value="Delete" /> </li> <li> <button class="button js-dialog-close js-cancel">Cancel</button> </li> </ul> </div>');TEMPLATES["dialog/recover_password.success"]=Handlebars.compile('<dl class="form-item"> <dt class="column twelve"> <h5 class="information is--important"> You will receive an email containing password reset instructions </h5> <p class="description description--lead"> Please check your email for a link to reset your password </p> </dt> </dl> <a class="button button-dialog-close js-dialog-close" href="#">close</a>');TEMPLATES["dialog/signup_modal"]=Handlebars.compile('{{#unless onboarding}} <div class="dialog-header--contextual"> Already registered? <a class="js-login" href="#">Login</a> </div> {{/unless}} <div class="dialog-content"> {{#if onboarding}} <h4 class="heading">Unlock your first list!</h4> <p class="subheading">Create an account and start curating your lists, <strong>its free!</strong></p> {{else}} <h4 class="heading">Join Urlist!</h4> {{/if}} <a class="button js-setnext-onboarding button-facebook" data-track-source href="{{facebook_url}}">Connect with <span>Facebook</span></a> <p class="subheading">No password to remember and <strong>no spam on your wall :)</strong></p> <iframe src="//www.facebook.com/plugins/facepile.php?href=http%3A%2F%2Ffacebook.com%2FUrlist&amp;app_id={{app_id}}&amp;size=small&amp;max_rows=1" scrolling="no" frameborder="0" class="promo-frame" allowTransparency="true"></iframe> <div class="instruction simple-alert error-message hide" data-error="already-exists"> The email address is already taken.<br /> <a class="js-recover-password" href="#">Have you forgot your password?</a></p> </div> <div class="instruction simple-alert error-message hide" data-error="too-short"> Password must be at least 6 characters </div> <div class="instruction simple-alert error-message hide" data-error="invalid-password"> Password can contain only <a href="https://en.wikipedia.org/wiki/ASCII">a-z, A-Z and 0-9</a>. <br/>You can also sign in with Facebook </div> <div class="js-toggle-one"> <p class="instruction instruction--important"><a class="js-setnext-onboarding" href="{{google_url}}">Google+</a> or <a class="js-toggle" href="#">email and password</a></p> </div> <div class="js-toggle-two hide"> <p class="instruction">Email/Password Signup</p> <dl class="form-item form-item--signup"> <label class="hidden">Your Email</label> <input class="textfield" type="email" placeholder="Your Email" name="email" data-validator="email"/> <label class="hidden">Choose a Password</label> <input class="textfield" type="password" placeholder="Choose a Password" name="password" data-validator="not-empty" /> <input class="button js-setnext-onboarding confirm widest button--signup js-signup-me" type="submit" value="Confirm" /> </dl> </div> <p class="legal"> By creating an account, I accept Urlist’s <a href="/resources/terms" target="_blank">Terms of Service</a> and <a href="/resources/privacy" target="_blank">Privacy Policy</a>. </p> </div>');TEMPLATES["dialog/share_list_email.success"]=Handlebars.compile('<div class="dialog-header"> Share by email <a href="#" class="dialog-close js-dialog-close">&times;</a> </div> <div class="dialog-content"> <dl class="form-line"> <dt class="column twelve"> <h5 class="information">Email Sent!</h5> <p class="description">Thank you for sharing.</p> </dt> </dl> </div> <div class="toolbar dialog-actions"> <ul class="nav right"> <li> <button class="button neutral js-dialog-close js-cancel">Close</button> </li> </ul> </div>');TEMPLATES["dialog/contributors"]=Handlebars.compile('<div class="dialog-header"> Contributors <a href="#" class="dialog-close js-dialog-close">&times;</a> </div> <div class="dialog-content"> <dl class="form-item"> <dt class="column four"> <label>Invite people to join</label> </dt> <dd class="column eight"> <div class="collaborators-find clearfix"> <input class="textfield js-input-contributor" type="text" placeholder="Username" /> <input class="js-input-contributor-store" type="hidden" /> <input class="js-input-contributor-delete" type="hidden" /> </div> </dd> </dl> <dl class="line form-item collaborators-box"> <dt class="column two hide"> <button class="button widest add-contributor js-add-contributor">Invite</button> </dt> <dd class="column eight move-by-four"> <ul class="collaborators-list js-contributors"> </ul> </dd> </dl> </div> <div class="toolbar dialog-actions"> <ul class="nav right"> <li> <input class="button action js-url-save" type="submit" value="Done" /> </li> </ul> </div>');TEMPLATES["dialog/add_password"]=Handlebars.compile('<div class="dialog-header"> Add Password <a href="#" class="dialog-close js-dialog-close">&times;</a> </div> <div class="dialog-content"> <dl class="form-item"> <dt class="column three"> <span class="simple-label">New Password</span> </dt> <dd class="column seven"> <input class="textfield" type="password" name="new_password" /> </dd> </dl> <dl class="form-item"> <dt class="column three"> <span class="simple-label">Type it again</span> </dt> <dd class="column seven"> <input class="textfield" type="password" name="confirm_password" /> </dd> </dl> </div> <div class="toolbar dialog-actions"> <ul class="nav right"> <li> <input class="button action js-url-save" type="submit" value="Save" /> </li> <li> <button class="button js-dialog-close js-cancel">Cancel</button> </li> </ul> </div>');TEMPLATES["dialog/recover_password"]=Handlebars.compile('<div class="dialog-header"> Recover Password <a href="#" class="dialog-close js-dialog-close">&times;</a> </div> <div class="dialog-content"> <dl class="form-item"> <dt class="column four"> <label>Email Address</label> </dt> <dd class="column eight"> <input class="textfield" type="text" name="email" placeholder="Your email" data-validator="email" value="{{email}}" /> </dd> </dl> <dl class="form-item"> <dt class="column twelve"> <p> You will receive an <b>email with the instructions</b> to recover your password. </p> </dt> </dl> </div> <div class="toolbar dialog-actions"> <ul class="nav right"> <li> <input class="button action js-url-save" type="submit" value="Send" /> </li> <li> <button class="button js-dialog-close js-cancel">Cancel</button> </li> </ul> </div>');TEMPLATES["dialog/suggested_links"]=Handlebars.compile('<div class="dialog-header"> Suggested Links <a href="#" class="dialog-close js-dialog-close">&times;</a> </div> <div class="dialog-content"> <ul class="suggested_links-list"> {{#suggested_urls}} <li class="suggested_links-item" data-suggestion_id="{{suggestion_id}}"> <a href="{{url}}" class="title" target="_blank">{{decodeURIComponent url}}</a> <small class="url">{{description}}</small> <div class="toolbar"> <ul class="nav left"> <li><span class="author">By <a href="#" target="_blank" data-user_id="{{user_id}}">Screen Name</a></span></li> <li><span class="timestamp">{{prettydate sent_at}}</span></li> </ul> <div class="actions_link js-actions_link"> <ul class="nav right js-toaccept"> <li> <span> <a href="#" class="button action js-trigger-accepted">Accept</a> </span> </li> <li> <span> <a href="#" class="button js-trigger-noaccept">Decline</a> </span> </li> </ul> <ul class="nav right hide js-accepted"> <li> <span> <b>Listed!</b> </span> </li> </ul> <ul class="nav right hide js-noaccept"> <li> <span> <b>Declined</b> </span> </li> </ul> </div> </div> </li> {{/suggested_urls}} </ul> </div>');TEMPLATES["dialog/relist_url"]=Handlebars.compile('<div class="dialog-header"> Relist a link <a href="#" class="dialog-close js-dialog-close">&times;</a> </div> <div class="dialog-content"> <!--  <div class="line form-item"> <div class="column twelve"> <h5 class="information">Choose where to add this Link</h5> </div> </div> --> <dl class="form-item"> <dt class="column three"> <label>Save the link to</label> </dt> <dd class="column nine"> <span class="js-list-selector"></span> </dd> </dl> <!-- <div class="line form-item"></div> -->  <input name="title" type="hidden" value="{{title}}" /> <input name="description" type="hidden" value="{{description}}" /> </div> <div class="toolbar dialog-actions"> <ul class="nav right"> <li> <input class="button action js-url-save" type="submit" value="Done" /> </li> <li> <button class="button js-dialog-close js-cancel">Cancel</button> </li> </ul> </div>');TEMPLATES["dialog/signup_aggressive"]=Handlebars.compile('<div class="dialog-content"> <p class="subheading"> This list is updated daily <br> <span class="important">Sign in <strong>for free</strong> to know when new links are added!</span> </p> <a class="button button-facebook" data-track-source href="{{facebook_url}}">Connect with <span>Facebook</span></a> <iframe src="//www.facebook.com/plugins/facepile.php?href=http%3A%2F%2Ffacebook.com%2FUrlist&amp;app_id={{app_id}}&amp;size=small&amp;max_rows=1" scrolling="no" frameborder="0" class="promo-frame" allowTransparency="true"></iframe> <p class="legal"> By creating an account, I accept Urlist’s <a href="/resources/terms" target="_blank">Terms of Service</a> and <a href="/resources/privacy" target="_blank">Privacy Policy</a>. </p> </div>');TEMPLATES["dialog/move_url"]=Handlebars.compile('<div class="dialog-header"> Move a link <a href="#" class="dialog-close js-dialog-close">&times;</a> </div> <div class="dialog-content"> <dl class="form-item"> <dt class="column three"> <label>Move the link to</label> </dt> <dd class="column nine"> <span class="js-list-selector"></span> </dd> </dl> <input name="title" type="hidden" value="{{title}}" /> <input name="description" type="hidden" value="{{description}}" /> </div> <div class="toolbar dialog-actions"> <ul class="nav right"> <li> <input class="button action js-url-save" type="submit" value="Done" /> </li> <li> <button class="button js-dialog-close js-cancel">Cancel</button> </li> </ul> </div>');TEMPLATES["dialog/generic_delete"]=Handlebars.compile('<div class="dialog-header"> Delete {{what}} <a href="#" class="dialog-close js-dialog-close">&times;</a> </div> <div class="dialog-content"> <dl class="form-item"> <dt class="column twelve"> <h5 class="question is--important">Are you sure to delete this <em>{{what}}</em>?</h5> <p class="description description--lead"> {{#if description}} {{description}} <br> {{/if}} <strong>This action cannot be undone.</strong> </p> </dt> </dl> </div> <div class="toolbar dialog-actions"> <ul class="nav right"> <li> <input class="button action js-url-save" type="submit" value="Yes, delete" /> </li> <li> <button class="button js-dialog-close js-cancel">No, cancel</button> </li> </ul> </div>');TEMPLATES["dialog/search_image.erroritem"]=Handlebars.compile('<li class="search-result-item placeholder error"> <p> <i class="mini-icon icon-small-warning"></i> <strong>Flickr server error</strong> Try later </p> </li>');TEMPLATES["dialog/signup_beta"]=Handlebars.compile('<div class="dialog-header--contextual"> Already registered? <a class="js-login" href="#">Login</a> </div> <div class="dialog-content"> <p class="subheading"> To confirm your suggestion, please signup </p> <a class="button button-facebook" data-track-source href="{{facebook_url}}">Connect with <span>Facebook</span></a> <div class="js-toggle-one emailpswd-one"> <a class="button button-emailpswd js-toggle" href="#">Use email/password</a> </div> <div class="js-toggle-two emailpswd-two hide"> <p class="instruction">Email/Password Signup</p> <div class="instruction simple-alert error-message hide" data-error="already-exists"> The email address is already taken.<br /> <a class="js-recover-password" href="#">Have you forgot your password?</a></p> </div> <div class="instruction simple-alert error-message hide" data-error="too-short"> Password must be at least 6 characters </div> <div class="instruction simple-alert error-message hide" data-error="invalid-password"> Password can contain only <a href="https://en.wikipedia.org/wiki/ASCII">a-z, A-Z and 0-9</a>. <br/>You can also sign in with Facebook </div> <dl class="form-item form-item--signup"> <label class="hidden">Your Email</label> <input class="textfield" type="email" placeholder="Your Email" name="email" data-validator="email"/> <label class="hidden">Choose a Password</label> <input class="textfield" type="password" placeholder="Choose a Password" name="password" data-validator="not-empty" /> <input class="button confirm widest button--signup js-signup-me" type="submit" value="Confirm" /> </dl> </div> <p class="legal"> By creating an account, I accept Urlist’s <a href="/resources/terms" target="_blank">Terms of Service</a> and <a href="/resources/privacy" target="_blank">Privacy Policy</a>. </p> </div>');TEMPLATES["dialog/show_list_following"]=Handlebars.compile('<div class="dialog-header"> {{title}} <a href="#" class="dialog-close js-dialog-close">&times;</a> </div> <div class="dialog-content" data-source="Dialog:following"> <dl class="form-item"> <dt class="column twelve"> <ul class="follower-list js-following"></ul> </dt> </dl> </div>');TEMPLATES["dialog/settings_list"]=Handlebars.compile('<div class="dialog-header"> Edit List <a href="#" class="dialog-close js-dialog-close">&times;</a> </div> <div class="dialog-content"> <dl class="form-item"> <dt class="column three"> <label>List Title</label> </dt> <dd class="column nine"> <input class="textfield" type="text" name="title" value="{{title}}" maxlength="60" /> </dd> </dl> <dl class="form-item"> <dt class="column three"> <label>Description</label> </dt> <dd class="column nine"> <textarea class="js-simple-textarea" placeholder="Why you created this list? You can also put #hashtags to categorize this List by keyword." name="description" data-count="chars" data-count-limit="400" rel="description-counter">{{description}}</textarea> <div class="toolbar"> {{! <ul class="nav left"> <li class="secondary"> <span>* formatting with markdown is <span class="help-area"> <i class="click-me">possible</i> <cite class="tooltip-help"> Links are automatically hyperlinked. Use *for bold words* and **for italic words** </cite> </span> </span> </li> </ul> }} <ul class="nav right"> <li> <span class="counter-chars"><b id="description-counter">400</b> char</span> </li> </ul> </div> </dd> </dl> {{#is_secret}} <div class="form-item {{show-if is_secret}}"> <dt class="column three"> <label>Make it Public</label> </dt> <dd class="column nine"> <span class="textbox"> <input id="is-public" type="checkbox" name="secret" value="false" title="Make it Public"> </span> </dd> </div> {{/is_secret}} <dl class="form-item"> <dt class="column three"> <label>Category</label> </dt> <span class="js-category-change {{show-if label_categories}}"> <dt class="column seven"> <span class="textbox"> <span class="label-categories js-label-categories">{{label_categories}}</span> </span> </span> <dd class="column two"> <a class="button wide js-edit-categories" href="#">Change</a> </dd> </span> <span class="js-category-add {{#if label_categories}}hide{{/if}}"> <span class="column four"> <a class="button wide js-edit-categories" href="#">Choose Categories!</a> </span> </span> </dl> <dl class="form-item"> {{#if contributors_amount}} <dt class="column twelve"> <span class="textbox is--subtle"> There are <b class="contributors_amount">{{contributors_amount}} contributors</b> on this list. <a class="inline-cta is--important js-edit-contributors" href="#">Invite more people!</a> </span> </dt> {{/if}} {{#unless contributors_amount}} <dt class="column three"></dt> <dd class="column nine"> <span class="textbox align-right"> <a class="inline-cta is--important js-edit-contributors" href="#">Need help? Invite people to add links!</a> </span> </dd> {{/unless}} </dl> </div> <div class="toolbar dialog-actions"> <ul class="nav left"> <li> <a class="generic-action js-delete-list" href="#">Delete List</a> </li> </ul> <ul class="nav right"> <li> <input class="button action js-url-save" type="submit" value="Save" /> </li> <li> <button class="button js-dialog-close js-cancel">Cancel</button> </li> </ul> </div>');TEMPLATES["dialog/show_list_following.item"]=Handlebars.compile('<li class="follower-item"> <a class="follower-item-content js-navigate" href="/library/{{username}}"> <span class="avatar"> <img src="{{profile_image}}" alt=""> </span> <span class="username">{{screen_name}}</span> </a> </li>');TEMPLATES["dialog/show_list_followers.item"]=Handlebars.compile('<li class="follower-item"> <a class="follower-item-content js-navigate" href="/library/{{username}}"> <span class="avatar"> <img src="{{profile_image}}" alt=""> </span> <span class="username">{{screen_name}}</span> </a> </li>');TEMPLATES["dialog/notify_beta"]=Handlebars.compile('<div class="dialog-header"> Welcome to the new Urlist! </div> <div class="dialog-content"> <dl class="form-item"> <dt class="column twelve"> <p class="description description--lead"> Dear <strong>{{screen_name}}</strong>, </p> <p class="description"> you are now using the new Urlist beta that gives you access to <strong>new features</strong>. Should you have any questions or suggestions, please contact the Urlist team. </p> </dt> </dl> </div> <div class="toolbar dialog-actions"> <ul class="nav right"> <li> <input class="button action js-url-save" type="submit" value="Got it!" /> </li> </ul> </div>');TEMPLATES["dialog/edit_url"]=Handlebars.compile('<div class="dialog-header"> Edit Link <a href="#" class="dialog-close js-dialog-close">&times;</a> </div> <div class="dialog-content"> <dl class="form-item"> <dt class="column three"> <label>Edit title</label> </dt> <dd class="column nine"> <input class="textfield" type="text" name="title" value="{{title}}"/> </dd> </dl> {{!url}} <dl class="form-item"> <dt class="column three"> <label>Comment</label> </dt> <dd class="column nine"> <span class="textarea-with-toolbar on-bottom"> <textarea class="simple-textarea js-simple-textarea" name="description" data-count="chars" data-count-limit="400" rel="description-counter" placeholder="Why is this link interesting?">{{description}}</textarea> <div class="toolbar"> <ul class="nav left"> <li class="secondary"> <span>* formatting with markdown is <span class="help-area"> <i class="click-me">possible</i> <cite class="tooltip-help"> Links are automatically hyperlinked. Use *for bold words* and **for italic words** </cite> </span> </span> </li> {{!<li><a class="button small" href="#">Add Image</a></li>}} </ul> <ul class="nav right"> {{! <li><span class="button small make-text-bold js-wrap-text-bold">Bold</span></li> <li><span class="button small make-text-italic js-wrap-text-italic">Italic</span></li> }} <li> <span class="counter-chars"><b id="description-counter">400</b> char</span> </li> </ul> </div> </span> </dd> </dl> {{!<label class="line form-item"> <span class="column three"> <span class="simple-label">Choose Section</span> </span> <span class="column nine"> <select class="simple-select wide" name="target-list-section"> { { #sections } } <option value="{ { section_id } }">{ { or title empty_title } }</option> { { /sections } } </select> </span> </label>}} </div> <div class="toolbar dialog-actions"> <ul class="nav left"> {{#if policies.remove_url}} <li> <a class="generic-action js-delete-url" href="#">Delete Link</a> </li> {{/if}} </ul> <ul class="nav right"> <li> <input class="button action js-url-save" type="submit" value="Save" /> </li> <li> <button class="button js-dialog-close js-cancel">Cancel</button> </li> </ul> </div>');TEMPLATES["dialog/delete_url"]=Handlebars.compile('<div class="dialog-header"> Delete Link <a href="#" class="dialog-close js-dialog-close">&times;</a> </div> <div class="dialog-content"> <dl class="form-item"> <dt class="column twelve"> <p class="description description--lead"> You\'re deleting <strong>{{title}}</strong>. This action cannot be undone. </p> </dt> </dl> </div> <div class="toolbar dialog-actions"> <ul class="nav right"> <li> <input class="button action js-url-save" type="submit" value="Delete" /> </li> <li> <button class="button js-dialog-close js-cancel">Cancel</button> </li> </ul> </div>');TEMPLATES["dialog/settings_list_sections"]=Handlebars.compile('<div class="dialog-header"> Edit sections <a href="#" class="dialog-close js-dialog-close">&times;</a> </div> <div class="dialog-content"> <dl class="form-item form-item--isolated"> <dt class="column nine"> <div class="textbox"> Remaining sections <b class="counter-remaining_sections js-counter-sections-left">{{sections_left}}</b> </div> </dt> <dd class="column three"> <a class="button widest js-add-section" href="#">Add section</a> </dd> </dl>   <dl class="form-item form-item--isolated"> <dt class="column twelve"> <ul class="reference-sections js-reference-sections"></ul> </dt> </dl> </div> <div class="toolbar dialog-actions"> <ul class="nav right"> <li> <input class="button action js-url-save" type="submit" value="Save" /> </li> <li> <button class="button js-dialog-close js-cancel">Cancel</button> </li> </ul> </div>');TEMPLATES["dialog/select_category"]=Handlebars.compile('<div class="dialog-content"> <div class="line form-item"> <a href="#" class="dialog-close js-dialog-close" style="top: -10px; right: -5px; z-index: 2">&times;</a> <p class="slogan" style="font-size: 28px">Pick <strong>1</strong> or <strong>2</strong> categories</p> </div> <div class="line form-item"> <div class="column twelve"> <ul class="line category-grid"> {{#all_categories}} <li class="column six category-item"> <input class="category-control" id="{{id}}" type="checkbox" name="category" value="{{id}}" {{checkedifeq ../categories id}}> <label class="media category-label js-legacy-category-label" for="{{id}}"> <span class="medium"> <img src="/static/assets/categories/category-{{slugify label}}.png" alt="" /> </span> <span class="content">{{label}}</span> </label> </li> {{/all_categories}} </ul> </div> </div> </div> <div class="toolbar dialog-actions"> <ul class="nav right"> <li> <input class="button action js-url-save {{#unless label_categories}}inactive{{/unless}}" {{#unless label_categories}}disabled{{/unless}} type="submit" value="Done" /> </li> </ul> </div>');TEMPLATES["dialog/settings_list_sections.delete"]=Handlebars.compile('<div class="dialog-header"> Delete Section <a href="#" class="dialog-close js-dialog-close">&times;</a> </div> <div class="dialog-content"> <dl class="form-item"> <dt class="column twelve"> <h5 class="question is--important">Are you sure to delete this Section?</h5> <p class="description"> You will delete also all the links in the section. <br> <strong>This action cannot be undone.</strong> </p> </dt> </dl> </div> <div class="toolbar dialog-actions"> <ul class="nav right"> <li> <input class="button action js-url-save" type="submit" value="Yes, delete" /> </li> <li> <button class="button js-dialog-close js-cancel">Cancel</button> </li> </ul> </div>');TEMPLATES["dialog/share_list_email"]=Handlebars.compile('<div class="dialog-header"> Share by email <a href="#" class="dialog-close js-dialog-close">&times;</a> </div> <div class="dialog-content"> <dl class="form-item form-item--prominent"> <dt class="column twelve"> <h5 class="information">Email <cite>{{title}}</cite> to your friends</h5> </dt> </dl> <div class="content-alert alert-error alert-small js-recipients-error hide"> Please check again the recipients\' emails </div> <dl class="form-item"> <dt class="column four"> <label>Email</label> </dt> <dd class="column eight"> <input class="textfield" type="text" name="emails" placeholder="Add emails separated by a comma" /> </dd> </dl> <dl class="form-item"> <dt class="column four"> <label>Message</label> </dt> <dd class="column eight"> <textarea class="js-simple-textarea" name="message" placeholder="I\'m sharing with you this list..."> I think you\'ll find these links very interesting! </textarea> </dd> </dl> </div> <div class="toolbar dialog-actions"> <ul class="nav right"> <li> <input class="button action js-url-save" type="submit" value="Send" /> </li> <li> <button class="button js-dialog-close js-cancel">Cancel</button> </li> </ul> </div>');
TEMPLATES["dialog/show_list_followers"]=Handlebars.compile('<div class="dialog-header"> {{title}} <a href="#" class="dialog-close js-dialog-close">&times;</a> </div> <div class="dialog-content" data-source="Dialog:follower"> <dl class="form-item"> <dt class="column twelve"> <ul class="follower-list js-followers"></ul> </dt> </dl> </div>');TEMPLATES["dialog/feedback"]=Handlebars.compile('<div class="dialog-header"> Leave a Feedback <a href="#" class="dialog-close js-dialog-close">&times;</a> </div> <div class="dialog-content"> <dl class="form-item form-item--alone form-item--prominent"> <div class="column twelve"> <h5 class="question">Suggestions? Complaints?</h5> <p>Tell us what you think about Urlist</p> </div> </dl> <dl class="form-item"> <dt class="column four"> <label>Your email address <i>(optional)</i></label> </dt> <dd class="column eight"> <input class="textfield" type="email" name="email" /> </dd> </dl> <dl class="form-item"> <dt class="column four"> <label>Your message</label> </dt> <dd class="column eight"> <textarea class="js-simple-textarea" name="message" placeholder="Dear Urlist..."></textarea> </dd> </dl> </div> <div class="toolbar dialog-actions"> <ul class="nav right"> <li> <input class="button action js-url-save" type="submit" value="Send" /> </li> <li> <button class="button js-dialog-close js-cancel">Cancel</button> </li> </ul> </div>');TEMPLATES["bookmarklet/bookmarklet"]=Handlebars.compile('<div class="dialog-content dialog-standalone"> <dl class="form-item form-item--alone form-item--nested list-link-area"> <label>Add link to</label> <div class="list-selector-bookmarklet js-list-selector"></div> </dl> <dl class="form-item form-item--alone"> <label>Link title</label> <input class="textfield" name="title" type="text" value="{{title}}" /> <span class="truncated-url">{{url}}</span> </dl> <div class="line form-item form-item--alone"> <label class="hidden">Description</label> <textarea class="simple-textarea" name="description" data-count="chars" data-count-limit="400" rel="description-counter" placeholder="Comment&hellip;">{{description}}</textarea> <div class="toolbar bookmarklet-status"> <ul class="nav right"> <li> <span class="counter-chars"><b id="description-counter">400</b> char</span> </li> </ul> </div> </div> </div> <div class="toolbar dialog-actions"> <ul class="nav right"> <li><input class="button action js-url-save" type="submit" value="Save" /></li> <li><button class="button js-dialog-close js-cancel">Cancel</button></li> </ul> </div>');TEMPLATES["bookmarklet/share"]=Handlebars.compile('<div class="dialog-content dialog-standalone"> <h4 class="bookmarklet-message">Link listed in <a target="_blank" href="/{{hash}}">{{title}}</a></h4> <p class="bookmarklet-share-actions"> <a class="button action" href="/{{hash}}" target="_blank">View the List</a> <a class="button js-share-twitter" href="#">Tweet Link</a> <a class="button js-share-facebook" href="#">Share on Facebook</a> </p> </div>');TEMPLATES["error/404"]=Handlebars.compile('<div class="error-404"> <h1>404 Page not found</h1> </div>');TEMPLATES["search/stats"]=Handlebars.compile('<div class="line content-std-elastic is--fluid beta-search-new" name=""> <h1 class="query">{{query}}</h1> <p class="result-log"> was found in <em><span class="cntr cntr-n-list">{{list_hits}}{{#if-equal list_hits 100}}+{{/if-equal}}</span> lists</em> and <em><span class="cntr cntr-n-link">{{urls_hits}}</span> links</em> </p> <a href="#" class="button save-search js-save-search">Save search</a> </div>');TEMPLATES["search/search"]=Handlebars.compile('<div class="page-beta_search clearfix" data-source="BetaSearch:main"> <div class="page-header"> <div class="js-stats-hook"></div> </div> <div class="page-actions"> <div class="content-std-elastic is--fluid"> <div class="toolbar js-toolbar"> <ul class="nav left nav--navigation"> <li data-location="me"><a href="/search/me/{{query}}" class="js-navigate">My Lists</a></li> <li data-location="network"><a href="/search/network/{{query}}" class="js-navigate">My Network</a></li> <li data-location="global"><a href="/search/{{query}}" class="js-navigate">Global</a></li> </ul> </div> </div> </div> <div class="content-full-elastic"> <div class="toolbar toolbar-changedisplay"> <ul class="nav center"> <li> <span class="input-switcher changedisplay-switcher js-changedisplay-switcher"> {{#if-equal scope "global"}} <a class="state state-a js-navigate" href="/search/{{query}}" data-location="lists">Lists</a> <a class="state state-b js-navigate" href="/search/{{query}}/links" data-location="links">Links</a> {{else}} <a class="state state-a js-navigate" href="/search/{{scope}}/{{query}}" data-location="lists">Lists</a> <a class="state state-b js-navigate" href="/search/{{scope}}/{{query}}/links" data-location="links">Links</a> {{/if-equal}} </span> </li> </ul> </div> <div class="js-widgets-hook"></div> </div> </div>');TEMPLATES["search/links"]=Handlebars.compile('<div class="search-result" data-source="Dashboard:search"> <div class="content-std-elastic is--fluid"> <ul class="search-result-items"> {{#withLinks}} <li class="result-item"> <span class="result-related-list">From <a href="/{{list_hash}}" class="list-title js-navigate">{{highlight ../stems list_title}}</a></span> <ul class="link-items"> {{#urls}} <li class="link-item"> <a href="/{{list_hash}}/{{url_hash}}" target="_blank"> <img class="link-favicon js-favicon" src="{{favicon}}" alt="" /> <span class="link-title">{{highlight ../../stems url_title}}</span> <span class="url-hostname">{{hostify url}}</span> </a> <p class="desc {{show-if url_description}}"> <span class="js-desc">{{highlight ../../stems url_description}}</span> </p> <a href="#" class="action-relist js-relist" data-listhash="{{list_hash}}" data-urlhash="{{url_hash}}"> <i class="mini-icon icon-midi-relist"></i></a> </li> {{/urls}} {{^urls}} <li class="empty-link-item"> No links matching. </li> {{/urls}} </ul> </li> {{/withLinks}} {{!<a href="#" class="button wide narrow">Load More&hellip;</a>}} </ul> </div> </div>');TEMPLATES["search/loadmore"]=Handlebars.compile('<span class="align-center load-more-links load-more-widgets js-loading"> <!-- <img src="/static/assets/useless/global-search.jpg" alt="" /> --> <i class="mini-icon icon-small-grid"></i> <span>');TEMPLATES["discovery/switcher"]=Handlebars.compile('<div class="content-std-elastic"> <div class="toolbar-changedisplay hide"> <span class="input-switcher changedisplay-switcher js-changedisplay-switcher"> <a class="state state-a active" href="#">Lists</a> <a class="state state-b" href="#">Links</a> </span> </div> </div>');TEMPLATES["discovery/follow"]=Handlebars.compile('{{^display_following}} <div class="content-std-elastic is--fluid"> <div class="discovery-claim"> <h1>Follow the <strong>best curators</strong> on Urlist</h1> <h4>Build your network of interest</h4> </div> </div> {{/display_following}} {{#display_following}} <div class="is-stickyarea"> <div class="content-std-elastic is--fluid"> <div class="discovery-claim discovery-stickyarea"> <div class="js-toggle"> <div class="js-toggle-one"> <h1>Follow <b>5</b> of the best curators</h1> </div> <div class="js-toggle-two"> <h1>Great!</h1> </div> </div> <div class="progressbar progressbar-5 js-progressbar" data-progress="{{following_users_count}}" data-total="5"> <div class="progressbar-total"></div> <div class="progressbar-value"></div> <a href="/discover/network" class="progressbar-result js-navigate">Go to my Network!</a> </div> </div> </div> </div> {{/display_following}} <div class="content-std-elastic is--fluid has-stickyarea" data-source="Discovery:network"> <div class="widget-wrapper clearifx" data-view="follow"></div> </div>');TEMPLATES["discovery/network"]=Handlebars.compile('{{#display_following}} <div class="content-std-elastic is--fluid" data-source="Discovery:onboardingnetwork"> <div class="empty-placeholder plain followmore"> <h3>It\'s dangerous to go alone!</h3> <p class="leading"> Follow <b>5</b> of the <b>best curators</b> to get new content daily </p> <a href="/discover/follow" class="button action wider js-navigate">Get started</a> </div> </div> {{/display_following}} {{#welcome}} <div class="content-std-elastic is--fluid js-welcome-message" data-source="Discovery:onboardingnetwork"> <div class="empty-placeholder plain followmore"> <h3>Welcome to Urlist</h3> <p class="leading"> This is your network, feel free to explore. <br> When you are done, check out <a href="/library/{{username}}" class="js-navigate">your profile</a>. </p> <a href="#" class="button action wider js-dismiss-welcome">OK</a> </div> </div> {{/welcome}} {{#has_following}} <div class="content-std-elastic is--fluid"> <div class="toolbar toolbar-changedisplay"> <ul class="nav center"> <li> <span class="input-switcher changedisplay-switcher js-changedisplay-switcher"> <a class="state state-a active js-navigate" href="/discover/network">Lists</a> <a class="state state-b js-navigate" href="/discover/network/links">Links</a> </span> </li> </ul> </div> </div> {{/has_following}} <div class="content-full-elastic clearfix" data-source="Discovery:network"> <div class="widget-wrapper clearfix" data-view="network"></div> </div>');TEMPLATES["discovery/layout"]=Handlebars.compile('<div class="discovery-page" data-view="discovery" data-source="Discovery"> <h1 class="hidden">Discover</h1> {{!<div class="page-header"> <div class="content-std-elastic is--fluid"> <h1 class="page-title">Discover</h1> </div> </div>}} <div class="page-actions"> <div class="content-std-elastic is--fluid"> <div class="toolbar js-toolbar"> <ul class="nav left nav--navigation"> {{#LOGGED}} <li class="network"><a href="/" class="js-navigate">My Network</a></li> {{/LOGGED}} {{#LOGGED}} <li class="follow"><a href="/discover/follow" class="js-navigate"><i class="mini-icon icon-small-add-user"></i> Follow more</a></li> {{/LOGGED}} {{#ANON}} <li class="follow"><a href="/discover/follow" class="js-navigate"><i class="mini-icon icon-small-add-user"></i> Build your network</a></li> {{/ANON}} {{#LOGGED}} <li class="js-activity"> <a class="has-bdg js-navigate" href="/activity"> Activity <b class="bgd-notif-length js-pending-counter" data-count="{{notifications_amount}}"> </b> </a> </li> {{/LOGGED}} </ul> {{!<ul class="nav right nav--navigation"> <li> <span> <a href="#" class="button narrow js-share-page"> <i class="mini-icon icon-small-share"></i> Recommend </a> </span> </li> </ul>}} </div> </div> </div> <div class="discover--category-grid js-slide"> <div class="content-std-elastic is--fluid"> <a class="discover--category-item discover--category-trigger js-slide--trigger" href="/category/science-nature"> <span class="item-content"> <img class="item-image" src="/static/assets/_cats/view-more.png" alt=""> <span class="item-label">More</span> </span> </a> <ul class="discover--category-list"> <li class="discover--category-item"> <a class="item-content js-navigate" href="/discover"> <img class="item-image" src="/static/assets/_cats/popular.png" alt=""> <span class="item-label">Popular</span> </a> </li> <li class="discover--category-item"> <a class="item-content js-navigate" href="/category/technology"> <img class="item-image" src="/static/assets/_cats/technology.png" alt=""> <span class="item-label">Technology</span> </a> </li> <li class="discover--category-item"> <a class="item-content js-navigate" href="/category/education"> <img class="item-image" src="/static/assets/_cats/education.png" alt=""> <span class="item-label">Education</span> </a> </li> <li class="discover--category-item"> <a class="item-content js-navigate" href="/category/information-media"> <img class="item-image" src="/static/assets/_cats/information-media.png" alt=""> <span class="item-label">Information &amp; Media</span> </a> </li> <li class="discover--category-item"> <a class="item-content js-navigate" href="/category/passions-hobbies"> <img class="item-image" src="/static/assets/_cats/passions-hobbies.png" alt=""> <span class="item-label">Passions &amp; Hobbies</span> </a> </li> <li class="discover--category-item"> <a class="item-content js-navigate" href="/category/culture-arts"> <img class="item-image" src="/static/assets/_cats/culture-arts.png" alt=""> <span class="item-label">Culture &amp; Arts</span> </a> </li> <li class="discover--category-item"> <a class="item-content js-navigate" href="/category/business"> <img class="item-image" src="/static/assets/_cats/business.png" alt=""> <span class="item-label">Business</span> </a> </li> <li class="discover--category-item"> <a class="item-content js-navigate" href="/category/science-nature"> <img class="item-image" src="/static/assets/_cats/science-nature.png" alt=""> <span class="item-label">Science &amp; Nature</span> </a> </li> <li class="discover--category-item"> <a class="item-content js-navigate" href="/category/society-politics"> <img class="item-image" src="/static/assets/_cats/society-politics.png" alt=""> <span class="item-label">Society &amp; Politics</span> </a> </li> <li class="discover--category-item"> <a class="item-content js-navigate" href="/category/cooking"> <img class="item-image" src="/static/assets/_cats/cooking.png" alt=""> <span class="item-label">Cooking</span> </a> </li> <li class="discover--category-item"> <a class="item-content js-navigate" href="/category/controversial"> <img class="item-image" src="/static/assets/_cats/controversial.png" alt=""> <span class="item-label">Controversial</span> </a> </li> <li class="discover--category-item"> <a class="item-content js-navigate" href="/category/places"> <img class="item-image" src="/static/assets/_cats/places.png" alt=""> <span class="item-label">Places</span> </a> </li> <li class="discover--category-item"> <a class="item-content js-navigate" href="/category/activism"> <img class="item-image" src="/static/assets/_cats/activism.png" alt=""> <span class="item-label">Activism</span> </a> </li> <li class="discover--category-item"> <a class="item-content js-navigate" href="/hashtag/bitcoin"> <img class="item-image" src="/static/assets/_cats/tag.png" alt=""> <span class="item-label">#bitcoin</span> </a> </li> <li class="discover--category-item"> <a class="item-content js-navigate" href="/hashtag/javascript"> <img class="item-image" src="/static/assets/_cats/tag.png" alt=""> <span class="item-label">#javascript</span> </a> </li> <li class="discover--category-item"> <a class="item-content js-navigate" href="/hashtag/dev"> <img class="item-image" src="/static/assets/_cats/tag.png" alt=""> <span class="item-label">#dev</span> </a> </li> {{!<li class="discover--category-item"> <a class="item-content js-navigate" href="/hashtag/contribute"> <img class="item-image" src="/static/assets/_cats/tag.png" alt=""> <span class="item-label">#contribute</span> </a> </li>}} </ul> </div> </div> <div class="discovery-content clearfix" data-view="content"></div> </div>');TEMPLATES["discovery/main"]=Handlebars.compile('{{#ANON}} {{!<div class="message message-bar discovery-messagebar"> <p class="content-std-elastic"> Urlist is awesome, you should sign up. <a href="#" class="button action wider js-signup">Signup</a> </p> </div>}} {{/ANON}} <div class="discovery-heading" data-source="Discovery:popular"> <div class="content-std-elastic is--fluid"> <h3>Popular</h3> </div> </div> <div class="content-std-elastic is--fluid"> <div class="widget-wrapper last {{#ANON}}not-logged{{/ANON}}" data-view="popular"></div> </div> {{#ANON}} <div class="discovery-bannercta-signup"> <div class="content-std-elastic is--fluid"> <p>Start organizing your surfing in a clever way! <a href="#" class="button action wider js-signup">Learn More</a></p> </div> </div> {{/ANON}}');TEMPLATES["widget/people.author"]=Handlebars.compile('<span class="avatar author"><img src="{{profile_image}}" alt="{{screen_name}}" /></span>');TEMPLATES["widget/url"]=Handlebars.compile('<div class="widget widget-card card-link"> <div class="author-badge js-author"> <a href="#" class="medium avatar js-navigate"> <img src="{{profile_image}}" alt=""> </a> <div class="content author-details"> <h6 class="username"><a href="#" class="js-navigate js-username">Username</a></h6> <time class="timestamp">{{pretty_date}} ago</time> </div> </div> <h3 class="title"> <a href="/{{list_hash}}/{{url_hash}}" class="{{!js-navigate}}" target="_blank">{{url_title}}</a> </h3> <h5 class="hostname"><img class="favicon js-favicon" src="{{or favicon \'/static/assets/def-favicon.png\'}}" alt="" /> {{host}}</h5> <small class="indicator-relist {{show-if relist_amount}} js-has-tooltip" title="Relisted Link" data-tooltip></small> <p class="description js-note {{show-if description}}"> {{{html_description}}} </p> <div class="toolbar card-toolbar"> <ul class="nav left"> <li> <span> <span class="reference-list-index"> <b class="js-index-current">{{position}}</b> of <b class="js-index-total">{{list_links_amount}}</b> </span> <span class="reference-list">in <a href="/{{list_hash}}">{{list_title}}</a></span> </span> </li> </ul> <ul class="nav right"> <li> <a class="button wide card-action js-relist" href="#">Relist</a> </li> </ul> </div> </div>');TEMPLATES["widget/draft"]=Handlebars.compile('<ul class="link-list"> {{#urls}} <li class="link-item"> <a class="link-anchor grid" href="{{url}}"> <span class="link-anchor-title"> <img class="link-favicon" src="{{or favicon \'/static/assets/def-favicon.png\'}}" /> <b>{{title}}</b> </span> <span class="link-anchor-time">{{creation_time}}</span> </a> </li> {{/urls}} </ul>');TEMPLATES["widget/profile"]=Handlebars.compile('<div class="slide"> <div class="widget widget-card card-profile"> <a href="/library/{{username}}" class="avatar js-navigate"><img src="{{profile_image}}" alt=""></a> <h4 class="screenname"> <a href="/library/{{username}}" class="js-navigate">{{username}}</a> </h4> <ul class="stat-list"> <li class="stat-item highlighted"><b class="counter-list-n">{{lists_amount}}</b> Lists</li> <li class="stat-item"><b class="counter-link-n">{{links_amount}}</b> Links</li> </ul> <div class="card-action-main"> <a href="#" class="button action wider follow-user js-user-follow" href="#"> <i class="mini-icon icon-small-add-user"></i> Follow </a> </div> </div> <div class="cardlist-shield"></div> <a href="#" class="cardlist-user-follow js-trigger-user-follow"> <span class="label-follow"> <i class="maxi-icon icon-small-add-user"></i> Follow </span> <span class="label-following"> <i class="giga-icon icon-small-agree"></i> <span class="hidden">Following!</span> </span> </a> <div class="cardlist-user-following"></div> <div data-view="lists"></div> </div>');TEMPLATES["widget/people.contributor"]=Handlebars.compile('<span class="avatar"><img src="{{profile_image}}" alt="{{screen_name}}" /></span>');TEMPLATES["widget/loadmore"]=Handlebars.compile('<a href="#" class="button load-more-links load-more-widgets js-load-more">Show more</a>');TEMPLATES["widget/chart"]=Handlebars.compile('<ul class="link-list"> {{#urls}} <li class="link-item"> {{crop title 70}} </li> {{/urls}} </ul>');TEMPLATES["widget/common"]=Handlebars.compile('<div class="widget-content"> <p class="category-header js-list-categories {{show-if label_categories}}"> {{label_categories}} </p> <div class="widget-preheader"> <figure></figure> <div class="toolbar widget-info"> <div class="js-widget-people"></div> </div> {{^is_secret}} <a class="action-share-list js-share-list" href="#">Share List</a> {{/is_secret}} {{#is_updated}} <div class="ac-status-change js-has-tooltip" title="Recently updated" data-tooltip></div> {{/is_updated}} </div> <a class="widget-link js-navigate" href="/{{hash}}"> <h3 class="title js-list-title"> {{#is_secret}} <i class="mini-icon icon-small-padlock js-is-secret"></i> {{/is_secret}} {{title}} </h3> {{#details}} {{#if description}} <p class="description js-list-description"> {{{crop description 240}}} </p> {{/if}} {{/details}} <div class="sublist"> </div> </a> <div class="toolbar widget-toolbar"> <ul class="nav left"> <li> <span><b>{{urls_amount}}</b> link{{plural urls_amount}}</span> </li> {{#IF-ADMIN}} {{!<li> <a class="js-edit-categories" href="#"><i class="mini-icon icon-small-settings"></i> Edit</a> </li>}} {{/IF-ADMIN}} </ul> <ul class="nav right"> <li> {{#if policies.contribute}} <div class="widget-actions"> {{#if policies.edit_list}} {{#if to_migrate}} <a class="button wide widget-action make-public-list js-migrate-list" href="#">Make Public!</a> <span class="button wide widget-action hide">Awesome! &hearts;</span> {{else}} <a class="button wide widget-action js-edit-list" href="#">Edit List</a> {{/if}} {{else}} <a class="button wide widget-action js-edit-contributors" href="#">Invite</a> {{/if}} </div> {{else}} <a class="widget-actions {{#following}}status-following{{/following}}"> <span class="button wide widget-action follow-list js-follow-list" href="#">Add to Library</span> <span class="button wide widget-action following-list js-unfollow-list" href="#">In your Library</span> <span class="button wide widget-action unfollow-list js-unfollow-list" href="#">Remove</span> </a> {{/if}} </li> </ul> </div> </div>');TEMPLATES["widget/reference"]=Handlebars.compile('<ul class="section-list"> {{#sections}} <li class="section-item"> <span class="label {{color}}"></span> {{or title empty_title}} </li> {{/sections}} </ul>');TEMPLATES["widget/people"]=Handlebars.compile('<ul class="nav left" style="overflow: hidden"> <li class="authors"> <span class="user {{#hide-if-gt contributors_amount 0}}hide{{/hide-if-gt}}"> By <a class="screenname js-screenname js-navigate" href="#">{{screenname}}</a> </span> <span class="followers {{hide-if contributors_amount 0}}"> <i class="mini-icon icon-small-users"></i> By <a class="screenname js-screenname js-navigate" href="#">{{screenname}}</a> <b>+{{contributors_amount}}</b> </span> </li> </ul>');TEMPLATES["welcome/get_bookmarklet"]=Handlebars.compile('<div class="category-onboarding-header"> <div class="wrapper"> <h4 class="title">Get the <strong>Urlist Button</strong></h4> <div class="pagination-next"> <a href="#" class="button">Next &raquo;</a> </div> </div> </div> <div class="content-std-elastic is--fluid"> <div class="onboarding-step onboarding-step--get-bookmarklet"> <h2 class="subtitle"><strong>Save links faster</strong> than the <strong>speed of light!</strong></h2> <a href="#bookmarkletCodeHere" class="button confirm button-bookmarklet-todrag">Drag this on your <strong>Bookmarks Bar</strong></a> <p><img class="image-showcase" src="/static/assets/resources/onboarding/step-bookmarklet/showcase-bookmarklet.jpg" alt=""></p> </div> </div>');TEMPLATES["welcome/suggest_users"]=Handlebars.compile('<div class="category-onboarding-header"> <div class="wrapper"> <h4 class="title">Find <strong>Friends</strong></h4> <div class="pagination-next"> <a href="#" class="button js-next">Next &raquo;</a> </div> </div> </div> <div class="content-std-elastic is--fluid"> <div class="content-onboarding-suggest_users js-toggle {{#facebook_username}}js-switch{{/facebook_username}}"> <div class="suggest-connect hide js-show-connect"> <a href="{{facebook_url}}" class="button button-facebook--onboarding">Connect with <span>Facebook</span></a> <p class="notice"> <strong>No spam,</strong> no automatic posting on your wall! </p> </div> <div class="js-show-invite"> <ul class="user-list--onboarding"> {{#to_follow}} <li class="user-item"> <figure class="avatar"><img src="{{profile_image}}" alt=""></figure> <label class="screenname">{{screen_name}}</label> <a class="follow-actions {{#following}}is--active{{/following}}" href="#" data-user_id="{{user_id}}"> <span class="button action button-action action--follow    js-follow-user">Follow!</span> <span class="button        button-action action--following js-unfollow-user">Following</span> </a> </li> {{/to_follow}} {{#invite}} <li class="user-item"> <figure class="avatar"><img src="{{profile_image}}" alt=""></figure> <label class="screenname">{{screen_name}}</label> <a class="follow-actions {{#following}}is--active{{/following}}" href="#" data-facebook_id="{{facebook_id}}"> <span class="button button-action action--follow    js-invite-user">Invite</span> <span class="button button-action action--following js-unfollow-user">Invited</span> </a> </li> {{/invite}} </ul> </div> </div> </div>');TEMPLATES["welcome/complete_profile"]=Handlebars.compile('<div class="category-onboarding-header"> <div class="wrapper"> <h4 class="title">Complete <strong>Your Profile</strong></h4> <div class="pagination-next"> <a href="#" class="button js-next">Next &raquo;</a> </div> </div> </div> <div class="content-std-elastic is--fluid"> <div class="onboarding-step onboarding-step--complete-profile"> {{!content--complete-profile}} {{! Avatar }} <fieldset class="complete-profile-line"> <figure class="avatar js-profile-image-container"> <img src="{{profile_image}}" class="js-profile-image" alt=""> </figure> <form action="{{api_root}}api/user/profile-image" method="post" target="submit-profile-picture" enctype="multipart/form-data"> <h5 class="subheader">Profile Picture</h5> <p class="details">PNG, GIF or JPG. Max size of 700K</p> <a href="#" class="button small button--upload js-upload">Upload Picture</a> <span class="js-upload-name"></span> <input class="js-upload-real hide" type="file" accept="image/*" name="profile-image" /> <iframe class="hide js-submit-profile-picture" name="submit-profile-picture"></iframe> </form> </fieldset> <br><br> {{! Screen Name }} <fieldset class="complete-profile-line"> <dl class="form-item"> <dt class="column three"> <label>Name</label> </dt> <dd class="column nine"> <input class="textfield js-screen-name" type="text" name="screen_name" value="{{screen_name}}" placeholder="Your profile name" data-validator="not-empty" /> </dd> </dl> </fieldset> {{! Username (only once) }} <fieldset class="complete-profile-line"> <dl class="form-item"> <dt class="column three"> <label>Username</label> </dt> <dd class="column nine"> <div class="grid"> <div class="column" style="width:46%"> <label>http://urli.st/library/</label> </div> <div class="column seven" style="width:54%"> <input class="textfield js-username" type="text" name="username" value="{{username}}" data-validator="not-empty" placeholder="username" /> </div> </div> </dd> </dl> </fieldset> {{! Short Bio }} <fieldset class="complete-profile-line"> <dl class="form-item"> <dt class="column three"> <label>Short Bio</label> </dt> <dd class="column nine"> <input class="textfield" type="text" placeholder="Tell us why you are awesome! (max 80 chars)" name="short_bio" value="{{short_bio}}" maxlength="80" /> </dd> </dl> </fieldset> <fieldset class="complete-profile-line"> <a href="#" class="button button-save js-next">Save</a> <a href="{{facebook_url}}" class="button button-facebook js-facebook-complete">Complete with Facebook in 1 click</a> </fieldset> <p class="reminder"> <b>*Do not include any sensitive information</b> (phone number, bank account number, etc.) in these boxes. </p> </div> </div>');TEMPLATES["welcome/pick_categories"]=Handlebars.compile('<div class="category-onboarding-header"> <div class="wrapper"> <h4 class="title">Pick up your favorite Categories</h4> <div class="pagination-next"> <a href="#" class="button inactive js-next">Next &raquo;</a> </div> </div> </div> <div class="content-std-elastic is--fluid"> <ul class="category-onboarding-grid"> {{#all_categories}} <li class="category-onboarding-item js-legacy-category-label"> <input class="control" id="{{id}}" type="checkbox" name="category" value="{{slug}}"> <label class="content" for="{{id}}"> <figure class="thumbnail"> <img src="/static/assets/onboarding/pick_categories/category-{{slugify label}}.png?v=1" alt="" /> </figure> <span class="label">{{label}}</span> </label> </li> {{/all_categories}} </ul> </div>');TEMPLATES["navigation/url"]=Handlebars.compile('<li class="link-item {{active}}"> <a href="{{url}}" class="js-navigate"> {{title}} </a> </li>');TEMPLATES["navigation/sidebar"]=Handlebars.compile('<div class="js-nav-sidebar"> <span class="stat-current js-nav-current">{{current}}</span> of <span class="stat-total js-nav-total">{{total}}</span> <h5 class="link-title"> <a class="link-external" href="{{url}}" target="_blank">View</a> {{title}} </h5> <div class="link-info"> By <a href="" class="author js-navigate js-author"></a> </div> <p class="link-description"> {{{html_description}}} </p> <div class="link-actions-section clearfix"> {{#if policies.share_list}} <ul class="link-share"> {{!<li class="email"><a class="js-share-by-email" href="#">Share by Email</a></li>}} <li class="twitter"><a class="js-share-on-twitter" href="#">Share by Twitter</a></li> <li class="facebook"><a class="js-share-on-facebook" href="#">Share by Facebook</a></li> <li class="gplus"><a class="js-share-on-google" href="#">Share by Google+</a></li> </ul> <span class="link-share-label">Share Link</span> {{/if}} </div> <div class="link-list link-list-{{type}} js-urls {{type}}"> </div> </div>');TEMPLATES["navigation/main"]=Handlebars.compile('<div class="navigation-page js-nav" data-source="Navigation"> <div class="toolbar top-bar js-header-navigation"> <ul class="nav left context"> {{#LOGGED}} <li> <a class="back-to-list js-close-navigation js-navigate" href="/{{hash}}">Back to list</a> </li> {{#if policies.edit_url}} <li> <a class="button-inline js-edit-url" href="#" title="Edit Link" data-tooltip data-position="bottom"><i class="icon icon-edit-small"></i></a> </li> {{/if}} <li> <a href="#" class="button-inline js-relist" title="Relist this Link"><i class="icon icon-mini-relist"></i> Relist this</a> </li> {{/LOGGED}} </ul> <nav class="control-list"> <a href="#" class="control-item control-item--prev js-nav-prev js-navigate">Prev</a> <span class="control-item js-open-details"> <span class="counter-current js-nav-current">{{current}}</span> of <span class="counter-total js-nav-total">{{total}}</span> </span> <a href="#" class="control-item control-item--next js-nav-next js-navigate">Next</a> </nav> <ul class="nav right context"> {{#LOGGED}} <li> <span> <a class="open-details active js-nav-title" href="#"> <span class="label">Loading...</span> <i class="icon icon-mini-url"></i> </a> </span> </li> {{/LOGGED}} {{#ANON}} <li> <span> <b class="prominent">From <a class="js-close-navigation js-navigate" href="/{{hash}}">{{title}}</a></b> </span> </li> <li> <span> <a href="/{{hash}}" class="button button-faux is--small is--wider button-bookmark-list js-navigate js-close-navigation"> Discover more <i class="mini-icon context icon-small-share"></i> </a> </span> </li> {{/ANON}} </ul> </div> <div class="embed-frame js-embed"> </div> <div class="navigation-sidebar js-nav-sidebar-placeholder hide"></div> </div>');TEMPLATES["urlist/section.loadmore"]=Handlebars.compile('<a href="#" class="load-more-links ui-load-more"><b>{{left}}</b> More link{{plural left}}</a>');TEMPLATES["urlist/summary.item"]=Handlebars.compile('<a href="#{{title_slug}}" class="section-1"> <span class="label-section"></span> {{or title empty_title}} <span class="secondary-label"> <b class="counter js-index-urls-counter">{{urls_amount}}</b> link{{plural urls_amount}} </span> </a>');TEMPLATES["urlist/people.author"]=Handlebars.compile('<a class="author-badge js-navigate" href="/library/{{username}}"> <span class="avatar"> <img src="{{profile_image}}" alt="{{screen_name}}" /> </span> <span class="author-info"> <span class="screenname js-navigate" href="/library/{{username}}">{{screen_name}}</span> <span class="desc"> <span class="author-lists-counter"><b>{{lists_amount}}</b> lists</span> <span class="author-links-counter"><b>{{links_amount}}</b> links</span> </span> </span> </a> {{#if short_bio}} <p class="short-bio"> {{crop short_bio 80}} </p> {{/if}} <!-- {{#unless short_bio}} <p class="short-bio"> Tell something about you, write a short bio. <a class="button button-inline small js-navigate" href="/settings" title="Go to the Settings Page">Add</a> </p> {{/unless}} -->');TEMPLATES["urlist/url.relist.item"]=Handlebars.compile('<li class="relist-item"> <span class="actor-avatar"> <img src="{{profile_image}}" alt="" /> </span> <a class="actor-username js-navigate" href="/library/{{username}}">{{screen_name}}</a> relisted in <a class="relist-target js-navigate" href="/{{hash}}">{{title}}</a> </li>');
TEMPLATES["urlist/comments"]=Handlebars.compile('<div class="toolbar toolbar-secondary"> <ul class="nav left regular"> <li class="js-toggle {{#unless comments_amount}}js-switch{{/unless}}"> <span class="js-toggle-one"> <i class="icon-comment-small-grey small"></i> <b class="comments-counter js-comments-amount">{{comments_amount}}</b> Comment{{plural comments_amount}} </span> <span class="js-toggle-two"> <i class="icon-comment-small-grey small"></i> Add your comment! </span> </li> </ul> </div> <div class="divider-wide"></div> <div class="line"> <div class="column twelve"> <ul class="comments js-comments"> <li class="line comment comment-new js-comment-new"> {{#LOGGED}} {{#if policies.add_comment}} <div class="column one"> <div class="avatar"> <img src="{{CURRENT \'user\' \'profile_image\'}}" alt="" /> </div> </div> <div class="column nine"> <textarea class="comment-edit" placeholder="Write your comment&hellip;" name="comment"></textarea> </div> <div class="column two"> <a class="button wide js-add-comment" href="#">Comment</a> </div> {{/if}} {{/LOGGED}} {{#ANON}} <p>Please <a href="#" class="js-signup">sign up</a> to comment</p> {{/ANON}} </li> <!-- end .comment.new --> </ul> <a href="#" class="button small wide js-load-more hide">load more</a> </div> <!-- end .column.twelve --> </div> <!-- end .line -->');TEMPLATES["urlist/url.relist"]=Handlebars.compile('<div class="relist-log" data-source="List:relist"> <ul class="js-relists relist-list"> </ul> </div>');TEMPLATES["urlist/comments.item"]=Handlebars.compile('<li class="line comment js-comment"> <div class="column one"> <div class="avatar"> <img class="js-author-avatar" src="" alt="" /> </div> </div> <div class="column nine"> <div class="comment-bubble"> <a class="comment-author js-navigate js-author" href="#">Username</a> <div class="comment-date">{{pretty_date}}</div> {{#if can_delete}} <a class="comment-delete js-delete-comment" href="#">delete</a> {{/if}} <p class="comment-text"> {{{html_comment}}} </p> </div> </div> <div class="column two"></div> </li> <!-- end .comment -->');TEMPLATES["urlist/summary"]=Handlebars.compile('<div class="list-summary"> {{#if policies.add_section}} <p class="summary-caption"> <a href="#" class="button button-faux is--small is--embedded js-edit-sections">Edit Sections</a> </p> {{/if}} <ul class="list-summary-list js-section-list"></ul> </div>');TEMPLATES["urlist/url.relist.original"]=Handlebars.compile('<li class="relist-item relist-item-author"> <span class="actor-avatar"> <img src="{{profile_image}}" alt="" /> </span> <a class="actor-username js-navigate" href="/library/{{username}}">{{screen_name}}</a> originally listed in <a class="relist-target js-navigate" href="/{{hash}}">{{title}}</a> </li>');TEMPLATES["urlist/categories"]=Handlebars.compile('{{#each categories}} <li class="list_category-item"> <a class="js-navigate" href="/category/{{slugify this}}">{{this}}</a> {{!<span class="ctn ctn-category-n">1234</span>}} </li> {{/each}}');TEMPLATES["urlist/url.common"]=Handlebars.compile('<li class="link-item js-url-item clearfix {{appendiftrue is_updated "ac-status-change"}} {{#if _status}}status-{{_status}}{{/if}}" data-cid="{{cid}}" data-hash="{{hash}}"> <div class="link-content"> {{#if policies.sort_list}} <div class="drag-handle ui-drag-handle"></div> {{/if}} <a class="url-title js-url-title" href="/{{list_hash}}/{{hash}}" target="_blank">{{title}}</a> <div class="note js-note {{show-if description}}"> <p class="note-text js-text"> {{{html_description}}} </p> </div> <div class="toolbar small link-toolbar"> <ul class="nav left context"> <li> <span class="url-favicon"> <img class="js-favicon" src="{{or favicon \'/static/assets/def-favicon.png\'}}" alt="" /> </span> </li> <li> <span class="url-hostname">{{host}}</span> </li> {{#by_contributor}} <li> <span class="url-author">by <a href="/library/{{user_id}}" class="js-url-author js-navigate">{{user_id}}</a></span> </li> {{/by_contributor}} <li class="secondary {{show-if relist_amount}}"> <a class="show-relist js-toggle-relist" href="#"> {{#if from_user_id}} <span class="msg-relist"> <i class="tiny-icon tiny-icon-relist"></i> {{relist_amount}} relist{{plural relist_amount}} </span> from <span class="js-relist-author relist-subject"> </span> {{else}} <span class="msg-relist"> <i class="tiny-icon tiny-icon-relist"></i> {{relist_amount}} relist{{plural relist_amount}} </span> {{/if}} </a> </li> <li class="{{show-if relist_amount}}"> <a class="show-relist-action js-toggle-relist js-toggle" href="#"> <span class="js-toggle-one">view&hellip;</span> <span class="js-toggle-two">close</span> </a> </li> </ul> </div> <div class="toolbar small link-actions"> <ul class="nav right actions"> {{#if policies.edit_url}} <li> <a href="#" class="js-edit"><i class="mini-icon icon-midi-more"></i> <span>Edit</span></a> </li> {{/if}} {{#if policies.edit_url}} <li><a class="js-move-url" href="#"><i class="mini-icon icon-midi-move"></i> <span>Move</span></a></li> {{/if}} {{#if policies.share_list}} <li class="primary"><a class="js-relist" href="#"><i class="mini-icon icon-midi-relist"></i> <span>Relist</span></a></li> {{/if}} </ul> </div> <div class="relist-container js-relist-container"> </div> </div> </li> <!-- end .link-item -->');TEMPLATES["urlist/empty_section"]=Handlebars.compile('<li class="link-item--placeholder js-empty-placeholder"> {{#IF-NEWBIE}} <p>Now start adding great links! Or <a href="/resources/button" class="js-navigate">get the Urlist button</a> to add links while browsing.</p> {{else}} <p>No links here</p> {{/IF-NEWBIE}} </li>');TEMPLATES["urlist/section"]=Handlebars.compile('<div id="{{title_slug}}" class="{{#unless urls_amount}}{{#unless policies.add_url}}hide {{/unless}}{{/unless}}link-group ui-urls-section {{type}}-section-{{id}}" data-cid="{{cid}}"> <div class="link-group-header"> <span class="section-title js-section-title">{{or title empty_title}}</span> <span class="section-link-amount"><span class="js-section-link-amount">{{urls_amount}}</span> {{pluralize urls_amount "link"}}</span> {{#if policies.add_section}} <a class="section-edit js-edit-sections" href="#">Edit</a> {{/if}} </div> <div class="section-content link-group-actions clearfix"> {{#if policies.add_url}} <form class="sub-add-url ui-sub-add-url"> <label> <input class="ui-add-link-txt" type="text" placeholder="http://" /> <input type="submit" class="button" value="Add" /> </label> </form> {{/if}} </div> <ul class="list-items ui-urls {{#unless policies.add_url}}list-items-no-add{{/unless}}" data-section_id="{{section_id}}"> </ul> </div>');TEMPLATES["urlist/list"]=Handlebars.compile('<div class="list-page-container"> <div class="list-content clearfix"> <div class="list-page {{appendiftrue has_sections \'list-show-sections\'}}" data-source="List"> {{#if policies.accept_url}} {{#if suggested_urls}} <div class="message message-box"> You have <span class="highlight"><b class="cnt cnt-suggestion-n">{{len suggested_urls}}</b> suggestions</span> waiting <a href="#" class="button action wider js-suggested-links">View all!</a> </div> {{/if}} {{/if}} <div class="head {{#cover_image}}head--custom{{/cover_image}}"> <div class="head-cover-container"> <img class="head-cover js-head-cover" src="{{cover_image}}?v={{slugify cover_image_v}}" alt="" > </div> <div class="head-inner js-header-inner"> <div class="cover-container"> <canvas id="imageCanvas" class="cover-canvas" width="738" height="280"></canvas> <div class="cover-instructions"> <div class="text">Drag the image to reposition</div> </div> </div> <div class="cover-loader"></div> <div class="toolbar toolbar-list_action_set"> {{#if policies.update_cover }} <ul class="nav left context"> <li> <a href="#" class="button small list-change-cover js-toggle-menu"> Change Cover </a> <div class="dropdown dropdown--floating"> <ul class="menu-list"> <li class="ac-list-upload-cover"><a class="js-list-upload-cover" href="#">Upload image</a></li> <li><a class="js-search-image" href="#">Search on Flickr</a></li> <li><a class="js-image-upload-url" href="#">Add from link</a></li> <li class="divider"></li> <li><a class="js-list-delete-cover" href="#">Delete Cover</a></li> </ul> </div> </li> </ul> <input class="hidden js-upload-cover_input" type="file" accept="image/*" id="coverUploader" name="coverUploader"/> {{/if}} {{#is_secret}} <ul class="nav right context status-secret-list js-is-secret"> <li><span><i class="mini-icon icon-small-private"></i> Unpublished List</span></li> </ul> {{/is_secret}} </div> <div class="toolbar list-info hide"> </div> <div class="list-main-info"> <h1 class="list-title js-list-title">{{title}}</h1> </div> <p class="list-description js-list-description {{show-if description}}"> {{{html_description}}} </p> </div> <!-- / .head-inner --> <div class="toolbar subheader"> <div class="js-toggle js-toggle--edit_cover"> <div class="js-toggle-one"> <ul class="nav left"> <li><span></span></li> <li> <span class="list-header-stat"> <b class="counter-big js-urls-counter">{{urls_amount}}</b> link{{plural urls_amount}} </span> </li> <li> <span class="list-header-stat"> <b class="counter-big counter-views">{{views_amount}}</b> view{{plural views_amount}} </span> </li> <li class="js-list-followers js-show-followers {{show-if followers_amount}}"> <a class="list-header-stat list-header-stat-followers" href="#"> in <b class="js-list-followers-counter counter-big">{{followers_amount}}</b> Libraries </a> </li> </ul> <ul class="nav right"> {{#unless policies.add_url}} <li> <span> <a class="button action suggest-link js-suggest-link-add" href="#"> <i class="mini-icon icon-small-add"></i> Suggest a Link </a> </span> </li> {{/unless}} <li> <span> {{#if policies.edit_list}} <a class="button edit-this-list js-edit-list" href="#"><i class="mini-icon icon-small-settings"></i> Edit</a> {{/if}} </span> </li> </ul> </div> <div class="js-toggle-two"> <ul class="nav center"> <li><a class="button js-upload-cover_close" href="#">Discard</a></li> <li><a class="button action js-upload-cover_save" href="#">Confirm</a></li> </ul> </div> </div> </div> {{#if policies.add_url}} <div class="js-summary"></div> {{else}} {{#if links_amount}} <div class="js-summary"></div> {{/if}} {{/if}} </div> <!-- / .head --> <div class="add-url-area ui-urls-sections"></div> {{#unless policies.add_url}} {{#unless links_amount}} <div class="empty-placeholder js-empty-placeholder"> <p>No links yet! <br /> <b>Add to Library</b> to get updates :)</p> </div> {{/unless}} {{/unless}} {{#if policies.add_section}} <a class="add-section js-add-section" href="#">+ Add Section</a> {{/if}} {{#if links_amount}} <a class="right report-list js-report-list" href="#">Report List</a> {{/if}} <br><br> {{!<div id="comment-area"></div>}} </div> <!-- end .list-page[.list-show-sections] --> <div class="sidebar" style="" data-source="List:sidebar"> <div class="people clearfix"></div> <ul class="action_list-list"> {{#if policies.follow_list}} <li class="action_list-item"> <a href="#" class="bookmark-this-list ac--object js-list-actions {{#following}}is--done{{/following}}"> <span class="ac--todo bookmark-do js-follow-list"> <i class="mini-icon icon-small-bookmark"></i> <span class="label">Subscribe</span> </span> <span class="ac--doing bookmark-doing js-unfollow-list"> <i class="mini-icon icon-small-library"></i> <span class="label">In your Library</span> </span> <span class="ac--undo bookmark-undo js-unfollow-list"> <i class="mini-icon icon-small-remove-block"></i> <span class="label">Unsubscribe</span> </span> </a> </li> {{/if}} {{#if policies.share_list}} <li class="action_list-item"> <a class="js-share-list" href="#"> <i class="mini-icon icon-small-share"></i> <span class="label">Share</span> </a> </li> <li class="action_list-item"> <a class="js-embed-list" href="#"> <i class="mini-icon icon-small-embed"></i> <span class="label">Embed on Blog</span> </a> </li> {{/if}} <li class="action_list-item"> <a class="js-play-list" href="/{{hash}}/" target="_blank"> <i class="mini-icon icon-small-play"></i> <span class="label">Play</span> </a> </li> {{#if policies.share_list}} <li class="action_list-item"> <label for="clip"><i class="mini-icon icon-small-link"></i></label> <input id="clip" type="text" class="textfield-seamless js-for-clipboard" value="http://urli.st/{{hash}}" readonly> </li> {{/if}} </ul> <h5 class="subheader js-categories-subheader">Categories</h5> <ul class="list_category-list js-list_category-list"></ul> <div class="feedback-section js-feedback-container hide"> <div class="feedback-container"> <p>We’d love to hear what <br> you think, help us making <br> Urlist awesome</p> <div class="js-feedback-status"> <span class="js-toggle-one"> <a class="button wide button-leave-feedback js-leave-feedback" href="#">Leave a feedback!</a> </span> <span class="js-toggle-two hide"> <span class="feedback-success">Thank you!</span> </span> </div> </div> </div> <h5 class="subheader js-categories-subheader">Related Lists</h5> <h5 class="subheader js-popular-subheader hide">Popular Lists</h5> <div class="js-urlists-suggestion" data-source="List:suggestion"></div> <div class="app-footer"> <h6 class="company-info">Copyright 2013 Urlist srl</h6> <ul class="plain-menu"> <li><a class="js-navigate" href="/resources/about">About Us</a></li> <li><a class="js-navigate" href="/resources/jobs">Jobs</a></li> <li><a class="js-navigate" href="/resources/privacy">Privacy Policies</a></li> <li><a class="js-navigate" href="/resources/terms">Terms of Service</a></li> <li><a class="js-navigate" href="/resources/button">Urlist-it Button</a></li> <li><a href="http://blog.urli.st">Blog</a></li> <li><a href="//facebook.com/urlist" target="_blank">Facebook</a></li> <li><a href="//twitter.com/urlist" target="_blank">Twitter</a></li> <li><a class="js-navigate" href="/resources/help"><b>Urlist Basics</b></a></li> </ul> </div> </div> <!-- end .sidebar --> </div> <!-- end .list-page --> {{#ANON}} <div class="discovery-bannercta-signup"> <div class="content-std-elastic"> <p>Start organizing your surfing in a clever way! <a href="#" class="button action wider js-signup">Learn More</a></p> </div> </div> {{/ANON}} </div> <!-- end .list-page-container -->');TEMPLATES["urlist/people.contributor"]=Handlebars.compile('<li class="contributor-item {{#if-equal status \'pending\'}}pending{{/if-equal}} js-contributor" data-user-id="{{user_id}}"> <a class="contributor-avatar js-navigate" href="/library/{{username}}" title="{{screen_name}} {{#if-equal status \'pending\'}}(invite sent){{/if-equal}}"> <!-- <img src="{{profile_image}}" alt="{{screen_name}}" /> --> <img src="{{profile_image}}" alt="{{screen_name}}" /> </a> </li>');TEMPLATES["urlist/people"]=Handlebars.compile('<div class="content-author ui-author"> </div> <div class="toolbar contributors-actions js-contributors-container {{show-if contributors-amount}}"> <ul class="nav left"> <li> <span>Contributors (<b class="counter-contributors js-contributors-count">{{contributors_amount}}</b>)</span> </li> </ul> </div> <div class="contributors-area"> <ul class="collaborators-list contributors-list clearfix js-contributors js-contributors-list"></ul> {{#if policies.add_contributor}} <a href="#" class="button small wide edit-contributors js-edit-contributors"> Invite Contributors </a> {{/if}} </div> {{! <div class="toolbar contributors-actions js-other-contributors-container { { show-if other-contributors-amount } }"> <ul class="nav left"> <li> <span>Contributors (<b class="counter-contributors">other_contributors_amount</b>)</span> </li> </ul> </div> <div class="contributors-area"> <ul class="collaborators-list contributors-list clearfix js-other-contributors js-other-contributors-list"></ul> </div> }}');TEMPLATES["embed/vimeo"]=Handlebars.compile('<div class="resource-section js-resource-section"> <div class="resource-container"> <h3 class="resource-title"> <span> {{title}} </span> </h3> <iframe class="resource-item vimeo-player" src="http://player.vimeo.com/video/{{video_id}}" width="640" height="385" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen> </iframe> <p class="resource-info"> <a class="resource-origin" href="#"> <img src="{{favicon}}" alt /> {{url}} </a> </p> </div> </div>');TEMPLATES["embed/iframe"]=Handlebars.compile('<iframe class="js-embed-iframe" src="{{url}}" border="0"></iframe>');TEMPLATES["embed/amazon"]=Handlebars.compile('<div class="resource-section js-resource-section"> <div class="resource-container"> <div class="line content-full-elastic resource-content resource-content--amazon"> {{#if remote.large_image}} <div class="column four"> <div class="medium"> <img src="{{remote.large_image}}" alt="" /> </div> </div> {{/if}} <div class="column {{#if remote.large_image}}eight{{/if}}"> <div class="content-info"> <h3 class="resource-title"> {{title}} </h3> {{#if remote.formatted_author}} <p class="resource-author">by <b class="resource-author_reference">{{remote.formatted_author}}</b></p> {{/if}} <div class="toolbar resource-focus"> <ul class="nav left"> <li> <span> {{#if remote.formatted_price}} <span class="pricetag">From <b>{{remote.formatted_price}}</b></span> {{else}} <span class="pricetag">Price not available</span> {{/if}} </span> </li> </ul> <ul class="nav right"> <li> <span> <a class="button" href="{{url}}" target="_blank">View on Amazon</a> </span> </li> </ul> </div> {{#if description}} <p class="resource-description"> <b>Comment</b> {{description}} <cite class="resource-description_author"> By <a href="/library/{{author.attributes.username}}" class="js-navigate">{{author.attributes.screen_name}}</a> </cite> </p> {{/if}} </div> </div> </div> </div> </div>');TEMPLATES["embed/youtube"]=Handlebars.compile('<div class="resource-section js-resource-section"> <div class="resource-container"> <h3 class="resource-title"> <span> {{title}} </span> </h3>  <iframe class="resource-item youtube-player" type="text/html" width="640" height="385" src="http://www.youtube.com/embed/{{video_id}}?wmode=opaque&autoplay=1&start={{start}}" allowfullscreen frameborder="0"> </iframe> <p class="resource-info"> <a class="resource-origin" href="{{url}}" target="_blank"> <img src="{{favicon}}" alt /> {{url}} </a> </p> </div> </div>');TEMPLATES["embed/soundcloud"]=Handlebars.compile('<div class="resource-section js-resource-section"> <div class="resource-container"> <h3 class="resource-title"> <span> {{title}} </span> </h3> <div class="resource-content resource-content--soundcloud"> {{{html}}} </div> <p class="resource-info"> <a class="resource-origin" href="{{url}}" target="_blank"> <img src="{{favicon}}" alt /> {{url}} </a> </p> </div> </div>');TEMPLATES["embed/__not_embeddable"]=Handlebars.compile('<div class="resource-section js-resource-section"> <div class="resource-container"> <h4 class="resource-message-main"> Oops! </h4> <p class="resource-message"> Looks like we cannot play this link :( <a class="button wide button-open" href="{{url}}" target="_blank">Open Link in a new tab</a> </p> </div> </div>');TEMPLATES["notification/follow_user.mini"]=Handlebars.compile('<li class="notification-item{{^read_at}} new{{/read_at}}"> <a class="js-navigate" href="/library/{{username}}"> <b class="sender">{{user_screen_name}}</b> <span class="action">started following you</span> <time class="timestamp">{{prettydate sent_at}}</time> </a> </li>');TEMPLATES["notification/bookmark_list"]=Handlebars.compile('<li class="indepth-notification-item{{^read_at}} new{{/read_at}}"> <div class="notification-content new-bookmark"> <a href="/library/{{username}}" class="sender js-navigate">{{user_screen_name}}</a> <span class="action">bookmarked</span> <a href="/{{data.list_hash}}" class="target js-navigate">{{data.list_title}}</a> </div> <ul class="action-toolbar"> <li> <small class="timestamp">{{prettydate sent_at}}</small> </li> </ul> </li>');TEMPLATES["notification/suggest_url.mini"]=Handlebars.compile('<li class="notification-item"> <a class="js-navigate" href="/{{data.list_hash}}"> <b class="sender">{{user_screen_name}}</b> <span class="action">suggested you to add the link</span> <b class="object">{{data.suggested_title}}</b> <span class="complement">to</span> <b class="target">{{data.list_title}}</b> <time class="timestamp">{{prettydate sent_at}}</time> </a> </li>');TEMPLATES["notification/contrib_request.mini"]=Handlebars.compile('<li class="notification-item{{^read_at}} new{{/read_at}}"> <a class="js-navigate" href="/{{data.list_hash}}"> <b class="sender">{{user_screen_name}}</b> <span class="action">invited you to add links to</span> <b class="target">{{data.list_title}}</b> <time class="timestamp">{{prettydate sent_at}}</time> </a> </li>');TEMPLATES["notification/suggested_url_accept.mini"]=Handlebars.compile('<li class="notification-item"> <a class="js-navigate" href="/{{data.list_hash}}"> <b class="sender">{{user_screen_name}}</b> <span class="action">accepted your link</span> <b class="object">{{decodeURIComponent data.suggested_url}}</b> <span class="complement">to</span> <b class="target">{{data.list_title}}</b> <time class="timestamp">{{prettydate sent_at}}</time> </a> </li>');TEMPLATES["notification/add_url"]=Handlebars.compile('<li class="indepth-notification-item{{^read_at}} new{{/read_at}}"> <div class="notification-content new-link"> <a href="/library/{{username}}" class="sender js-navigate">{{user_screen_name}}</a> <span class="action">added the link</span> <a href="/{{data.list_hash}}/{{data.url_hash}}" class="object" target="_blank">{{data.url_title}}</a> <span class="complement">to</span> <a href="/{{data.list_hash}}" class="target js-navigate">{{data.list_title}}</a> </div> <ul class="action-toolbar"> <li> <small class="timestamp">{{prettydate sent_at}}</small> </li> </ul> </li>');TEMPLATES["notification/follow_user"]=Handlebars.compile('<li class="indepth-notification-item{{^read_at}} new{{/read_at}}"> <div class="notification-content new-follower"> <a href="/library/{{username}}" class="sender js-navigate">{{user_screen_name}}</a> <span class="action">started following you</span> </div> <ul class="action-toolbar"> <li> <small class="timestamp">{{prettydate sent_at}}</small> </li> </ul> </li>');TEMPLATES["notification/relist_url"]=Handlebars.compile('<li class="indepth-notification-item{{^read_at}} new{{/read_at}}"> <div class="notification-content new-relist"> <a href="/library/{{username}}" class="sender js-navigate">{{user_screen_name}}</a> <span class="action">relisted</span> <a href="/{{data.from_list_hash}}/{{data.url_hash}}" class="object js-navigate">{{data.url_title}}</a> <span class="complement">to</span> <a href="/{{data.list_hash}}" class="target js-navigate">{{data.list_title}}</a> </div> <ul class="action-toolbar"> <li> <small class="timestamp">{{prettydate sent_at}}</small> </li> </ul> </li>');TEMPLATES["notification/relist_url.mini"]=Handlebars.compile('<li class="notification-item{{^read_at}} new{{/read_at}}"> <a class="js-navigate" href="/{{data.list_hash}}"> <b class="sender">{{user_screen_name}}</b> <span class="action">relisted</span> <b class="object">{{data.url_title}}</b> <span class="complement">to</span> <b class="target">{{data.list_title}}</b> <time class="timestamp">{{prettydate sent_at}}</time> </a> </li>');TEMPLATES["notification/contrib_request"]=Handlebars.compile('<li class="indepth-notification-item js-request{{^read_at}} new{{/read_at}}" data-request-id="{{data.notification_id}}"> <div class="notification-content new-contributor-request"> <a href="/library/{{username}}" class="sender js-navigate">{{user_screen_name}}</a> <span class="action">invited you to add links to</span> <a href="/{{data.list_hash}}" class="target js-navigate">{{data.list_title}}</a> </div> <ul class="action-toolbar js-action-toolbar"> {{#unless status}} <li> <a href="#" class="button action js-accept-request">Accept</a> </li> <li> <a href="#" class="button js-decline-request">Decline</a> </li> {{/unless}} <li> <small class="timestamp">{{prettydate sent_at}}</small> </li> </ul> </li>');TEMPLATES["notification/suggest_url"]=Handlebars.compile('<li class="indepth-notification-item{{^read_at}} new{{/read_at}}"> <div class="notification-content new-link-request"> <a href="/library/{{username}}" class="sender js-navigate">{{user_screen_name}}</a> <span class="action">suggested you to add the link</span> <a href="{{data.suggested_url}}" class="target" target="_blank">{{decodeURIComponent data.suggested_url}}</a> <span class="complement">to</span> <a href="/{{data.list_hash}}" class="target js-navigate">{{data.list_title}}</a> </div> <ul class="action-toolbar"> <li> <small class="timestamp">{{prettydate sent_at}}</small> </li> </ul> </li>');TEMPLATES["notification/suggested_url_accept"]=Handlebars.compile('<li class="indepth-notification-item"> <div class="notification-content new-link-request"> <a href="/library/{{username}}" class="sender js-navigate">{{user_screen_name}}</a> <span class="action">accepted your link</span> <a href="{{data.suggested_url}}" class="target" target="_blank">{{decodeURIComponent data.suggested_url}}</a> <span class="complement">in</span> <a href="/{{data.list_hash}}" class="target js-navigate">{{data.list_title}}</a> </div> <ul class="action-toolbar"> <li> <small class="timestamp">{{prettydate sent_at}}</small> </li> </ul> </li>');TEMPLATES["notification/bookmark_list.mini"]=Handlebars.compile('<li class="notification-item{{^read_at}} new{{/read_at}}"> <a class="js-navigate" href="/{{data.list_hash}}"> <b class="sender">{{user_screen_name}}</b> <span class="action">bookmarked</span> <b class="target">{{data.list_title}}</b> <time class="timestamp">{{prettydate sent_at}}</time> </a> </li>');TEMPLATES["notification/add_url.mini"]=Handlebars.compile('<li class="notification-item{{^read_at}} new{{/read_at}}"> <a class="js-navigate" href="/{{data.list_hash}}"> <b class="sender">{{user_screen_name}}</b> <span class="action">added a link to</span> <b class="target">{{data.list_title}}</b> <time class="timestamp">{{prettydate sent_at}}</time> </a> </li>');model.Search=ul.bbext.Model.extend({idAttribute:"query",urlRoot:API_ROOT+"search?q={0}&scope={1}",url:function(){return this.urlRoot.format(encodeURIComponent(this.id),this.get("scope"))},isReady:function(){return this.has("results")},getUrlists:function(){return new collection.Urlists(_.map(this.toJSON().results,function(r){return{hash:r.list_hash}}),{sort:false})},parse:function(response){response.stems=response.stemmed_query.split(" ");response.withLinks=_.filter(response.results,function(r){return r.urls.length>0});return response}});model.Comment=ul.bbext.Model.extend({idAttribute:"comment_id",initialize:function(attributes,options){this.calculated(this.htmlComment,"html_comment",this)},parseDefaults:function(){return{user_id:C.get("user").get("user_id"),creation_time:(new Date).toUTCISOString()}},parse:function(response){_.defaults(response,_.result(this,"parseDefaults"));response.author=new model.User({user_id:response.user_id});return response},htmlComment:function(){return mdma(this.get("comment"))}});model.Category=ul.bbext.Model.extend({name:"model.Category",urlRoot:API_ROOT+"list-by-categories",idAttribute:"id",initialize:function(){this.calculated(this.fullUrl,"full_url",this)},isReady:function(){return this.has("lists")},getSlug:function(){return slugify(this.get("name"))},getId:function(){if(this.get("id"))return this.get("id");return _.find(UL.CATEGORIES,function(e){return e.slug==this.get("name")},this).id},url:function(){var u=this.urlRoot+"/"+this.getId();if(this.has("sort")){u=addParamToUrl(u,"sort",this.get("sort"))}if(this.has("network")){u=addParamToUrl(u,"network",this.get("network"))}return u},fullUrl:function(){return UL.config.origin+"/category/"+this.get("name")},toTweet:function(){return"A lot of great lists about #{0}: {1}".format(this.get("name"),this.fullUrl())},parse:function(response){response=ul.util.kato(response,"lists","hash");response.lists=new collection.Urlists(response.lists,{sort:false});response.slug=slugify(this.get("name"));return response}});model.User=ul.bbext.Model.extend({name:"model.User",mbFetch:true,mbAction:"fetch-user",mbKey:"user_id",idAttribute:"user_id",isReady:function(){return this.has("username")},urlRoot:API_ROOT+"user",url:function(){if(this.has("username"))return this.urlRoot+"/"+this.get("username");return this.urlRoot+"/"+this.id},parse:function(response){if(response.screen_name===""){response.screen_name=response.username}return response}});(function(){UrlistModel=ul.bbext.Model.extend({name:"model.Urlist",mbFetch:true,mbAction:"fetch-list",mbKey:"list_hash",urlRoot:API_ROOT+"list",idAttribute:"hash",initialize:function(){this.calculated(this.isMine,"is_mine",this);this.calculated(this.getFollowersAmount,"followers_amount",this);this.calculated(this.getLabelCategories,"label_categories",this);this.calculated(this.getCategories,"categories_by_name",this);this.calculated(this.getContributorsAmount,"contributors_amount",this);this.calculated(this.getOtherContributorsAmount,"other_contributors_amount",this);this.calculated(this.toMigrate,"to_migrate",this);this.calculated(this.isUpdated,"is_updated",this);this.calculated(this.htmlDescription,"html_description",this);this.calculated(this.getPolicies,"policies",this);this.calculated(this.getNotesAmount,"notes_amount",this);this.calculated(this.getUrlsAmount,"urls_amount",this);this.calculated(this.hasSections,"has_sections",this);this.calculated(this.getSectionsAmount,"sections_amount",this);this.calculated(this.fullUrl,"full_url",this);this.calculated(this.getSlug,"slug",this)},parse:function(response){var contributors=[];var authors=_.uniq(_.union([response.user_id],_.pluck(response.contributors,"user_id")));var others=_.uniq(_.pluck(response.urls,"user_id"));var other_contributors=_.map(_.difference(others,authors),function(u){return{user_id:u}});response.author=new model.Profile({user_id:response.user_id});response.userauthor=new model.User({user_id:response.user_id});response.contributors=new collection.Contributors(response.contributors,{parse:true});response.other_contributors=new collection.Users(other_contributors,{parse:true});for(var i=0;i<response.urls.length;i++)response.urls[i].by_contributor=response.urls[i].user_id!=response.user_id;response.urls=new collection.Urls(response.urls,{parse:true,urlist:this});response.followers=new collection.Users(response.followers);response.comments=new collection.Comments(response.comments,{parse:true});var sections=new collection.Sections;sections.reset(response.sections,{urlist:this,urls:response.urls,sections:sections});response.sections=sections;response.categories=response.categories||[];response.__load_time=new Date;return response},superOld:function(){this.set("__load_time",-1)},getFollowersAmount:function(){return this.get("followers").length},getLabelCategories:function(){return this.getCategories().join(", ")},getCategories:function(){return _.map(this.get("categories",[]),function(c){return UL.CATEGORIES[c].label})},age:function(update){if(update!=undefined){this.set("__load_time",new Date);return}var ut=this.get("__load_time"),delta;if(ut==-1)return 24*60*1e3;if(!ut)return 0;delta=(new Date).getTime()-ut.getTime();return delta},hasUrl:function(url){return this.get("urls").where({url:url}).length>0},getUrlByHash:function(urlHash){return this.get("urls").get(urlHash)},isReady:function(){return this.has("urls")},removeUrl:function(url){var urlsCollection=this.get("urls");urlsCollection.remove(url);this.message("remove-url",{hash:url.get("hash")})},changeTitle:function(title){this.set("title",title);this.enqueue("change-title",{title:title})},changeDescription:function(description){this.set("description",description);this.enqueue("change-description",{description:description})},lastPositionForSection:function(sectionPosition){return this.get("sections").chain().first(sectionPosition).map(function(e){return e.getLocalUrls()}).flatten().map(function(e){return e.get("position")}).max().value()||1},firstPositionForSection:function(sectionPosition){},getContributorsAmount:function(){return this.get("contributors").length+this.get("other_contributors").length
},getOtherContributorsAmount:function(){return this.get("contributors").length+this.get("other_contributors").length},getNotesAmount:function(){var amount=0;this.get("urls").each(function(url){url.get("description")!==undefined&&amount++});return amount},getUrlsAmount:function(){return this.get("urls").length},hasSections:function(){return this.get("sections").length>1},getSectionsAmount:function(){return this.get("sections").length},getPolicies:function(){return helpers.generatePolicy("urlist",C.get("user"),this)},isMine:function(){return C.get("user").get("user_id")==this.get("user_id")},isUpdated:function(){var at,lv,me,delta;at=this.get("last_action_time");lv=this.get("last_visit");me=this.get("last_action_id")==C.get("user").get("user_id");if(me||!at||!lv)return;at=new Date(at);lv=new Date(lv);delta=parseInt((at.getTime()-lv.getTime())/1e3);return delta>-10},toMigrate:function(){return this.get("is_secret")&&this.get("creation_time")<"2013-03-10T22:30:00"},toCategorize:function(){return C.get("user").getMyListsCount()>1&&!this.get("is_secret")&&this.isMine()&&!this.get("categories").length},toJoin:function(){return this.get("contributors").where({user_id:C.get("user").get("user_id"),status:"pending"}).length==1},htmlDescription:function(){return mdma(this.get("description"),true)},canEdit:function(){return this.get("can_edit_list")},fullUrl:function(){return UL.config.origin+"/"+this.get("hash")},getSlug:function(){var prefix=this.get("hash")+"-";return decodeURI(this.get("slug").replace(prefix,""))},toTweet:function(){var url=this.fullUrl(),settings=this.get("settings");var charleft=140-url.length+2;var head=this.get("title");if(head.length>charleft){head=this.get("title").substr(0,charleft-1)+"…"}return'"{0}" {1}'.format(head,url)}});ul.register("model.Urlist",UrlistModel)})();model.Profile=ul.bbext.Model.extend({name:"model.Profile",urlRoot:API_ROOT+"profile",idAttribute:"username",initialize:function(){this.calculated(this.isMine,"is_mine",this);this.calculated(this.getMyListsCount,"my_lists_count",this);this.calculated(this.getFollowingListsCount,"following_lists_count",this);this.calculated(this.getFollowingUsersCount,"following_users_count",this);this.calculated(this.getFollowedByUsersCount,"followed_by_users_count",this);this.calculated(this.hasFacebook,"has_facebook",this);this.calculated(this.hasTwitter,"has_twitter",this);this.calculated(this.progressNum,"progress_num",this);this.calculated(this.progressTot,"progress_tot",this)},ABGroup:function(){var id=this.get("origin_id")||this.get("user_id"),group=parseInt(id.substr(id.length-1),16)%2;return group?"A":"B"},progressNum:function(){var num=parseInt(this.progressTot()-this.get("progress").length);return num},progressTot:function(){var tot=4;return tot},hasTwitter:function(){return this.get("twitter_username")!==""},hasFacebook:function(){return this.get("facebook_username")!==""},isAnonymous:function(){return!!this.get("is_anonymous")},isReady:function(){return this.has("lists")},progressPercentage:function(){var total=4;var progress=this.get("progress").length;var missing=total-progress;return Math.round(missing*100/total)},isMine:function(){return C.get("user").get("user_id")==this.get("user_id")},isNewbie:function(){return this.getMyListsCount()==0},getListsByMe:function(){return this.get("lists").where({user_id:C.get("user").get("user_id")})},getMyListsCount:function(){return this.attributes["lists"].length},getFollowingListsCount:function(){return this.attributes["followed_lists"].length},getFollowingUsersCount:function(){return this.attributes["following_users"].length},getFollowedByUsersCount:function(){return this.attributes["followed_by_users"].length},url:function(){if(this.has("username"))return this.urlRoot+"/"+this.get("username");return this.urlRoot+"/"+this.get("user_id")},parse:function(response){if(response.secret_lists_left<0){response.secret_lists_left=0}response.progress=response.progress||[];response.saved_searches=new collection.SavedSearches(response.saved_searches);response.followed_by_users=new collection.Users(response.followed_by_users);response.following_users=new collection.Users(response.following_users);response.lists=new collection.Urlists(response.lists);response.followed_lists=new collection.Urlists(response.followed_lists);response.original_screen_name=response.screen_name;if(response.screen_name===""){response.screen_name=response.username}return response}});model.SavedSearch=ul.bbext.Model.extend({name:"model.SavedSearch",idAttribute:"search_id"});model.Discovery=ul.bbext.Model.extend({name:"model.Discovery",url:API_ROOT+"discovery",isReady:function(){},parse:function(response){var reduceFeat=function(list){return _.reduce(list,function(memo,l){l.is_featured&&memo.push(l.hash);return memo},[])};var reduceHash=function(list){return _.reduce(list,function(memo,l){memo.push({hash:l.hash});return memo},[])};var top_lists_featured;top_lists_featured=reduceFeat(response.top_lists);response.top_lists=new collection.Urlists(reduceHash(response.top_lists));response.top_lists.featured=top_lists_featured;response.popular=new collection.Urlists(reduceHash(response.popular));response.network=new collection.Urlists(reduceHash(response.network));return response}});model.DiscoveryPopular=ul.bbext.Model.extend({name:"model.DiscoveryPopular",key:"model.DiscoveryPopular",url:API_ROOT+"popular",isReady:function(){return this.has("lists")},parse:function(response){response.lists=new collection.Urlists(response.lists,{sort:false});return response}});model.DiscoveryNetwork=ul.bbext.Model.extend({name:"model.DiscoveryNetwork",url:API_ROOT+"network/~",isReady:function(){return this.has("lists")},parse:function(response){response.lists=new collection.Urlists(response.lists,{sort:false});return response}});model.DiscoveryNetworkUrls=ul.bbext.Model.extend({name:"model.DiscoveryNetworkUrls",url:API_ROOT+"network/~/url",isReady:function(){return this.has("urls")},parse:function(response){response.urls=new collection.Urls(response.urls,{sort:false,parse:true});return response}});model.DiscoveryTopUsers=ul.bbext.Model.extend({name:"model.DiscoveryTopUsers",key:"model.DiscoveryTopUsers",url:API_ROOT+"topusers",isReady:function(){return this.has("users")},parse:function(response){response.users=new collection.Profiles(response.users);return response}});model.Section=ul.bbext.Model.extend({idAttribute:"section_id",initialize:function(attrs,options){this.urlist=options.urlist;this.urls=options.urls;this.calculated(this.getTitleSlug,"title_slug",this);this.calculated(this.getUrlsAmount,"urls_amount",this);this.calculated(this.getCid,"cid",this);this.set("empty_title","Section {0}".format(this.get("position")))},getLocalUrls:function(){return this.urls.where({section:this.id})},getTitleSlug:function(){var title=this.get("title")?this.get("title"):this.get("empty_title");return slugify(title,"section-{0}-".format(this.get("position")))},getUrlsAmount:function(){return this.getLocalUrls().length},getCid:function(){return this.cid},prevSection:function(){var rs=this.sections.where({position:this.get("position")-1});if(rs.length>0)return rs[0]},nextSection:function(){var rs=this.sections.where({position:this.get("position")+1});if(rs.length>0)return rs[0]}});model.Settings=ul.bbext.Model.extend({name:"model.Settings",urlRoot:API_ROOT+"user"});model.Hashtag=ul.bbext.Model.extend({urlRoot:API_ROOT+"hashtag",idAttribute:"id",initialize:function(){this.calculated(this.fullUrl,"full_url",this)},isReady:function(){return this.has("lists")},getSlug:function(){return slugify(this.get("hashtag"))},url:function(){var u=this.urlRoot+"/"+slugify(this.get("hashtag"));if(this.has("sort")){u=addParamToUrl(u,"sort",this.get("sort"))}if(this.has("network")){u=addParamToUrl(u,"network",this.get("network"))}return u},fullUrl:function(){return UL.config.origin+"/hashtag/"+this.get("hashtag")},toTweet:function(){return"A lot of great lists about #{0}: {1}".format(this.get("hashtag"),this.fullUrl())},parse:function(response){response=ul.util.kato(response,"lists","hash");response.lists=new collection.Urlists(response.lists,{sort:false});response.slug=slugify(this.get("hashtag"));return response}});model.PendingNotification=ul.bbext.Model.extend({name:"model.PendingNotification",idAttribute:"notification_id"});model.Notifications=ul.bbext.Model.extend({url:function(){return API_ROOT+"/notifications?t="+Math.random()},isReady:function(){return this.has("notifications")},getAmount:function(){if(this.isReady())return _.filter(this.get("notifications"),function(n){return!n.read_at}).length;else return 0},parse:function(response){response.notifications=response.notifications||[];var onlyRequests=_.filter(response.notifications,function(n){return n.subject=="contrib_request"&&!n.status});response.pending=new collection.PendingNotifications(onlyRequests);response.total=response.pending.length;return response}});model.Landing=ul.bbext.Model.extend({name:"model.Landing",idAttribute:"key",url:API_ROOT+"landing",isReady:function(){return this.has("key")},parse:function(response){var reduceFeat=function(list){return _.reduce(list,function(memo,l){l.is_featured&&memo.push(l.hash);return memo},[])};var reduceHash=function(list){return _.reduce(list,function(memo,l){memo.push({hash:l.hash});return memo},[])};var lists_featured;lists_featured=reduceFeat(response.lists);response.lists=new collection.Urlists(reduceHash(response.lists));response.lists.featured=lists_featured;return response}});(function(){UrlModel=ul.bbext.Model.extend({idAttribute:"hash",defaults:{title:"Untitled link"},parseDefaults:function(){return{user_id:C.get("user").get("user_id"),title:"Loading...",creation_time:(new Date).toUTCISOString()}},initialize:function(attributes,options){this.listenTo(this.collection,"add delete destroy move",this.updatePosition);this.calculated(this.getCid,"cid",this);this.calculated(this.getPolicies,"policies",this);this.calculated(this.getListHash,"list_hash",this);this.calculated(this.htmlDescription,"html_description",this);this.calculated(this.getHost,"host",this);this.calculated(this.isUpdated,"is_updated",this);this.calculated(this.timeAgo,"time_ago",this);this.calculated(this.prettyDate,"pretty_date",this)},htmlDescription:function(){return mdma(this.get("description"))},updatePosition:function(){if(this.collection)this.set("position",this.collection.indexOf(this)+1)},getCid:function(){return this.cid},getPolicies:function(){return helpers.generatePolicy("urlist",C.get("user"),this.getUrlist())},getFullUrl:function(){return"/{0}/{1}".format(this.getUrlist().get("hash"),this.get("hash"))},getHost:function(){var parsed=parseUri(this.get("url"));return parsed.host.replace(/^www\./,"")},getUrlist:function(){return new ul.model.Urlist({hash:this.getListHash()})},getListHash:function(){return this.get("list_hash")},needsFavicon:function(){return this.has("hash")&&!this.get("favicon")},isUpdated:function(){return this.timeAgo()>-60},prettyDate:function(){var ct=new Date(this.get("creation_time")).getTime(),now=(new Date).getTime(),offset=(now-ct)/1e3,unit="s";if(offset>60){offset/=60;unit="m";if(offset>60){offset/=60;unit="h";if(offset>24){offset/=24;unit="d";if(offset>60){offset=null}}}}if(offset)return"{0}{1}".format(parseInt(offset),unit);else return"time"},timeAgo:function(){var ct,lv,me,delta;ct=this.get("creation_time");lv=this.getUrlist().get("last_visit");me=this.get("user_id")==C.get("user").get("user_id");if(me||!ct||!lv)return;ct=new Date(ct);lv=new Date(lv);delta=parseInt((ct.getTime()-lv.getTime())/1e3);return delta},isReady:function(){return true},parse:function(response){_.defaults(response,_.result(this,"parseDefaults"));var user_id=response.user_id;response.title=_.get(response,"title");if(response.title=="")response.title=null;response.description=_.get(response,"description")||"";response.author=new model.User({user_id:user_id});if(response.from_user_id){response.relistedFromAuthor=new model.User({user_id:response.from_user_id})}return response},fullUrl:function(){return UL.config.origin+"/{0}/{1}".format(this.get("list_hash"),this.get("hash"))},toTweet:function(){var url=this.fullUrl(),settings=this.get("settings");var charleft=140-url.length+2;var head=this.get("title");if(head.length>charleft){head=this.get("title").substr(0,charleft-1)+"…"}return'"{0}" {1}'.format(head,url)}});ul.register("model.Url",UrlModel)})();model.FacebookFriends=ul.bbext.Model.extend({urlRoot:API_ROOT+"facebook-friends",isReady:function(){return this.has("follow")},parse:function(response){response.to_follow=_.where(response.follow,{is_following:false});response.following=_.where(response.follow,{is_following:true});return response}});model.Contributor=ul.bbext.Model.extend({idAttribute:"user_id",defaults:{status:"pending"},fetch:function(){var user=this.get("user");return user.fetch.apply(user,arguments)},isReady:function(){return this.get("user").isReady()},toJSON:function(){var json=this.get("user").toJSON();return _.extend(json,_.clone(this.attributes))},parse:function(response){response.user=new model.User({user_id:response.user_id});return response}});collection.Comments=ul.bbext.Collection.extend({model:model.Comment,comparator:function(a,b){return a.get("created_at")<b.get("created_at")?1:-1}});collection.Urlists=ul.bbext.Collection.extend({model:ul.model.Urlist,comparators:{noop:function(x,y){return 0},rank:function(x,y){return x.get("rank")<y.get("rank")?1:-1},lastUpdated:function(x,y){return x.get("last_action_time")<y.get("last_action_time")?1:-1},lastCreated:function(x,y){return x.get("creation_time")<y.get("creation_time")?1:-1}},comparator:function(x,y){return this.comparators.lastUpdated(x,y)},filterByUser:function(user_id){return new collection.Urlists(this.where({user_id:user_id}))},filterOutUser:function(user_id){return new collection.Urlists(_.filter(this.models,function(m){return m.attributes.user_id!=user_id}))}});collection.Contributors=ul.bbext.Collection.extend({model:model.Contributor});collection.Users=ul.bbext.Collection.extend({model:model.User});collection.Sections=ul.bbext.Collection.extend({model:model.Section,getSectionsLeft:function(){var left=UL.config.sections_limit-this.length;return Math.max(0,left)}});collection.Profiles=ul.bbext.Collection.extend({model:model.Profile});collection.Urls=ul.bbext.Collection.extend({model:ul.model.Url,initialize:function(models,options){this.type=options.type;this.urlist=options.urlist},getLowerPos:function(){if(this.length)return this.at(0).get("position");else return},getUpperPos:function(){if(this.length)return this.at(this.length-1).get("position");else return},comparator:function(a,b){return a.get("section")*1e4+a.get("position")>b.get("section")*1e4+b.get("position")?1:-1}});collection.PendingNotifications=ul.bbext.Collection.extend({url:API_ROOT+"__message/fetch-contrib-notifications",model:model.PendingNotification});collection.SavedSearches=ul.bbext.Collection.extend({model:model.SavedSearch});view.Header=ul.bbext.View.extend({events:{"click .js-notifications":"openNotifications","submit .js-search-form":"searchGlobally","click .js-search-globally":"searchGlobally","click .js-search-in-library":"searchLocally","click .js-search-input":"showSearchMenu","keyup .js-search-input":"showSearchFilter"},initialize:function(){this.template=ul.util.t("header/header");this.listenTo(C.get("notifications"),"sync",this.updateCounter);this.listenTo(C.get("notifications"),"sync",this.renderNotifications);this.listenTo(C.get("notifications"),"sync",this.updateCounterTitle);this.listenTo(C.get("user"),"change",this.render)},searchGlobally:function(){var value=this.$("input.js-search-input").val();UL.Router.navigate("/search/{0}".format(encodeURIComponent(value)),{trigger:true});return false},searchLocally:function(){var value=this.$("input.js-search-input").val();UL.Router.navigate("/search/me/{0}/links".format(value),{trigger:true});return false},renderNotifications:function(){if(this.$(".js-dropdown--notifications").is(":visible"))return;var notifications=C.get("notifications").get("notifications"),length=notifications?notifications.length:0,template=ul.util.t("header/notifications"),$html=$(template({render:length})),$nl=$html.find(".notification-list"),subTemplate,cnot;for(var i=0;i<length;i++){cnot=notifications[i];subTemplate=ul.util.t("notification/{0}.mini".format(cnot.subject));if(!subTemplate)console.error("Missing template for notification '{0}'".format(cnot.subject));else $nl.append(subTemplate(cnot))}this.$(".js-notifications .dropdown").remove();this.$(".js-notifications").append($html);var pos=$(window).scrollTop();$nl.on({mouseenter:function(){$("body").addClass("ac--freeze")},mouseleave:function(){$("body").removeClass("ac--freeze")}})},render:function(){var json=this.model.toJSON(),savedSearchesView=new view.dashboard.SavedSearches({collection:C.get("user").get("saved_searches")});json.multiple_master=$.cookie("ul.config.branch");json.notifications_counter=C.get("notifications").get("total");json.facebook_url=API_ROOT+"login/facebook?next="+encodeURIComponent(window.location.href);this.$el.html(this.template(json));this.documentScript();this.$(".js-saved-searches").html(savedSearchesView.render());return this.$el},openNotifications:function(){UL.Broker.push("notifications-ack")},updateCounter:function(notificationModel){var total=notificationModel.getAmount();this.$(".js-notifications-counter").attr("data-count",total>9?"9+":total)},updateCounterTitle:function(notificationModel){var total=notificationModel.getAmount();setNotifCountDocumentTitle(total)},showSearchMenu:function(e){$(e.target).addClass("focused");$(e.target).select();this.$(".search_cta-list").addClass("show")},showSearchFilter:function(e){this.$(".ac-cutted").addClass("ac-cutted-off");this.$(".search_cta-list").addClass("show")},documentScript:function(){if(Modernizr.touch){this.$(".js-nav-item > a").removeClass("js-navigate").addClass("js-noop js-toggle-menu")}var documentBottomTrigger=_.debounce(function(){UL.Broker.trigger("document-bottom")},1e3,true),atBottom=false,header=this.$el.find(".header-app"),windowHeight=$(window).height();$(window).scroll(function(){var scrollHeight=$(window).scrollTop();if(scrollHeight>windowHeight/2){this.$(".sticker-scrollTop").addClass("active")}else{this.$(".sticker-scrollTop").removeClass("active")}if($(window).scrollTop()+$(window).height()>$(document).height()-200){if(!atBottom){atBottom=true;documentBottomTrigger()}}else{atBottom=false}})}});view.Settings=ul.bbext.View.extend({events:{"click .js-password-add":"addPassword","click .js-password-edit":"editPassword","click .js-deactivate-account":"deactivateAccount","click .js-settings-save":"saveSettings","change .js-oauth":"oauthCallback","keyup input[data-validator]":"validateInput"},initialize:function(){this.listenTo(C.get("user"),"change:profile_image",this.updateProfileImage);this.listenTo(C.get("user"),"change:progress",this.updateCompletion)},validateInput:function(e){view.utils.validateInput($(e.target))},render:function(){var json=this.model.toJSON({calculated:true});json.api_root=API_ROOT;var template=ul.util.t("dashboard/settings");this.$el.html(template(json));if(getLocationParameter("error")){view.utils.displayAlert("Sorry, there is another Urlist profile connected to this account","error")}this.updateCompletion();this.documentScript();return this.$el},addPassword:function(e){var dialog=new view.dialog.AddPassword({dialogClass:"dialog-password-add",closeOnOverlay:true});dialog.render();return false},recoverPassword:function(e){var dialog=new view.dialog.RecoverPassword({dialogClass:"dialog-recover-password",closeOnOverlay:true});dialog.render();return false},editPassword:function(e){var dialog=new view.dialog.EditPassword({dialogClass:"dialog-password-edit",closeOnOverlay:true});dialog.render();return false},deactivateAccount:function(e){var dialog=new view.dialog.DeactivateAccount({model:this.model,dialogClass:"dialog-deactivate-account",closeOnOverlay:true});dialog.render();return false},updateProfileImage:function(model){this.$(".js-profile-image").attr("src",model.get("profile_image")+"?v="+Math.random())},saveSettings:function(){if(view.utils.validateInput(this.$("input.js-screen-name"))){var that=this,payload=_.purge({screen_name:this.$("input[name='screen_name']").val(),short_bio:this.$("input[name='short_bio']").val(),location:this.$("input[name='location']").val(),website:this.$("input[name='website']").val(),show_facebook_link:this.$("input[name='show_facebook_link']").is(":checked"),username:this.$("input[name='username']").val(),notify_add_url:this.$("input[name='notify_add_url']").is(":checked"),notify_relist:this.$("input[name='notify_relist']").is(":checked"),notify_follow_user:this.$("input[name='notify_follow_user']").is(":checked"),notify_follow_list:this.$("input[name='notify_follow_list']").is(":checked"),notify_suggest_url:this.$("input[name='notify_suggest_url']").is(":checked")});UL.Broker.push("update-profile",{user_id:C.get("user").get("user_id")},payload).done(function(){if(payload.username!=C.get("user").get("username")){that.$("input[name='username']").replaceWith("<em>{0}</em>".format(payload.username));C.get("user").set("username_changed_at","now")}C.get("user").fetch();view.utils.displayAlert("Settings saved!","confirm")}).fail(function(error){if(error=="UsernameAlreadyTaken")view.utils.displayAlert("Username already taken","error");else if(error=="ValidationError")view.utils.displayAlert("Username can contain only letters, numbers and underscore","error");else view.utils.displayAlert("There was an error saving your settings :(","error")})}else{view.utils.displayAlert("I'm sorry Dave, I'm afraid I can't do that. You need a name.","hal9000")}},oauthCallback:function(e){var provider=$(e.target).attr("data-provider"),connect=$(e.target).is(":checked");if(connect)window.location="{0}login/{1}?next={2}".format(API_ROOT,provider,window.location);else{if(this.$(".js-oauth:checked").length==0){view.utils.displayAlert("You need to be connected with at least one social network!","error");$(e.target).prop("checked",true)}else{UL.Broker.push("remove-oauth",{user_id:C.get("user").get("user_id"),provider:provider})}}},updateCompletion:function(){var toFillIn=this.model.get("progress");this.$(".js-completion-ul").children().css("text-decoration","line-through");var percentage=this.model.progressPercentage();this.$(".js-progress_percentage").text(percentage+"%");if(toFillIn.length>0){for(var i=0;i<toFillIn.length;i+=1){var $li=this.$("li[data-progress='{0}']".format(toFillIn[i]));$li.css("text-decoration","")}this.$(".js-progress-box").removeClass("is--confirm")}else{this.$(".js-progress-box").addClass("is--confirm")}},documentScript:function(){var that=this,spinelem=this.$(".js-profile-image-container")[0],iframe=this.$(".js-submit-profile-picture"),spinner;this.$(".js-upload").click(function(){that.$(".js-upload-real").trigger("click");return false});this.$(".js-upload-real").change(function(){that.$("form").submit();that.$(".js-profile-image").fadeTo(500,.2);spinner=(new Spinner).spin(spinelem)});iframe.load(function(){var content=iframe.contents().text();if(content=="")return;if(content=="OK")C.get("user").fetch();else if(content=="IncorrectSize")view.utils.displayAlert("The image you tried to upload is too small."+"It needs to be at least 180px wide and 180px tall.","error");else view.utils.displayAlert("The image you tried to upload is not valid."+"Please give it another try!","error");spinner.stop();that.$(".js-profile-image").fadeTo(500,1)})}});view.LandingPage=ul.bbext.View.extend({initialize:function(){this.model=new model.Landing},renderWidgets:function(){var widgetListView=new view.widget.WidgetList({limit:8,collection:this.model.get("lists"),el:this.$(".widget-wrapper")});widgetListView.render();this.currentView=widgetListView},render:function(){var template=ul.util.t("landing/main"),that=this;this.$el.html(template());this.model.whenReady().done(function(){that.renderWidgets()});this.documentScript()},documentScript:function(){$(".sticker-scrollTop").addClass("hide");$("body").addClass("landing-page");$(".js-landing-slider").orbit({animationSpeed:350,advanceSpeed:8e3,fluid:true,bullets:true,directionalNav:false});$("#footer").removeClass("hide")}});view.suggestion.Urlists=ul.bbext.View.extend({initialize:function(){var categories=this.model.get("categories");if(categories.length>0)this.db=new model.Category({id:categories[0],network:false,sort:"popularity"});else this.db=new model.DiscoveryPopular},addUrlist:function(urlistModel){var that=this,urlistView=new view.suggestion.Urlist({model:urlistModel});this.listenTo(urlistView,"widgetReady",function(){that.trigger("widgetReady")});this.tickerCount++;this.$("ul").append(urlistView.render())},render:function(){var that=this,template=ul.util.t("suggestion/urlists");this.$el.html($(template()));this.db.whenReady().done(function(){var urlists=_.first(that.db.get("lists").shuffle(),6);that.collection=new collection.Urlists(urlists);that.collection.each(that.addUrlist,that)});return this.$el}});view.suggestion.Urlist=ul.bbext.View.extend({tagName:"li",className:"suggest-list",events:{},renderUser:function(){var that=this,author=this.model.get("author");author.whenReady().done(function(){that.$(".js-related-author").attr("href","/library/"+author.get("username"));that.$(".js-related-author").text(author.get("screen_name"))})},render:function(){var that=this;this.model.whenReady().done(function(){var json=that.model.toJSON(),template=ul.util.t("suggestion/urlist"),html;html=template(json);that.$el.html(html);that.renderUser();that.trigger("widgetReady")});return this.$el}});view.Category=ul.bbext.View.extend({events:{"click .js-share-share":"shareCategory"},initialize:function(){this.template=ul.util.t("category/category")},renderWidgets:function(){var widgetListView=new view.widget.WidgetList({collection:this.model.get("lists"),el:this.$(".widget-wrapper")});widgetListView.render();this.currentView=widgetListView},render:function(){var that=this,json=this.model.toJSON();json.label=_.findWhere(UL.CATEGORIES,{slug:json.name}).label;this.$el.html(this.template(json));this.model.whenReady().done(_.bind(this.renderWidgets,this));this.documentScript()},shareCategory:function(){var dialog=new view.dialog.ShareList({model:this.model,closeOnOverlay:true});dialog.render();return false},documentScript:function(){}});view.message.AskToJoin=ul.bbext.View.extend({events:{"click .js-message-close":"unbindMe","click .js-message-accept":"accept","click .js-message-decline":"decline"},template:"messages/ask_to_join",render:function(){var t=ul.util.t("messages/ask_to_join");this.$el.html(t(this.notification));$("#urlist-content").append(this.$el)},getNotificationId:function(){var hash=this.model.get("hash"),notification;notification=_(C.get("notifications").get("notifications")).find(function(n){return n.subject=="contrib_request"&&n.data.list_hash==hash});return notification.data.notification_id},accept:function(){var that=this;UL.Broker.push("accept-contrib-request",{notification_id:this.getNotificationId()}).done(function(){UL.Router.list(that.model.get("hash"),true)});this.unbindMe()},decline:function(){var that=this;UL.Broker.push("decline-contrib-request",{notification_id:this.getNotificationId()}).done(function(){UL.Router.list(that.model.get("hash"),true)});this.unbindMe()}});view.dashboard.People=ul.bbext.View.extend({events:{"click .js-load-more":"loadMore"},initialize:function(){this.listenTo(this.collection,"add",this.addUser);this.listenTo(this.collection,"remove",this.removeUser)},removeUser:function(userModel){this.$("li[data-username='{0}']".format(userModel.get("username"))).remove()},addUser:function(userModel){var that=this;userModel.whenReady().done(function(){var template=ul.util.t("dashboard/people.item"),json=userModel.toJSON();that.$("ul").append(template(json))})},loadMore:function(){var rendered=this.$("li").length,total=this.collection.length,limit=_.min([rendered+20,total]);for(var i=rendered;i<limit;i++)this.addUser(this.collection.at(i));this.$(".js-load-more").toggleClass("hide",limit==total);return false},render:function(){var template=ul.util.t("dashboard/people");this.$el.html(template());this.loadMore();return this.$el}});view.dashboard.SavedSearch=ul.bbext.View.extend({tagName:"li",events:{"click .js-search-delete":"deleteSearch"},initialize:function(){this.listenTo(this.model,"destroy",this.destroy)},destroy:function(){this.unbindMe();return false},render:function(){var template=ul.util.t("dashboard/savedsearches.item"),json=this.model.toJSON();this.$el.html(template(json));return this.$el},deleteSearch:function(){UL.Broker.push("remove-saved-search",{search_id:this.model.id,query:this.model.get("query")})}});view.dashboard.Dashboard=ul.bbext.View.extend({events:{"click .js-alert_close":"closeAlert","click .js-follow-user":"followUser","click .js-unfollow-user":"unfollowUser","click .js-followers-stats":"showFollowers","click .js-following-stats":"showFollowing"},initialize:function(){this.template=ul.util.t("dashboard/dashboard");this.model=this.model||ul.util.getCurrentProfile();this.model.whenReady().done(_.bind(this.deferredInitialize,this));this.currentView=null},deferredInitialize:function(){this.listenTo(this.model.get("lists"),"add remove",this.updateListsCounter);this.listenTo(this.model.get("followed_lists"),"add remove",this.updateFollowedListsCounter);this.listenTo(this.model.get("following_users"),"add remove",this.updateFollowingUsersCounter)},showFollowing:function(evt){var dialog=new view.dialog.ShowListFollowing({collection:this.model.get("following_users"),dialogClass:"dialog-mini dialog-list-following",title:"Following",closeOnOverlay:true});evt.preventDefault();dialog.render()},showFollowers:function(evt){var dialog=new view.dialog.ShowListFollowers({collection:this.model.get("followed_by_users"),dialogClass:"dialog-mini dialog-list-followers",title:"Followers",closeOnOverlay:true});evt.preventDefault();dialog.render()},cleanUp:function(){$(".search_cta-list").removeClass("show");$(".dropdown").removeClass("is--active");if(this.currentView){var height=this.$(".js-dashboard-content").height();this.currentView.unbindMe();this.$(".js-dashboard-page").append($("<div>",{"class":"js-dashboard-content",style:"height: {0}px".format(height)}))}},closeAlert:function(e){$(e.target).closest(".js-alert").slideUp(150,function(){$(this).remove()});e.preventDefault()},renderLists:function(lists,key,subkey){this.cleanUp();var widgetListView=new view.widget.WidgetList({collection:lists,el:this.$(".js-dashboard-content"),limit:20});this.currentView=widgetListView;this.$(".js-dashboard-nav li").removeClass("active");this.$(".js-dashboard-nav .js-my-"+key).addClass("active");if(key=="lists"){this.$(".js-changedisplay").removeClass("hide")}else{this.$(".js-changedisplay").addClass("hide")}if(subkey!=undefined){this.$(".js-changedisplay-switcher .js-route").siblings().removeClass("active");this.$(".js-changedisplay-switcher .js-route-"+subkey).addClass("active")}widgetListView.render();if(lists.length==0){this.$(".js-dashboard-content").html($(ul.util.t("dashboard/empty_lists")({is_mine:this.model.isMine()})))}},renderAll:function(){this.renderLists(this.model.get("lists"),"lists","all")},renderAuthored:function(){var userId=this.model.get("user_id"),lists=this.model.get("lists");this.renderLists(lists.filterByUser(userId),"lists","authored")},renderJoined:function(){var userId=this.model.get("user_id"),lists=this.model.get("lists");this.renderLists(lists.filterOutUser(userId),"lists","joined")},renderBookmarks:function(){this.renderLists(this.model.get("followed_lists"),"bookmarks")},renderFollows:function(){var followingPeopleView=new view.dashboard.People({collection:C.get("user").get("following_users")}),followedByPeopleView=new view.dashboard.People({collection:C.get("user").get("followed_by_users")});this.$(".js-followed-by-users").html(followedByPeopleView.render());
this.$(".js-following-users").html(followingPeopleView.render())},render:function(){var json=this.model.toJSON({calculated:true});json.progress_num=4-json.progress.length;json.progress_tot=4;this.cleanUp();this.$el.html(this.template(json));this.renderFollows();this.trigger("widgetReady");this.documentScript()},updateListsCounter:function(){this.$(".js-my-lists-counter").text(this.model.get("lists").length)},updateFollowedListsCounter:function(){this.$(".js-following-lists-counter").text(this.model.get("followed_lists").length)},updateFollowingUsersCounter:function(){this.$(".js-following-users-counter").text(this.model.get("following_users").length)},toggleFollow:function(e){e.preventDefault();this.$(".user-actions").toggleClass("status-following").addClass("following-new");this.$(".user-actions").one("mouseleave",function(){$(this).removeClass("following-new")})},followUser:function(e){if(ul.dialog.requireSignup())return false;UL.EventOriginator.push(e.getSource());UL.Broker.push("follow-user",{user_id:this.model.get("user_id")},{},{username:this.model.get("username")});this.toggleFollow(e);return false},unfollowUser:function(e){UL.EventOriginator.push(e.getSource());UL.Broker.push("unfollow-user",{user_id:this.model.get("user_id")},{},{username:this.model.get("username")});this.toggleFollow(e);return false},documentScript:function(){$(".js-app-navigation li").removeClass("active");$(".js-app-navigation .js-item-library").addClass("active")},_unbindMe:function(){this.cleanUp()}});view.discovery.Notifications=ul.bbext.View.extend({events:{"click .js-accept-request":"acceptRequest","click .js-decline-request":"declineRequest"},initialize:function(){this.listenTo(C.get("notifications"),"sync",this.deferredRender)},deferredRender:function(){var template=ul.util.t("dashboard/notifications"),notifications=this.model.get("notifications"),subview,subTemplate,cnot;this.$el.html(template({empty:notifications.length==0}));subview=this.$("[data-view='notifications']");for(var i=0;i<notifications.length;i++){cnot=notifications[i];subTemplate=ul.util.t("notification/{0}".format(cnot.subject));if(!subTemplate)console.error("Missing template for notification '{0}'".format(cnot.subject));else subview.append(subTemplate(cnot))}},render:function(){this.model.fetch({success:_.bind(this.deferredRender,this)});$(".js-app-navigation li").removeClass("active");$(".js-app-navigation .js-notifications").addClass("active");return this.$el},acceptRequest:function(e){var notification=$(e.target).closest(".js-request"),notificationId=notification.attr("data-request-id");notification.find(".js-action-toolbar .button").fadeOut("fast");UL.Broker.push("accept-contrib-request",{notification_id:notificationId})},declineRequest:function(e){var notification=$(e.target).closest(".js-request"),notificationId=notification.attr("data-request-id");notification.find(".js-action-toolbar .button").fadeOut("fast");UL.Broker.push("decline-contrib-request",{notification_id:notificationId})}});view.dashboard.SavedSearches=ul.bbext.View.extend({initialize:function(){this.listenTo(this.collection,"add remove",this.updateAmount);this.listenTo(this.collection,"add",this.addSavedSearch)},updateAmount:function(){this.$(".js-amount").text(this.collection.length)},addSavedSearch:function(savedSearchModel){var savedSearchView=new view.dashboard.SavedSearch({model:savedSearchModel});this.$("ul").append(savedSearchView.render())},render:function(){var template=ul.util.t("dashboard/savedsearches");this.$el.html(template({searches_amount:this.collection.length}));this.collection.each(_.bind(this.addSavedSearch,this));return this.$el}});(function(){"use strict";var displayMessage=function(html){var $el=$(html);$("#urlist-content").append($el);$el.find(".js-message-close").on("click",function(){$el.remove();return false})};ul.register("view.util.displayMessage",displayMessage);var clearMessages=function(){$(".message-alert").remove()};ul.register("view.util.clearMessages",clearMessages)})();(function(){view.utils.displayAlert=function(message,type,defaultEl){var k=15,t=Math.max(message.length/15*1e3,2500);defaultEl||(defaultEl="message-alert");type||(type="generic");var alertTmpl='<div class="message {0} is--{1}">{2}</div>'.format(defaultEl,type,message);$("#urlist-content").append(alertTmpl);$("."+defaultEl).delay(t).fadeOut(500,function(){$(this).remove()})}})();view.utils.validateInput=function(input){var validators={"not-empty":function(v){return $.trim(v)!==""},email:function(v){return isEmail(v)}},$e=$(input),validator=$e.attr("data-validator"),errorMessage=$e.attr("data-error"),value=$e.val(),isValid=validators[validator](value);if(!isValid&&!$e.hasClass("error")){$e.addClass("error");if(errorMessage)$e.after($("<div />",{text:errorMessage,"class":"error-message"}))}else if(isValid){$e.removeClass("error");$e.next(".error-message").remove()}return isValid};(function(w){var CanvasImage=function(canvas,loader,img,callbacks){if(!canvas){console.error("missing canvas...");return}this.canvas=canvas;this.loader=loader;this.ctx=canvas.getContext("2d");this.img=img||new Image;this.callbacks=callbacks;this.img.addEventListener("load",this.imageChange.bind(this));this.reset();this.generateCallbacks();this.bindToCanvas();this.bindToLoader();this.clear()};CanvasImage.prototype.clear=function(){this.ctx.fillStyle="#ffffff";this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)};CanvasImage.prototype.reset=function(){this.x=0;this.y=0;this.lastX=null;this.lastY=null;this.clear()};CanvasImage.prototype.redraw=function(){this.clear();this.ctx.drawImage(this.img,this.x,this.y,this.w,this.h)};CanvasImage.prototype.checkRatio=function(ratio){return true};CanvasImage.prototype.imageChange=function(){this.ratio=Math.max(this.canvas.height/this.img.height,this.canvas.width/this.img.width);if(!this.checkRatio(this.ratio))return;this.reset();this.w=this.img.width*this.ratio;this.h=this.img.height*this.ratio;this.x=-(this.w-this.canvas.width)/2;this.y=-(this.h-this.canvas.height)/2;this.redraw()};CanvasImage.prototype.setNewCover=function(src){this.img.src=src};CanvasImage.prototype.fileChange=function(evt){var that=this,file=evt.target.files[0],reader=new FileReader;reader.onload=function(e){that.setNewCover(e.target.result)};reader.readAsDataURL(file)};CanvasImage.prototype.generateCallbacks=function(){this.mouseDownBinded=this.mouseDownCallback.bind(this);this.mouseMoveBinded=this.mouseMoveCallback.bind(this);this.mouseUpBinded=this.mouseUpCallback.bind(this);this.touchMoveBinded=this.touchMoveCallback.bind(this)};CanvasImage.prototype.bindToCanvas=function(){if(this.binded)return;this.canvas.addEventListener("touchstart",this.mouseDownBinded,false);this.canvas.addEventListener("mousedown",this.mouseDownBinded,false);this.binded=true};CanvasImage.prototype.unbindToCanvas=function(){if(!this.binded)return;this.canvas.removeEventListener("touchstart",this.mouseDownBinded,false);this.canvas.removeEventListener("mousedown",this.mouseDownBinded,false);this.binded=false};CanvasImage.prototype.bindMoveToCanvas=function(){document.addEventListener("touchend",this.mouseUpBinded,false);document.addEventListener("touchmove",this.touchMoveBinded,false);document.addEventListener("mouseup",this.mouseUpBinded,false);document.addEventListener("mousemove",this.mouseMoveBinded,false)};CanvasImage.prototype.unbindMoveToCanvas=function(){document.removeEventListener("touchend",this.mouseUpBinded,false);document.removeEventListener("touchmove",this.touchMoveBinded,false);document.removeEventListener("mouseup",this.mouseUpBinded,false);document.removeEventListener("mousemove",this.mouseMoveBinded,false)};CanvasImage.prototype.bindToLoader=function(){if(!this.loader)return;this.loader.addEventListener("change",this.fileChange.bind(this),false)};CanvasImage.prototype.mouseDownCallback=function(evt){this.drag=true;this.bindMoveToCanvas();evt.preventDefault()};CanvasImage.prototype.mouseUpCallback=function(){this.drag=false;this.lastX=null;this.lastY=null;this.unbindMoveToCanvas()};CanvasImage.prototype.mouseMoveCallback=function(evt){var mx=evt.pageX,my=evt.pageY;if(!this.drag)return;this.move(mx,my)};CanvasImage.prototype.touchMoveCallback=function(evt){var touch=evt.touches[0],mx=touch.pageX,my=touch.pageY;evt.preventDefault();if(!this.drag)return;this.move(mx,my)};CanvasImage.prototype.move=function(mx,my){var offsetX,offsetY;if(this.lastX===null||this.lastY===null){this.lastX=mx;this.lastY=my;return}offsetX=mx-this.lastX;offsetY=my-this.lastY;this.lastX=mx;this.lastY=my;this.x+=offsetX;this.y+=offsetY;if(this.x>0)this.x=0;if(this.x+this.w<this.canvas.width)this.x=this.canvas.width-this.w;if(this.y>0)this.y=0;if(this.y+this.h<this.canvas.height)this.y=this.canvas.height-this.h;this.redraw()};CanvasImage.prototype.toDataURL=function(){return this.canvas.toDataURL()};w.CanvasImage=CanvasImage})(window);view.utils.ListSelector=ul.bbext.View.extend({events:{"focus .js-input-relist-to":"openSelect","click .js-relist-item-new":"openSelect","click .js-relister-trigger":"focusSelect","click .js-start-new-list":"newListCallback","change .js-sub-section select":"changeSection"},initialize:function(){var that=this;this.selectedList=null;this.selectedSection=null;this.listenTo(C.get("user").get("lists"),"add remove",function(){that.parseSource();that.changeList(that.firstToLoad)});this.parseSource()},render:function(){var template=ul.util.t("utils/list_selector");this.$el.html(template());this.renderAutocomplete();this.changeList(this.firstToLoad);return this.$el},renderSummary:function(urlistModel){var template=ul.util.t("utils/list_selector.summary"),data;this.$(".js-sub-section").empty();data=urlistModel.get("sections").toJSON();if(data.length>1)this.$(".js-sub-section").html(template({sections:data}));this.$("select").niceSelect();this.trigger("update",this.selectedList,this.getSelectedSection())},changeSection:function(){this.trigger("update",this.selectedList,this.getSelectedSection())},changeList:function(item){if(!item)return;var hash=item.value,title=item.label,secretHtml=item.is_secret?" <i class='icon-private small'></i> ":"",urlistModel=new ul.model.Urlist({hash:hash});this.$(".list-details").remove();this.$(".js-input-relist-to").val(title);this.$(".js-input-relist-to").before("<h5 class='list-details'>"+secretHtml+"</h5>");this.$(".js-input-relist-to").blur();this.selectedList=urlistModel;urlistModel.whenReady().done(_.bind(this.renderSummary,this,urlistModel))},getSelectedSection:function(){var val=this.$("select").val();return val?parseInt(val):null},newListCallback:function(e){var dialog=new view.dialog.NewList({model:C.get("user"),closeOnOverlay:true,sourceEvent:e});dialog.render();dialog.on("close",this.renderAutocomplete,this);return false},focusSelect:function(){this.$(".js-input-relist-to").select();return false},openSelect:function(){this.$(".js-input-relist-to").autocomplete("search","")},retrieveSource:function(request,response){response($.ui.autocomplete.filter(this.source,request.term))},parseSource:function(){var lists=C.get("user").get("lists"),first=lists.first(),source=lists.map(function(urlistModel){return{label:urlistModel.get("title"),value:urlistModel.get("hash"),is_secret:urlistModel.get("is_secret"),index:urlistModel.get("links_amount")}});this.source=source;if(first)this.firstToLoad={label:first.get("title"),value:first.get("hash"),is_secret:first.get("is_secret"),index:first.get("links_amount")}},renderAutocomplete:function(){var that=this;this.$(".js-input-relist-to").autocomplete({minLength:0,source:_.bind(this.retrieveSource,this),create:function(){$(".section-relist").append("<div class='ui-autocomplete-container'></div>");$(".ui-autocomplete-container").append("<a class='clearfix relist-item-new hide js-relist-item-new' href='#'>Create new List</a>")},open:function(event,ui){$("ul.ui-autocomplete").removeAttr("style").css({"z-index":"999999",position:"absolute","max-height":"auto","box-shadow":"none"}).appendTo(".section-relist").fadeIn(100)},close:function(event,ui){$(".js-relist-item-new").addClass("hide")},focus:function(event,ui){event.preventDefault()},select:function(event,ui){that.changeList.call(that,ui.item);event.preventDefault()}}).data("uiAutocomplete")._renderItem=function(ul,item){var itemIndex=item.index?" <q class='notation'>{0} links</q> ".format(item.index):"",itemSecret=item.is_secret?" <i class='icon-private small'></i> ":"",itemTmpl="<a>"+item.label+itemIndex+itemSecret+"</a>";return $("<li class='clearfix relist-item'></li>").data("item.autocomplete",item).append(itemTmpl).appendTo(ul)}}});view.Hashtag=ul.bbext.View.extend({events:{"click .js-save-search":"saveSearch"},initialize:function(){this.template=ul.util.t("hashtag/hashtag");this.hashtag="#{0}".format(this.model.get("hashtag"))},renderWidgets:function(){var widgetListView=new view.widget.WidgetList({collection:this.model.get("lists"),el:this.$(".widget-wrapper")});widgetListView.render();this.currentView=widgetListView},render:function(){var that=this,json=this.model.toJSON(),savedSearches=C.get("user").get("saved_searches");json.saved=savedSearches.where({query:this.hashtag}).length>0;this.$el.html(this.template(json));this.model.whenReady().done(_.bind(this.renderWidgets,this));this.documentScript()},documentScript:function(){$(".js-app-navigation li").removeClass("active");$(".js-app-navigation").addClass("active")},saveSearch:function(e){$(e.target).fadeOut(250);UL.Broker.push("add-saved-search",{},{query:this.hashtag})}});view.Onboarding=ul.bbext.View.extend({events:{"click .js-next":"goNext","click .js-skip":"goSkip","click input[name='category']":"selectCategory","click .js-follow-user":"followUser","click .js-invite-user":"inviteUser"},manageErrors:function(){var error=getLocationParameter("error");if(error=="ConnectedToAnotherAccount")view.utils.displayAlert("Oops, this Facebook account has been already connected to another account","error")},manageSteps:function(){var step=getLocationParameter("step");if(step=="suggest_users"){this.nextStep=this.renderSuggestUsers}else if(step=="complete_profile"){this.nextStep=this.renderCompleteProfile}else{this.nextStep=this.renderSuggestUsers}},initialize:function(){this.manageErrors();this.manageSteps();this.model=C.get("user");this.listenTo(this.model,"sync",this.updateProfileImage)},cleanUp:function(){this.$el.empty()},goNext:function(){this.nextStep.call(this);this.profilePicture();return false},goSkip:function(){this.nextStep.call(this);return false},toggleNextButton:function(enabled){this.$(".js-next").toggleClass("inactive",!enabled);this.$(".js-next").toggleClass("confirm",enabled)},getFacebookUrl:function(step){var currentUrl="//"+window.location.host;return API_ROOT+"login/facebook?next="+encodeURIComponent(addParamToUrl(currentUrl,"step",step))},finishOnboarding:function(){UL.Broker.push("onboarding-complete").done(function(){var loc=$.cookie("_ul_suggest_list_hash")||"/";window.location=loc})},render:function(){this.goNext();return this.$el},renderPickCategories:function(){this.cleanUp();var that=this,template=ul.util.t("welcome/pick_categories"),json={all_categories:UL.ORDERED_CATEGORIES};this.$el.append(template(json));this.nextStep=function(){var categoriesIds=_.map(that.$("input[name='category']:checked"),function(e){return $(e).val()});UL.Broker.push("onboarding-pick-categories",{},{categories_slugs:categoriesIds});that.renderSuggestUsers.call(that)};return this.$el},selectCategory:function(e){var checkedLength=this.$("input[name='category']:checked").length;this.toggleNextButton(checkedLength>=2)},renderSuggestUsers:function(options){this.cleanUp();var that=this,json=this.model.toJSON(),fbFriends=new model.FacebookFriends,template=ul.util.t("welcome/suggest_users");json.facebook_url=this.getFacebookUrl("suggest_users");this.inviteFromFacebook=this.inviteFromFacebook||[];fbFriends.whenReady().done(function(){_.extend(json,fbFriends.toJSON());that.$el.append(template(json));if(that.model.get("facebook_username")===""){that.$(".js-show-connect").removeClass("hide");that.$(".js-show-invite").addClass("hide")}});this.nextStep=function(){if(this.model.get("facebook_username")!==""){if(that.inviteFromFacebook.length>0)that.dialogInviteFacebookUsers.call(that,that.finishOnboarding);else that.finishOnboarding()}else{that.renderCompleteProfile()}};return this.$el},followUser:function(e){var $el=$(e.target),id=$(e.target).closest("a").attr("data-user_id");$el.html("Following");$el.addClass("inactive");UL.Broker.push("follow-user",{user_id:id});return false},inviteUser:function(e){var id=$(e.target).closest("a").attr("data-facebook_id");this.$(e.target).html("Invited");this.$(e.target).addClass("inactive");if(_.indexOf(this.inviteFromFacebook,id)==-1)this.inviteFromFacebook.push(id);if(this.inviteFromFacebook.length==50)this.dialogInviteFacebookUsers();return false},dialogInviteFacebookUsers:function(callback){var that=this;FB.ui({method:"apprequests",title:"Invite your friends to Urlist!",message:"I just signed up to Urlist, give it a try!",to:this.inviteFromFacebook},function(){that.inviteFromFacebook=[];callback&&callback()})},renderCompleteProfile:function(){var that=this,json=this.model.toJSON(),template=ul.util.t("welcome/complete_profile");this.cleanUp();json.facebook_url=this.getFacebookUrl("complete_profile");this.$el.append(template(json));this.nextStep=this.checkProfileData;return this.$el},checkProfileData:function(){var that=this,validScreenName=view.utils.validateInput(this.$("input[name='screen_name']")),validUsername=view.utils.validateInput(this.$("input[name='username']")),payload=_.purge({screen_name:this.$("input[name='screen_name']").val(),short_bio:this.$("input[name='short_bio']").val(),username:this.$("input[name='username']").val()});if(!validScreenName||!validUsername)return;UL.Broker.push("update-profile",{user_id:C.get("user").get("user_id")},payload).done(function(){console.log("update successful, go to network!");that.finishOnboarding()}).fail(function(error){if(error=="UsernameAlreadyTaken"){view.utils.displayAlert("Username already taken","error")}else if(error=="ValidationError"){view.utils.displayAlert("Username can contain only letters, numbers and underscore","error")}else{console.log("OK, this is not nice, if we have a very bad error, we just go to the user's network.");UL.Broker.push("onboarding-complete").done(function(){window.location="/"})}})},updateProfileImage:function(model){this.$(".js-profile-image").attr("src",model.get("profile_image")+"?v="+Math.random())},profilePicture:function(){var that=this,spinelem=this.$(".js-profile-image-container")[0],iframe=this.$(".js-submit-profile-picture"),spinner;this.$(".js-upload").click(function(){that.$(".js-upload-real").trigger("click");return false});this.$(".js-upload-real").change(function(){that.$("form").submit();that.$(".js-profile-image").fadeTo(500,.2);spinner=(new Spinner).spin(spinelem)});iframe.load(function(){var content=iframe.contents().text();if(content=="")return;if(content=="OK")C.get("user").fetch();else if(content=="IncorrectSize")view.utils.displayAlert("The image you tried to upload is too small."+"It needs to be at least 180px wide and 180px tall.","error");else view.utils.displayAlert("The image you tried to upload is not valid."+"Please give it another try!","error");spinner.stop();that.$(".js-profile-image").fadeTo(500,1)})},renderGetBookmarklet:function(){this.cleanUp();var template=ul.util.t("welcome/get_bookmarklet");this.$el.append(template(this.json));return this.$el}});view.Bookmarklet=ul.bbext.View.extend({name:"view.Bookmarklet",events:{"click .js-url-save":"submit","click .js-cancel":"cancel","click .js-share-twitter":"shareLinkOnTwitter","click .js-share-facebook":"shareLinkOnFacebook"},initialize:function(){this.selectedList=null;this.selectedSection=null},render:function(){var template=ul.util.t("bookmarklet/bookmarklet"),json=this.model.toJSON(),$html=$(template(json)),listSelector=new view.utils.ListSelector({el:$html.find(".js-list-selector")});this.listenTo(listSelector,"update",this.updateSelector);listSelector.render();this.$el.html($html);setTimeout(function(){var newHeight=window.outerHeight-window.innerHeight+480;window.resizeTo(600,newHeight)},50);return this.$el},saveLink:function(){var toListType=this.selectedList.get("type"),toListSection=this.selectedSection,target={list_hash:this.selectedList.get("hash")},payload=_.purge({section:toListSection,url:this.model.get("url"),title:this.$("input[name='title']").val(),description:this.$("textarea[name='description']").val()});return UL.Broker.push("add-url",target,payload,{source:"bookmarklet"})},renderShare:function(error){var template=ul.util.t("bookmarklet/share"),json=this.selectedList.toJSON(),$html=$(template(json));$html=$(template(json));setTimeout(window.close,4e3);this.$el.html($html);return this.$el},updateSelector:function(listModel,section){this.selectedList=listModel;this.selectedSection=section},submit:function(){this.saveLink().done(_.bind(this.renderShare,this)).fail(_.bind(this.renderShare,this));return false},cancel:function(){window.close()},shareLinkOnTwitter:function(){twitterShare(this.selectedList.toTweet());UL.Broker.trigger("share-url",{list_hash:this.selectedList.get("hash")},null,null,{channel:"twitter",source:"bookmarklet"});return false},shareLinkOnFacebook:function(e){facebookShare(this.selectedList.fullUrl());UL.Broker.trigger("share-url",{list_hash:this.selectedList.get("hash")},null,null,{channel:"facebook",source:"bookmarklet"});return false}});view.search.Search=ul.bbext.View.extend({events:{"submit form":"submitSearch","click .js-save-search":"saveSearch"},initialize:function(){this.template=ul.util.t("search/search");if(this.options.query)this.model=new model.Search({query:this.options.query})},saveSearch:function(evnt){this.$(evnt.target).addClass("hide");UL.Broker.push("add-saved-search",{},{query:this.model.get("query")})},submitSearch:function(){var query=this.$("input[name='query']").val();UL.Router.navigate("/search/{0}".format(query),{trigger:true});return false},renderLists:function(){var results=new view.widget.WidgetList({el:this.$(".js-widgets-hook"),collection:this.model.getUrlists(),limit:20});results.render()},renderLinks:function(){var results=new view.search.Links({el:this.$(".js-widgets-hook"),model:this.model});results.render()},renderSearch:function(){var json=this.model.toJSON();if(this.options.display=="links")this.renderLinks();else this.renderLists();this.$(".js-stats-hook").html(ul.util.t("search/stats")(json))},render:function(){var json=this.model.toJSON();this.$el.html(this.template(json));this.model.whenReady().done(_.bind(this.renderSearch,this));this.$("[data-location='{0}']".format(json.scope)).addClass("active");this.$("[data-location='{0}']".format(this.options.display)).addClass("active");return this.$el}});view.search.Links=ul.bbext.View.extend({events:{"click .js-save-search":"saveSearch","click .js-relist":"relist"},initialize:function(){this.template=ul.util.t("search/links")},relist:function(evnt){if(!!C.get("user").get("is_anonymous"))return false;var $target=$(evnt.target).closest("a");var that=this;var listHash=$target.attr("data-listhash");var urlHash=$target.attr("data-urlhash");var urlistModel=new ul.model.Urlist({hash:listHash});urlistModel.whenReady().done(function(){that.urlModel=urlistModel.get("urls").where({hash:urlHash})[0];var dialog=new view.dialog.RelistUrl({model:that.urlModel,dialogClass:"dialog-settings",closeOnOverlay:true,sourceEvent:evnt});dialog.render();return false})},deferredRender:function(){var json=this.model.toJSON(),savedSearches=C.get("user").get("saved_searches"),query=this.model.get("query");json.saved=savedSearches.where({query:query}).length>0;this.$el.html(this.template(json));this.trigger("widgetReady")},render:function(){this.model.whenReady().done(_.bind(this.deferredRender,this));return this.$el},saveSearch:function(){this.$(".js-save-search").remove();UL.Broker.push("add-saved-search",{},{query:this.model.get("query")})}});view.discovery.Profile=ul.bbext.View.extend({className:"profile-item js-profile-item",events:{"click .js-user-follow":"followUser","click .js-trigger-user-follow":"showFollowUser"},render:function(){var template=ul.util.t("widget/profile");that=this;this.$el.html(template(this.model.toJSON()));_.each(this.model.get("lists").first(3),function(urlist){var urlistView=new view.widget.Widget({model:urlist});that.$("[data-view='lists']").append(urlistView.render())});return this.$el},followUserCallback:function(e){var progressCount=parseInt($(".js-progressbar").attr("data-progress")),progressTotal=parseInt($(".js-progressbar").attr("data-total"));progressCount++;var progressComplete=progressCount>=progressTotal;$(".js-progressbar").attr({"data-progress":progressCount,"data-complete":progressComplete});if(progressComplete)$(".js-progressbar").siblings(".js-toggle").addClass("js-switch");UL.EventOriginator.push(e.getSource(e));this.trigger("follow-user");UL.Broker.push("follow-user",{user_id:this.model.get("user_id")},{},{username:this.model.get("username")})},followUser:function(e){if(ul.dialog.requireSignup())return false;$(e.target).parents(".js-profile-item").find(".js-trigger-user-follow").trigger("click",true);return false},showFollowUser:function(e){if(ul.dialog.requireSignup())return false;this.followUserCallback(e);$(e.target).closest(".js-trigger-user-follow").addClass("active");$(e.target).removeClass("js-trigger-user-follow");$(e.target).parents(".js-profile-item").find(".cardlist-shield").addClass("inhibit");$(e.target).parents(".js-profile-item").delay(500).slideUp(250);return false}});view.discovery.Discovery=ul.bbext.View.extend({events:{"click .js-slide--trigger":"openSlide","click .js-dismiss-welcome":"dismissWelcome"},initialize:function(){this.listenTo(C.get("notifications"),"sync",this.updatePendingCounter)},cleanUp:function(){$(".dropdown").removeClass("is--active");if(this.currentView){this.currentView.unbindMe();if(this.$("[data-view='content']").length==0)this.$("[data-view='discovery']").append($("<div class='discovery-content clearfix' data-view='content' />"))}},dismissWelcome:function(){$.removeCookie("_ul_show_welcome_on_network");this.$(".js-welcome-message").fadeOut()},openSlide:function(e){$(e.target).closest(".js-slide").addClass("active");return false},renderWidgets:function(urlistCollection,$el,$customEl,showloader,View){var widgetListView=new view.widget.WidgetList({collection:urlistCollection,el:$el,customBlockFirst:$customEl,autoload:false,showloader:showloader,View:View});widgetListView.render();return widgetListView},renderMain:function(){this.cleanUp();var that=this;var template=ul.util.t("category/popular");var popularModel=new model.DiscoveryPopular;this.$el.html(template());popularModel.whenReady().done(function(){that.renderWidgets(popularModel.get("lists"),that.$("[data-view='popular']"),null,true)});this.$(".js-toolbar li").removeClass("active");this.$(".js-toolbar .top").addClass("active");$(".js-app-navigation li").removeClass("active");$(".js-app-navigation .js-item-network").addClass("active")},renderNetwork:function(){this.cleanUp();var that=this;var template=ul.util.t("discovery/network");var networkModel=new model.DiscoveryNetwork;var json={username:C.get("user").get("username"),display_following:C.get("user").get("following_users").length<5,has_following:C.get("user").get("following_users").length>0};this.$("[data-view='content']").html(template(json));networkModel.whenReady().done(function(){that.currentView=that.renderWidgets(networkModel.get("lists"),that.$("[data-view='network']"),null,true)});this.$(".js-toolbar li").removeClass("active");this.$(".js-toolbar .network").addClass("active");$(".js-app-navigation li").removeClass("active");$(".js-app-navigation .js-item-network").addClass("active")},renderNetworkLinks:function(){this.cleanUp();var that=this,template=ul.util.t("discovery/network"),json={display_following:C.get("user").get("following_users").length<5,has_following:C.get("user").get("following_users").length>0},linksModel=new model.DiscoveryNetworkUrls;this.$("[data-view='content']").html(template(json));linksModel.whenReady().done(function(){that.currentView=that.renderWidgets(linksModel.get("urls"),that.$("[data-view='network']"),null,true,view.widget.Url)});this.$(".js-changedisplay-switcher .state-a").removeClass("active").siblings().addClass("active");this.$(".js-toolbar li").removeClass("active");this.$(".js-toolbar .network").addClass("active");$(".js-app-navigation li").removeClass("active");$(".js-app-navigation .js-item-network").addClass("active")},renderFollow:function(){this.cleanUp();var that=this;var template=ul.util.t("discovery/follow");var followModel=new model.DiscoveryTopUsers;var followView=new view.discovery.FollowMore({el:this.$("[data-view='content']")});this.currentView=followView;followView.render();this.$(".js-toolbar li").removeClass("active");this.$(".js-toolbar .follow").addClass("active");$(".js-app-navigation li").removeClass("active");$(".js-app-navigation .js-item-network").addClass("active")},renderActivity:function(){this.cleanUp();var notificationsView=new view.discovery.Notifications({model:C.get("notifications"),el:this.$("[data-view='content']")});this.currentView=notificationsView;UL.Broker.push("notifications-ack");this.$(".js-toolbar li").removeClass("active");this.$(".js-toolbar .js-activity").addClass("active");notificationsView.render()},updatePendingCounter:function(){var notifLength=C.get("notifications").getAmount(),notifCounter=this.$(".js-pending-counter");notifCounter.attr("data-count",notifLength>9?"9+":notifLength)},render:function(){var template=ul.util.t("discovery/layout"),that=this,notifLength=C.get("notifications").getAmount(),json={notifications_amount:notifLength>9?"9+":notifLength};$("#footer").removeClass("hide");this.$el.html(template(json))}});view.discovery.FollowMore=ul.bbext.View.extend({initialize:function(){this.autoload=true;this.model=new model.DiscoveryTopUsers;this.LIMIT=5;this.toRenderLater=[];if(this.autoload)this.listenTo(UL.Broker,"document-bottom",this.renderWidgets)},renderProfile:function(user){var that=this;user=user||this.toRenderLater.pop();if(!user)return;user.whenReady().done(function(){var profileView=new view.discovery.Profile({model:user}),hook=that.$("[data-view='follow']");hook.append(profileView.render());profileView.once("follow-user",that.renderProfile,that)})},renderWidgets:function(){for(var i=0;i<this.LIMIT;i++)this.renderProfile()},render:function(){var that=this,template=ul.util.t("discovery/follow"),json={display_following:C.get("user").get("following_users").length<5,following_users_count:C.get("user").get("following_users").length};this.$el.html(template(json));this.documentScript();this.model.whenReady().done(function(){that.toRenderLater=that.model.get("users").models.slice();that.renderWidgets()})},documentScript:function(){if(Modernizr.touch||$(".is-stickyarea").length==0)return false;var stickyEl=$(".is-stickyarea"),stickyClass="active-sticky",stickyOffY=stickyEl.offset().top,scrollOffY=$(window).scrollTop();function detectSticky(){scrollOffY=$(window).scrollTop();if(scrollOffY>stickyOffY){stickyEl.addClass(stickyClass)}else{stickyEl.removeClass(stickyClass)}}detectSticky();$(window).on("scroll",function(){detectSticky()})}});view.widget.WidgetList=ul.bbext.View.extend({el:"div.widget-wrapper",events:{"click .js-load-more":"renderWidgetsSlice"},initialize:function(){this.limit=this.options.limit;this.autoload=this.options.autoload!==false;this.showloader=this.options.showloader!==false;this.View=this.options.View||view.widget.Widget;this.page=this.options.page||1;this.limit=this.options.limit||20;if(this.autoload)this.listenTo(UL.Broker,"document-bottom",this.renderWidgetsSlice);this.loadTemplate=this.options.loadTemplate||ul.util.t("widget/loadmore");this.customBlockFirst=this.options.customBlockFirst},addWidget:function(list,isFeatured){var widget=new this.View({model:list,isFeatured:isFeatured});
widget.render();this.$wc.append(widget.$el)},renderWidgetsSlice:function(e){var that=this,rendered=this.$wc.find(".widget-card").length,amount=this.limit*this.page,left=this.collection.length-rendered-amount,currentList;for(var i=rendered;i<rendered+amount&&i<this.collection.length;i++){currentList=this.collection.at(i);this.addWidget(currentList,_.indexOf(this.collection.featured,currentList.get("hash"))!=-1)}if(!this.autoload&&left<=0)this.$(".js-load-more").addClass("inactive").fadeTo(400,0);return false},render:function(){this.$wc=$("<div />",{"class":"widget-container deck"});this.$el.append(this.$wc);if(this.customBlockFirst){this.$wc.prepend(this.customBlockFirst)}if(!this.autoload&&this.showloader)this.$el.append(this.loadTemplate());this.renderWidgetsSlice();this.trigger("widgetReady")}});view.widget.Widget=ul.bbext.View.extend({events:{"click .js-edit-list":"editCallback","click .js-edit-contributors":"editContributorsCallback","click .js-edit-categories":"editCategories","click .js-delete-list":"deleteListCallback","click .js-migrate-list":"migrateToPublicCallback","click .js-share-list":"shareList","click .widget-actions":"toggleFollow","click .js-follow-list":"followList","click .js-unfollow-list":"unfollowList"},SECTION_NAMES_MAP:["orange","green","red","blue","purple"],className:"widget widget-card",initialize:function(){this.template=this.options.template||ul.util.t("widget/common");this.details=this.options.details===undefined?true:this.options.details;this.listenTo(this.model,"destroy",this.destroyCallback);this.listenTo(this.model,"change:title",this.changeTitle);this.listenTo(this.model,"change:description",this.changeDescription);this.listenTo(this.model,"change:is_secret",this.changeSecret);this.listenTo(this.model,"change:categories",this.changeCategories)},deleteListCallback:function(e){var dialog=new view.dialog.DeleteList({model:this.model,closeOnOverlay:true});dialog.render();return false},migrateToPublicCallback:function(e){var that=this,dialog=new view.dialog.MigrateList({model:this.model,dialogClass:"dialog-settings",closeOnOverlay:true});dialog.render();dialog.once("submit",function(){UL.Broker.push("update-list",{list_hash:that.model.get("hash")},{is_secret:false});that.$(".js-migrate-list").hide().next().removeClass("hide")});return false},followList:function(e){if(ul.dialog.requireSignup())return false;var hash=this.model.get("hash");UL.EventOriginator.push(e.getSource());UL.Broker.push("follow-list",{list_hash:hash});if(UL.Router.current.name=="dashboard")this.$el.fadeTo("fast",1)},unfollowList:function(e){var hash=this.model.get("hash");UL.EventOriginator.push(e.getSource());UL.Broker.push("unfollow-list",{list_hash:hash});if(UL.Router.current.name=="dashboard")this.$el.fadeTo("fast",.5)},shareList:function(){var dialog=new view.dialog.ShareList({model:this.model,closeOnOverlay:true});dialog.render();return false},destroyCallback:function(){var that=this;this.$el.fadeOut("500",function(){that.trigger("widgetRemoved",that.$el);that.unbindMe()})},renderChart:function(){var urls=this.model.get("urls").first(10),list_hash=this.model.get("hash"),template=ul.util.t("widget/chart"),json={urls:[]};_(urls).each(function(u,i){json.urls.push({position:i+1,title:u.get("title"),url:"/"+list_hash,favicon:u.get("favicon")})});this.$(".sublist").append(template(json))},renderReference:function(){var that=this,hash=this.model.get("hash"),sections=this.model.get("sections"),template=ul.util.t("widget/reference"),json={sections:[]};sections.each(function(section,i){json.sections.push({slug:section.getTitleSlug(),hash:hash,title:section.get("title"),empty_title:section.get("empty_title"),color:that.SECTION_NAMES_MAP[i],urls_amount:section.getUrlsAmount()})});this.$(".sublist").append(template(json))},renderPeople:function(){var peopleView=new view.widget.People({model:this.model.get("userauthor"),collection:this.model.get("contributors")});this.$(".js-widget-people").replaceWith(peopleView.render())},deferredRender:function(){var json=this.model.toJSON({calculated:true}),$html;json.details=this.details;$html=this.template(json);this.$el.html($html);if(this.details){if(this.model.get("sections").length>1){this.renderReference();this.$el.addClass("reference")}else{this.renderChart();this.$el.addClass("chart")}}this.renderPeople();if(this.options.isFeatured)this.$el.addClass("featured");var $cover=this.$el.find(".widget-preheader figure");if(json.cover_image){var newImage=new Image;newImage.src="{0}?v={1}".format(json.cover_image,slugify(json.cover_image_v));newImage.onload=function(){$cover.addClass("has--cover");$cover.css("background-image","url({0})".format(this.src))}}else{$cover.addClass("has--no-cover")}this.trigger("widgetReady",this.$el)},render:function(){this.model.whenReady().done(_.bind(this.deferredRender,this));this.$el.attr("data-cid",this.model.cid);return this.$el},changeTitle:function(model,value){this.$(".js-list-title").text(value)},changeDescription:function(model,value){this.$(".js-list-description").html(model.htmlDescription())},editCallback:function(e){var dialog=new view.dialog.SettingsList({model:this.model});dialog.render();return false},editContributorsCallback:function(e){var dialog=new view.dialog.Contributors({model:this.model});dialog.render();return false},editCategories:function(e){var dialog=new view.dialog.SelectCategory({model:this.model});dialog.render();return false},changeSecret:function(model,value){this.$(".js-is-secret").toggle(value)},changeCategories:function(model,value){this.$(".js-list-categories").removeClass("hide").text(model.getCategories())},toggleFollow:function(){this.$(".widget-actions").toggleClass("status-following").addClass("following-new");this.$(".widget-actions").one("mouseleave",function(){$(this).removeClass("following-new")})}});view.widget.People=ul.bbext.View.extend({initialize:function(){this.urlist=this.options.urlist;this.activeContributors=this.collection.where({status:"accepted"})},deferredRenderAuthor:function(author){var template=ul.util.t("widget/people.author"),json=author.toJSON(),html=template(json);this.$(".js-screenname").text(json.screen_name.crop(14));this.$(".js-screenname").attr("href","/library/"+json.username);this.$(".js-avatars").prepend(html)},renderAuthor:function(author){author.whenReady().done(_.bind(this.deferredRenderAuthor,this,author))},renderContributor:function(contributor){var template=ul.util.t("widget/people.contributor"),$html=template(contributor.toJSON());this.$(".js-avatars").append($html)},renderContributors:function(contributors){var that=this;_.chain(this.activeContributors).first(4).each(function(contributor){contributor.whenReady().done(_.bind(that.renderContributor,that,contributor))})},render:function(){var template=ul.util.t("widget/people"),html=template({contributors_amount:this.activeContributors.length});this.$el.html(html);this.renderAuthor(this.model);this.renderContributors(this.collection);return this.$el}});view.navigation.Sidebar=ul.bbext.View.extend({events:{"click .js-share-by-email":"shareListByEmail","click .js-share-on-twitter":"shareListOnTwitter","click .js-share-on-facebook":"shareListOnFacebook","click .js-share-on-google":"shareListOnGoogle"},initialize:function(){this.currentUrlModel=this.options.currentUrlModel;this.collection=this.model.get("urls")},renderAuthor:function(){var that=this,author=this.currentUrlModel.get("author");author.whenReady().done(function(){that.$(".js-author").text(author.get("screen_name"));that.$(".js-author").attr("href","/library/"+author.get("username"))})},renderList:function(){this.model.get("sections").each(function(section){var unorderedList=$("<ul />"),template=ul.util.t("navigation/url"),innerUrls=section.getLocalUrls();if(this.model.get("type")!="chart"&&innerUrls.length>0)this.$(".js-urls").append($("<h5 class='list-section'>{0}</h5>".format(section.get("title"))));_.each(innerUrls,function(url){var json={title:url.get("title"),url:url.getFullUrl(),active:url.get("hash")==this.currentUrlModel.get("hash")?"current":""};unorderedList.append(template(json))},this);this.$(".js-urls").append(unorderedList)},this)},render:function(){var template=ul.util.t("navigation/sidebar"),json=_.extend({current:this.collection.indexOf(this.currentUrlModel)+1,total:this.collection.length,title:this.model.get("title"),type:this.model.get("type"),urlist_hash:this.model.get("hash")},this.currentUrlModel.toJSON({calculated:true}));this.$el.html(template(json));this.renderAuthor();this.renderList();return this.$el},shareListByEmail:function(){var dialog=new view.dialog.ShareListByEmail({model:this.model,dialogClass:"share-list-email",closeOnOverlay:true});dialog.render();return false},shareListOnTwitter:function(){twitterShare(this.currentUrlModel.toTweet());return false},shareListOnFacebook:function(){facebookShare(window.location);return false},shareListOnGoogle:function(){googleShare(window.location);return false}});view.navigation.Navigation=ul.bbext.View.extend({events:{"click .js-edit-url":"editUrlCallback","click .js-relist":"relistCallback","click .js-open-details":"showDetails","click .js-close-navigation":"exitNavigation"},initialize:function(){this.collection=this.model.get("urls");this.listenTo(this.collection,"remove",this.deleteAndNext)},deleteAndNext:function(){this.$(".js-nav-next").click()},goHash:function(url_hash){var urlModel=this.collection.where({hash:url_hash})[0];return this.goUrlModel(urlModel)},goUrlModel:function(urlModel){var current=this.collection.indexOf(urlModel),total=this.collection.length,prev=(current<=0?total:current)-1,next=(current+1)%total,prevUrl=this.collection.at(prev),nextUrl=this.collection.at(next),that=this;this.currentUrl=urlModel;UL.Embed(urlModel.toJSON()).done(function(html){that.$(".js-embed").html(html)}).fail(function(){var html=ul.util.t("embed/__not_embeddable")(urlModel.toJSON());that.$(".js-embed").html(html)});this.$(".js-nav-prev").attr("href",prevUrl.getFullUrl());this.$(".js-nav-next").attr("href",nextUrl.getFullUrl());this.$(".js-nav-title").attr({href:this.currentUrl.get("url"),target:"_blank"}).find(".label").text(this.currentUrl.get("url"));this.$(".js-nav-current").text(current+1);this.$(".js-nav-total").text(total);setDocumentTitle(urlModel.get("title"));this.renderSidebar();this.documentScript()},renderSidebar:function(){if(this.sidebarView)this.sidebarView.unbindMe();this.sidebarView=new view.navigation.Sidebar({model:this.model,currentUrlModel:this.currentUrl});this.$(".js-nav-sidebar-placeholder").html(this.sidebarView.render())},render:function(){var template=ul.util.t("navigation/main"),json={current:1,hash:this.model.get("hash"),total:this.collection.length,title:this.model.get("title"),is_secret:this.model.get("is_secret"),policies:this.model.getPolicies()};this.$el.html(template(json));return this.$el},editUrlCallback:function(e){var dialog=new view.dialog.EditUrl({model:this.currentUrl,dialogClass:"dialog-settings",closeOnOverlay:true});dialog.render()},relistCallback:function(e){var dialog=new view.dialog.RelistUrl({model:this.currentUrl,dialogClass:"dialog-settings",closeOnOverlay:true,sourceEvent:e});dialog.render()},showDetails:function(e){e.preventDefault();$(e.target).toggleClass("active");$(".js-nav-sidebar-placeholder").toggleClass("hide")},documentScript:function(){$("#header, #footer").hide();$(".js-embed").height(window.innerHeight-$(".top-bar").height()+"px");$(".js-embed, .resource-section").height(window.innerHeight-$(".top-bar").height()+"px");$(".js-nav-sidebar-placeholder").height($(".js-embed").height()-50+"px");$(window).resize(function(){$(".js-embed, .resource-section").height(window.innerHeight-$(".top-bar").height()+"px");$(".js-nav-sidebar-placeholder").height($(".js-embed").height()-50+"px")})},afterRender:function(){var beforeLinkListHeight=0;$(".link-list").prevAll().each(function(){beforeLinkListHeight+=$(this).outerHeight()})},exitNavigation:function(){}});view.urlist.Comment=ul.bbext.View.extend({events:{"click .js-delete-comment":"deleteCommentCallback"},initialize:function(){this.listenTo(this.model,"destroy",this.unbindMe)},renderUser:function(){var that=this,author=this.model.get("author");this.model.get("author").whenReady().done(function(){that.$(".js-author-avatar").attr("src",author.get("profile_image"));that.$(".js-author").attr("href","/library/"+author.get("username"));that.$(".js-author").text(author.get("screen_name"))})},canDelete:function(){var cUser=C.get("user"),author=this.model.get("author"),policy=policies["urlist"]["remove_comment"],val=policy(cUser,this.options.urlistModel),isMine=author.get("user_id")==cUser.get("user_id");return val||isMine},render:function(){var template=ul.util.t("urlist/comments.item"),json=this.model.toJSON({calculated:true});json.can_delete=this.canDelete();this.$el.html(template(json));this.renderUser();return this.$el},deleteCommentCallback:function(e){var dialog=new view.dialog.GenericDelete({what:"comment",closeOnOverlay:true}),listHash=this.options.urlistModel.id,commentId=this.model.id;dialog.render();dialog.once("submit",function(){UL.Broker.push("remove-comment",{list_hash:listHash,comment_id:commentId})});return false}});view.urlist.Comments=ul.bbext.View.extend({COMMENTS_AMOUNT:5,events:{"click .js-add-comment":"submitComment","click .js-load-more":"loadMore"},initialize:function(){this.listenTo(this.collection,"add",this.prependComment);this.listenTo(this.collection,"add remove",this.updateCommentsCounter)},updateCommentsCounter:function(){this.$(".js-comments-amount").text(this.collection.length)},submitComment:function(e){var $textarea=this.$("textarea[name='comment']"),comment=$.trim($textarea.val()),listHash=this.model.get("hash");$textarea.val("");if(comment.length>0)UL.Broker.push("add-comment",{list_hash:listHash},{comment:comment});return false},addComment:function(commentModel,append){var commentView=new view.urlist.Comment({urlistModel:this.model,model:commentModel}),$html=commentView.render();if(append)this.$(".js-comments").append($html);else this.$(".js-comment-new").after($html)},appendComment:function(commentModel){this.addComment(commentModel,true)},prependComment:function(commentModel){this.addComment(commentModel)},loadMore:function(){var rendered=this.$(".js-comment").length,total=this.collection.length,limit=_.min([rendered+this.COMMENTS_AMOUNT,total]);for(var i=rendered;i<limit;i++)this.appendComment(this.collection.at(i));this.$(".js-load-more").toggleClass("hide",limit==total);return false},render:function(){var template=ul.util.t("urlist/comments"),json={comments_amount:this.collection.length,policies:this.model.getPolicies()};this.$el.html(template(json));this.loadMore();return this.$el}});view.urlist.Relist=ul.bbext.View.extend({events:{},initialize:function(){},renderOne:function(list_hash,user_id,isOriginal){var that=this,listModel=new ul.model.Urlist({hash:list_hash}),authorModel=new model.User({user_id:user_id});listModel.whenReady().then(function(){return authorModel.whenReady()}).then(function(){var template=ul.util.t("urlist/url.relist.{0}".format(isOriginal?"original":"item")),json={username:authorModel.get("username"),screen_name:authorModel.get("screen_name"),profile_image:authorModel.get("profile_image"),title:listModel.get("title"),hash:list_hash};if(isOriginal)that.$(".js-relists").prepend(template(json));else that.$(".js-relists").append(template(json))})},renderOriginal:function(){var list_hash=this.model.get("from_list_hash"),user_id=this.model.get("from_user_id");if(list_hash)this.renderOne(list_hash,user_id,true)},renderItem:function(relist){var list_hash=relist.target_list_hash,user_id=relist.user_id;this.renderOne(list_hash,user_id)},render:function(){var template=ul.util.t("urlist/url.relist");this.$el.html(template());this.renderOriginal();_.each(this.model.get("relists"),this.renderItem,this);return this.$el}});view.urlist.People=ul.bbext.View.extend({initialize:function(){this.urlist=this.options.urlist;this.listenTo(this.collection,"add remove",this.updateContributorsCounter);this.listenTo(this.collection,"add",this.renderContributor);this.listenTo(this.collection,"remove",this.removeContributor)},updateContributorsCounter:function(){this.$(".js-contributors-count").text(this.collection.length)},renderAuthor:function(author){var that=this,template=ul.util.t("urlist/people.author"),$el=this.$(".ui-author");author.whenReady().done(function(){$el.html(template(author.toJSON()));that.trigger("widgetReady")})},renderContributor:function(contributor){var that=this,template=ul.util.t("urlist/people.contributor"),el=this.$(".js-contributors-list");contributor.whenReady().done(function(){el.append(template(contributor.toJSON()));that.trigger("widgetReady")});this.$(".js-contributors-container").removeClass("hide")},renderOtherContributor:function(contributor){var that=this,template=ul.util.t("urlist/people.contributor"),el=this.$(".js-other-contributors-list");contributor.whenReady().done(function(){el.append(template(contributor.toJSON()));that.trigger("widgetReady")});this.$(".js-other-contributors-container").removeClass("hide")},removeContributor:function(contributor){this.$(".collaborators-list .js-contributor[data-user-id='{0}']".format(contributor.id)).fadeOut()},renderContributors:function(contributors){var that=this;contributors.each(_.bind(this.renderContributor,this))},renderOtherContributors:function(contributors){var that=this;contributors.each(_.bind(this.renderOtherContributor,this))},render:function(){var template=ul.util.t("urlist/people"),policies=this.urlist.getPolicies(),html=template({contributors_amount:this.urlist.getContributorsAmount(),other_contributors_amount:this.options.otherCollection.length,policies:policies});this.$el.html(html);this.renderAuthor(this.model);this.renderContributors(this.collection);this.renderContributors(this.options.otherCollection);return this.$el}});view.urlist.Summary=ul.bbext.View.extend({initialize:function(){this.template=ul.util.t("urlist/summary");this.listenTo(this.model.get("sections"),"add",this.addItem)},addItem:function(sectionModel){var itemView=new view.urlist.SummaryItem({model:sectionModel,urlistModel:this.model});this.$el.find(".js-section-list").append(itemView.render())},render:function(){var policies=this.model.getPolicies(),json={policies:policies,sections_amount:this.model.getSectionsAmount()};this.$el.html($(this.template(json)));this.model.get("sections").each(this.addItem,this);return this.$el}});view.urlist.Section=ul.bbext.View.extend({events:{"submit .ui-sub-add-url":"addUrlUI","click .ui-load-more":"loadMore"},initialize:function(){this.urlist=this.model.urlist;this.template=ul.util.t("urlist/section");this.listenTo(this.model,"change:title",this.changeTitle);this.listenTo(this.urlist.get("urls"),"add remove move",this.updateUrlsCounter);this.listenTo(this.urlist.get("urls"),"add remove move",this.updatePlaceholder);this.listenTo(this.urlist.get("urls"),"add",this.addUrl);this.listenTo(this.model,"destroy",this.destroy);this.listenTo(this.urlist.get("urls"),"remove",this.removeLink)},removeLink:function(model){this.$("[data-cid='{0}']".format(model.cid)).fadeOut()},addUrl:function(model){var index=model.get("section");if(index==this.model.id)this.prependUrl(model)},_addUrlUI:function(url,suppressErrors){var hash=this.options.urlistView.model.get("hash"),section=this.model.id;url=normalizeUrl(url);if(!suppressErrors&&this.urlist.hasUrl(url)){view.utils.displayAlert("Ops! you already added that link","error");return false}UL.Broker.push("add-url",{list_hash:hash},{url:url,section:section}).fail(function(){if(!suppressErrors)view.utils.displayAlert("Something went wrong! Are you sure it was a link? Try again","error")})},addUrlUI:function(e){var that=this;that.urls=this.$(".ui-add-link-txt").val().split(" ");this.$(".ui-add-link-txt").val("");function doTimeoutForAdd(link,timeout){var f=_.bind(that._addUrlUI,that,link,that.urls.length);setTimeout(f,timeout)}for(var i=0;i<that.urls.length;i++){if(that.urls[i].indexOf(".")!=-1){doTimeoutForAdd(that.urls[i],i*1e3)}}this.$(".js-empty-placeholder").remove();return false},removeUrl:function(url){this.$(".ui-urls .url[data-cid='{0}']".format(url.cid)).remove()},prependUrl:function(url){var urlView=new view.urlist.Url({model:url}),$html=urlView.render();this.$(".ui-urls").prepend($html)},appendUrl:function(url){var urlView=new view.urlist.Url({model:url});this.$(".ui-urls").append(urlView.render())},changeTitle:function(model){this.$el.attr("id",model.getTitleSlug());this.$(".js-section-title").text(model.get("title")||model.get("empty_title"))},renderLoadMore:function(left){var template=ul.util.t("urlist/section.loadmore");this.$(".ui-urls-section").append(template({left:left}))},renderUrlsSlice:function(){var urls=this.model.getLocalUrls(),rendered=this.$(".js-url-item").length,amount=50,left=urls.length-rendered-amount;if(left>0&&left<5){amount+=left;left=0}for(var i=rendered;i<rendered+amount&&i<urls.length;i++)this.appendUrl(urls[i]);if(!urls.length)this.$(".ui-urls").append(ul.util.t("urlist/empty_section"));this.$(".ui-load-more").remove();if(left>0)this.renderLoadMore(left);this.$(".ui-urls-section").toggleClass("show-bottom-border",left<=0)},render:function(){var json=this.model.toJSON({calculated:true});json.policies=this.model.urlist.getPolicies();json.urls_amount=this.model.getLocalUrls().length;json.total_urls_amount=this.model.urls.length;this.$el.html(this.template(json));this.renderUrlsSlice();this.bindDrag();return this.$el},loadMore:function(){this.renderUrlsSlice();return false},updateUrlsCounter:function(){this.$(".js-section-link-amount").text(this.model.getUrlsAmount())},updatePlaceholder:function(){if(!this.model.getLocalUrls().length)this.$(".ui-urls").append(ul.util.t("urlist/empty_section"))},updateUrlPosition:function(e,ui){var prevItem=ui.item.prev(),nextItem=ui.item.next(),prevCid=prevItem.attr("data-cid"),nextCid=nextItem.attr("data-cid"),urls=this.urlist.get("urls"),thisModel=urls.get(ui.item.attr("data-cid")),prevModel=urls.get(prevCid),nextModel=urls.get(nextCid),direction=ui.position.top-ui.originalPosition.top,position,section;if(direction<0){if(prevModel){position=prevModel.get("position")+1;section=prevModel.get("section")}else if(nextModel){position=nextModel.get("position");section=nextModel.get("section")}else{position=this.urlist.lastPositionForSection(this.model.get("position"))+1;section=this.model.id}}else{if(prevModel){position=prevModel.get("position");section=prevModel.get("section")}else if(nextModel){position=nextModel.get("position")-1;section=nextModel.get("section")}else{position=this.urlist.lastPositionForSection(this.model.get("position"));section=this.model.id}}UL.Broker.push("move-url",{list_hash:this.urlist.get("hash"),url_hash:thisModel.get("hash")},{position:position,section:section})},bindDrag:function(){var that=this;if(!policies.urlist["sort_list"](C.get("user"),this.urlist))return;this.$(".ui-urls").sortable({handle:".ui-drag-handle",placeholder:"ui-state-highlight",helper:"clone",opacity:.8,connectWith:".ui-urls",start:function(event,ui){$("<div/>",{"class":"ui-state-highlight-content"}).appendTo(".ui-state-highlight")},update:function(e,ui){var isMyBusiness=that.$(".ui-urls").has(ui.item).length>0;if(isMyBusiness)that.updateUrlPosition(e,ui)}})},destroy:function(){this.unbindMe()}});view.urlist.Sections=ul.bbext.View.extend({initialize:function(){this.template=this.options.template||ul.util.t("urlist/urls");this.type=this.options.type;this.listenTo(this.collection,"add",this.appendSection)},appendSection:function(sectionModel){var sectionView=new view.urlist.Section({model:sectionModel,type:this.type,urlistView:this.options.urlistView}),html=sectionView.render();html.appendTo(this.$el).hide().slideDown("slow")},render:function(){var that=this;this.collection.each(this.appendSection,this)}});view.urlist.List=ul.bbext.View.extend({events:{"click a[href=#]":"preventLink","click .js-report-list":"reportCallback","click .js-suggest-link-add":"suggestLink","click .js-suggested-links":"suggestedLinks","click .js-edit-list":"editCallback","click .js-edit-contributors":"editContributorsCallback","click .js-edit-sections":"settingsListSections","click .js-add-section":"addSection","click .js-upload-cover_close":"hideNewCover","click .js-upload-cover_save":"confirmNewCover","click .js-list-delete-cover":"removeCover","click .js-image-upload-url":"uploadImageByUrl","click .js-search-image":"searchImageCallback","change   .js-upload-cover_input":"coverFileChange","click .js-share-list":"shareList","click .js-embed-list":"embedListDialog","click .js-for-clipboard":"selectForClipboard","mouseleave .js-url-item":"clearToggles","mouseleave .js-header-inner":"clearToggles","click .js-follow-list":"followList","click .js-unfollow-list":"unfollowList","click .js-show-followers":"showListFollowers"},initialize:function(){this.template=this.options.template||ul.util.t("urlist/list");this.listenTo(this.model,"change:title",this.changeTitle);this.listenTo(this.model,"change:description",this.changeDescription);this.listenTo(this.model,"change:is_secret",this.changeSecret);this.listenTo(this.model,"change:title",this.documentScript);this.listenTo(this.model,"change:description",this.documentScript)},deferredInitialize:function(){this.listenTo(this.model,"change:categories",this.renderCategories);this.listenTo(this.model,"change:categories",this.renderUrlistsSuggestion);this.listenTo(this.model.get("urls"),"add remove",this.updateUrlsCounter);this.listenTo(this.model.get("urls"),"add",this.removePlaceholder);this.listenTo(this.model.get("contributors"),"add remove",this.documentScript);this.listenTo(this.model.get("followers"),"add remove",this.updateFollowersCounter);this.listenTo(this.model.get("sections"),"add remove",this.updateSectionsVisibility);this.listenTo(this.model.get("sections"),"add remove",this.updateAddSectionVisibility);this.listenTo(this.model,"destroy",function(){UL.Router.navigate("/dashboard",{trigger:true})})},updateSectionsVisibility:function(){this.$(".list-page").toggleClass("list-show-sections",this.model.get("sections").length>1)},updateAddSectionVisibility:function(){this.$(".js-add-section").toggleClass("hide",this.model.get("sections").length>=UL.config.sections_limit)},updateUrlsCounter:function(){this.$(".js-urls-counter").text(this.model.get("urls").length)},updateFollowersCounter:function(){var followersAmount=this.model.get("followers").length;this.$(".js-list-followers").toggleClass("hide",!followersAmount);this.$(".js-list-followers-counter").text(followersAmount)},removePlaceholder:function(){this.$(".js-empty-placeholder").remove()},followList:function(e){if(ul.dialog.requireSignup())return false;var hash=this.model.get("hash");this.toggleFollow(e);UL.EventOriginator.push(e.getSource());UL.Broker.push("follow-list",{list_hash:hash});view.utils.displayAlert(ul.util.t("messages/bookmark_feedback")())},unfollowList:function(e){var hash=this.model.get("hash");this.toggleFollow(e);UL.EventOriginator.push(e.getSource());UL.Broker.push("unfollow-list",{list_hash:hash})},reportCallback:function(e){var reportView=new view.dialog.Report({model:this.model});reportView.render()},editCallback:function(e){var dialog=new view.dialog.SettingsList({model:this.model,dialogClass:"dialog-settings",closeOnOverlay:true});dialog.render()},editContributorsCallback:function(e){var dialog=new view.dialog.Contributors({model:this.model});dialog.render();return false},settingsListSections:function(e){var dialog=new view.dialog.SettingsListSections({model:this.model,collection:this.model.get("sections"),dialogClass:"dialog-settings-list-section",closeOnOverlay:true});dialog.render()},suggestLink:function(e){var dialog=new view.dialog.SuggestLink({model:this.model,dialogClass:"dialog--suggest-link"});dialog.render()},suggestedLinks:function(e){var dialog=new view.dialog.SuggestedLinks({model:this.model,dialogClass:"dialog--suggested-links"});dialog.render()},addSection:function(e){UL.Broker.push("add-section",{list_hash:this.model.get("hash")}).done(function(){$("html, body").animate({scrollTop:$(document).height()},"250")})},deferredAuthorRender:function(){var author=this.model.get("author"),template=ul.util.t("urlist/widget.author"),json=author.toJSON(),$html=template(json);this.$(".people .author").html($html)},renderSummary:function(){var summaryView=new view.urlist.Summary({el:this.$(".js-summary"),model:this.model});summaryView.render()},renderAuthor:function(){var author=this.model.get("author");if(author.has("screen_name")){this.deferredAuthorRender()}else{this.listenTo(author,"change",this.deferredAuthorRender);author.fetch()}},renderCategories:function(model,value){var template=ul.util.t("urlist/categories"),json={categories:this.model.getCategories()};this.$(".js-list_category-list").html(template(json));this.$(".js-categories-subheader").toggleClass("hide",!this.model.get("categories").length)},renderSections:function(){var sections=this.model.get("sections"),sectionsView=new view.urlist.Sections({el:this.$(".ui-urls-sections"),collection:sections,urlistView:this});sectionsView.render()},renderPeople:function(){var author=this.model.get("author"),contributors=this.model.get("contributors"),otherContributors=this.model.get("other_contributors"),peopleView=new view.urlist.People({el:this.$(".people"),model:author,urlist:this.model,collection:contributors,otherCollection:otherContributors});peopleView.render();this.listenTo(peopleView,"widgetReady",this.documentScript)},renderComments:function(){var comments=this.model.get("comments"),commentsView=new view.urlist.Comments({el:this.$("#comment-area"),model:this.model,collection:comments});commentsView.render()},renderUrlistsSuggestion:function(){var urlistsView=new view.suggestion.Urlists({el:this.$(".js-urlists-suggestion"),model:this.model});urlistsView.render();this.$(".js-popular-subheader").toggleClass("hide",this.model.get("categories").length>0);this.listenTo(urlistsView,"widgetReady",this.documentScript)},deferredRenderList:function(){setDocumentTitle(this.model.get("title"));var json=this.model.toJSON({calculated:true}),$html=this.template(json);this.deferredInitialize();this.$el.html($html);this.renderCategories();this.renderSummary();this.renderSections();this.renderPeople()},deferredRender:function(){console.info("[view.urlist]	","Render list",this.model.id);this.deferredRenderList();this.renderUrlistsSuggestion();this.documentScript();this.afterRender()},render:function(){this.model.whenReady().done(_.bind(this.deferredRender,this)).fail(function(){UL.Router.error404()});return this.$el},changeTitle:function(model,value){this.$(".js-list-title").text(value)},changeDescription:function(model,value){this.$(".js-list-description").removeClass("hide").html(model.htmlDescription())},changeSecret:function(model,value){this.$(".js-is-secret").toggle(value)},preventLink:function(e){e.preventDefault()},toggleFollow:function(e){e.preventDefault();this.$(".js-list-actions").toggleClass("is--done").addClass("is--triggered");this.$(".js-list-actions").one("mouseleave",function(){$(this).removeClass("is--triggered")})},clearToggles:function(){this.$(".dropdown-menu, .dropup-menu").removeClass("opened")},afterRender:function(){if(!Modernizr.canvas)return;var that=this,canvas=this.$el.find("#imageCanvas")[0],loader=this.$el.find("#coverUploader")[0],img=new Image,canvasImage;img.src="";this.canvasImage=new CanvasImage(canvas,loader,img);this.canvasImage.checkRatio=function(ratio){if(ratio>1.25){console.log("Ratio is not so good",ratio);view.utils.displayAlert("Please choose an image that is at least 738px wide and 280px tall. "+"The cover image represents your list, pick some good quality image :)");that.hideNewCover.call(that);return false}else{that.showNewCover.call(that);return true}};$(".js-list-upload-cover").on("click",function(){$(".js-upload-cover_input").trigger("click");return false});
this.listenTo(this.model,"sync",function(){UL.Router.list(that.model,true)})},coverFileChange:function(e){this._imgAuthor=null;this.showNewCover()},showNewCover:function(e){this.canvasImage.bindToCanvas();$(".cover-instructions").show();$(".cover-container").fadeIn(250);$(".list-info .head").addClass("head--custom");$(".js-toggle--edit_cover").addClass("js-switch");$(".head-inner").toggleClass("reveal-cover_editor")},hideNewCover:function(){this.canvasImage.clear();$(".cover-container").fadeOut(250);$(".list-info .head").removeClass("head--custom");$(".js-toggle--edit_cover").removeClass("js-switch");$(".head-inner").toggleClass("reveal-cover_editor")},selectRemoteCover:function(img,author){var that=this,loader=$(".cover-loader").fadeTo(250,1),spinner=(new Spinner).spin(loader[0]);$(this.canvasImage.img).one("load",function(){spinner.stop();$(".cover-loader").fadeOut(0)});this._imgAuthor=author;this.canvasImage.setNewCover(img)},confirmNewCover:function(){var that=this,encodedPNG=this.canvasImage.toDataURL(),loader=$(".cover-loader").fadeTo(250,.6),spinner=(new Spinner).spin(loader[0]);$(".cover-instructions").hide();$(".js-toggle--edit_cover").hide();this.canvasImage.unbindToCanvas();console.log("hello, we are using the BASE64 representation of your image.","Unfortunately, support for canvas and image/jpeg is not yet","supported by all browsers, so it can take some time");$.ajax({url:"{0}list/{1}/cover-image".format(API_ROOT,this.model.get("hash")),type:"POST",data:{png_base64:encodedPNG},success:function(coverUrl){UL.Broker.trigger("update-list-cover",{list_hash:that.model.get("hash")},{cover_image:coverUrl});UL.Broker.push("update-list-cover-author",{list_hash:that.model.get("hash")},{url_author:that._imgAuthor});$(".js-toggle--edit_cover").removeClass("js-switch");$(".head").addClass("head--custom");$(".js-head-cover").attr("src","");$(".head-inner").toggleClass("reveal-cover_editor");$(".js-toggle--edit_cover").show();spinner.stop();loader.fadeOut(250);$(".cover-container").fadeOut(250);$(".js-head-cover").attr("src",encodedPNG)}});return false},removeCover:function(){var dialogDelete=new view.dialog.GenericDelete({template:ul.util.t("dialog/delete_cover")});dialogDelete.render();this.listenTo(dialogDelete,"submit",function(){$.ajax({url:"{0}list/{1}/cover-image".format(API_ROOT,this.model.get("hash")),type:"DELETE"});$(".head-cover").attr("src","");$(".head--custom").removeClass("head--custom")});return false},uploadImageByUrl:function(e){var imageUrlView=new view.dialog.ImageUrlDialog;imageUrlView.render();this.listenTo(imageUrlView,"select-image",this.selectRemoteCover)},searchImageCallback:function(e){var searchImageView=new view.dialog.SearchImage({parentView:this});searchImageView.render();this.listenTo(searchImageView,"select-image",this.selectRemoteCover)},shareList:function(){var dialog=new view.dialog.ShareList({model:this.model,closeOnOverlay:true});dialog.render();return false},embedListDialog:function(){var dialog=new view.dialog.ShareList({model:this.model,closeOnOverlay:true,embed:true});dialog.render();return false},selectForClipboard:function(e){$(e.target).select()},showListFollowers:function(){var dialog=new view.dialog.ShowListFollowers({collection:this.model.get("followers"),dialogClass:"dialog-mini dialog-list-followers",title:"Bookmarked by",closeOnOverlay:true});dialog.render()},documentScript:function(){this.$(".js-add-section").toggleClass("hide",this.model.get("sections").length>=UL.config.sections_limit);var head=this.$(".head-inner").height(),desc=this.$(".list-description").outerHeight(),currHeight;$(".list-main-info").height(head-desc);currHeight=$(".list-main-info").height()+$(".list-description").height();if(currHeight>$(".head-inner").height())$(".head-inner").height(currHeight);$(".js-app-navigation").children("li").removeClass("active");this.$(".js-author-username").text(this.model.get("author").get("username"));return;var hash=window.location.hash;window.location.hash="";window.location.hash=hash}});view.urlist.Url=ul.bbext.View.extend({events:{"click .js-toggle-relist":"renderRelist","click .js-edit":"editCallback","click .js-relist":"relistCallback","click .js-move-url":"moveListCallback","click .js-url-share-gplus":"shareOnGoogle","click .js-url-share-twitter":"shareOnTwitter","click .js-url-share-facebook":"shareOnFacebook"},initialize:function(){this.template=ul.util.t("urlist/url.common");this.parent=this.options.parent;this.listenTo(this.model,"change:_status",this.changeStatus);this.listenTo(this.model,"change:hash",this.changeHash);this.listenTo(this.model,"change:position",this.changePosition);this.listenTo(this.model,"change:title",this.changeTitle);this.listenTo(this.model,"change:description",this.changeDescription);this.listenTo(this.model,"change:favicon",this.changeFavicon);this.listenTo(this.model,"destroy",this.destroy)},renderRelist:function(e){var currentTarget=$(e.currentTarget);var relistContainer=this.$(".js-relist-container");var trigger="js-switch";if(currentTarget.hasClass(trigger)){relistContainer.hide()}else{relistContainer.show()}this.$(".js-toggle-relist").toggleClass(trigger);var relistView=new view.urlist.Relist({model:this.model,el:this.$(".js-relist-container")});relistView.render()},deferredAuthorRender:function(){var author=this.model.get("relistedFromAuthor");this.$(".js-relist-author").text(author.get("screen_name"))},renderContributor:function(){var $el=this.$(".js-url-author"),author=this.model.get("author");author.whenReady().done(function(){$el.attr("href","/library/"+author.get("username"));$el.text(author.get("screen_name"))})},renderAuthor:function(){if(!this.model.has("relistedFromAuthor"))return;var author=this.model.get("relistedFromAuthor");author.whenReady().done(_.bind(this.deferredAuthorRender,this))},render:function(){var model=this.model,list_hash=model.get("list_hash"),url_hash=model.get("hash"),json=model.toJSON({calculated:true}),$html,$subhtml;if(this.model.needsFavicon())UL.Broker.push("fetch-url-data",{list_hash:list_hash,url_hash:url_hash},{key:"favicon"});json.digits=(this.model.get("position")+"").length;$html=this.template(json);this.setElement($html);this.renderAuthor();this.renderContributor();this.trigger("widgetReady");this.documentScript();return this.$el},changeStatus:function(model,value){this.$el.removeClass("status-"+model.previous("_status")).addClass("status-"+model.get("_status"))},changeHash:function(model,value){var list_hash=model.get("list_hash"),url_hash=model.get("hash"),full_url=[list_hash,url_hash].join("/");this.$(".js-url-title").attr("href",full_url);this.$el.attr("data-hash",value);if(this.model.needsFavicon())UL.Broker.push("fetch-url-data",{list_hash:list_hash,url_hash:url_hash},{key:"favicon"})},changePosition:function(model,value){var prevDigits=(model.previous("position")+"").length,digits=(value+"").length;this.$(".js-url-position").removeClass("n{0}-pos".format(prevDigits)).addClass("n{0}-pos".format(digits)).text(value)},changeTitle:function(model,value){this.$(".js-url-title").text(value)},changeDescription:function(model,value){this.$(".js-note").toggleClass("hide",!model.get("description")||!model.get("description").length);this.$(".js-note .js-text").html(model.htmlDescription())},changeFavicon:function(model,value){this.$(".js-favicon").attr("src",value)},shareCallback:function(e){},editCallback:function(e){var dialog=new view.dialog.EditUrl({model:this.model,dialogClass:"dialog-settings",closeOnOverlay:true});dialog.render()},moveListCallback:function(evnt){var dialog=new view.dialog.MoveUrl({model:this.model,dialogClass:"dialog-settings",closeOnOverlay:true,sourceEvent:evnt});dialog.render()},relistCallback:function(e){if(ul.dialog.requireSignup())return false;var dialog=new view.dialog.RelistUrl({model:this.model,dialogClass:"dialog-settings",closeOnOverlay:true,sourceEvent:e});dialog.render();return false},destroy:function(){this.unbindMe()},shareOnTwitter:function(){twitterShare(this.model.toTweet());return false},shareOnFacebook:function(){facebookShare(this.model.fullUrl());return false},shareOnGoogle:function(){googleShare(this.model.fullUrl());return false},documentScript:function(){}});view.widget.Url=view.urlist.Url.extend({initialize:function(){this.template=ul.util.t("widget/url")},renderAuthor:function(){var that=this,author=this.model.get("author");author.whenReady().done(function(){that.$(".js-author a").attr("href","/library/"+author.get("username"));that.$(".js-author .js-username").text(author.get("screen_name"));that.$(".js-author img").attr("src",author.get("profile_image"))})}});view.urlist.SummaryItem=ul.bbext.View.extend({tagName:"li",initialize:function(){this.urlistModel=this.options.urlistModel;this.template=ul.util.t("urlist/summary.item");this.listenTo(this.urlistModel.get("urls"),"add remove move",this.render);this.listenTo(this.model,"change",this.render);this.listenTo(this.model,"destroy",this.destroy)},render:function(){var json=this.model.toJSON({calculated:true}),html=this.template(json);this.$el.html(html);var a=this.model;if(!this.model.urlist.isMine()){if(this.model.calculatedAttributes.urls_amount()>0){return this.$el}else{return false}}else{return this.$el}},destroy:function(){this.unbindMe()}});view.Resource=ul.bbext.View.extend({initialize:function(){this.page=this.options.page},render:function(){var that=this,currentPage=this.page,currentPageName=currentPage.replace("/_resources/","");$("#footer").removeClass("hide");$.get(currentPage).done(function(html){that.$el.html(html);$("a[href$='"+currentPageName+"']").parent("li").addClass("active").siblings().removeClass("active")}).fail(function(){UL.Router.error404()})}});view.dialog.ResetPassword=Backbone.Dialog.extend({dialogClass:"dialog-password-reset",template:ul.util.t("dialog/reset_password"),submit:function(){var payload={password:this.$("input[name='new_password']").val(),recover_code:this.options.recoverCode};this.$(".js-error-message").addClass("hide");if(payload.password.length<5){this.$(".js-error-message[data-error='too-short']").removeClass("hide");return false}if(payload.password!=this.$("input[name='confirm_password']").val()){this.$(".js-error-message[data-error='not-match']").removeClass("hide");return false}UL.Broker.push("reset-password",{},payload).done(function(){window.location="/"}).fail(function(){view.utils.displayAlert("Ouch, something went wrong, try again :(","error")})}});view.dialog.SearchImage=Backbone.Dialog.extend({subevents:{"keypress .js-make-search-input":"inputCallback","click .js-make-search":"fetchResults","click .js-result-from-search":"selectImage","dblclick .js-result-from-search":"submitForm"},dialogClass:"search-image",fetchResults:function(){var query=slugify(this.$(".js-make-search-input").val()).split("-").join(","),loader=this.$(".js-render-results"),endpoint="http://api.flickr.com/services/rest/?method=flickr.photos.search&api_key=873b4ebea72e907cef976690e55f6551&tag_mode=all&safe_search=1&tags={0}&license=1%2C2%2C3%2C4%2C5%2C7&extras=url_l%2Curl_q&format=json&jsoncallback=?".format(query);this.$("ul.search-result-list").empty();this.$("ul.search-result-list").addClass("active");$.ajax({url:endpoint,dataType:"jsonp"}).done(_.bind(this.renderResults,this)).fail(_.bind(this.failedResults,this));this.spinner=(new Spinner).spin(loader[0]);return false},inputCallback:function(e){if(e.keyCode==13){this.fetchResults();return false}},renderResults:function(data){if(data.stat=="fail")return this.failedResults();this.clearResults();if(data.photos.photo.length>0){_.each(_.shuffle(data.photos.photo),function(e){var listItem;if(e.url_l){e.author_url="http://www.flickr.com/photos/{0}/".format(e.owner);listItem=ul.util.t("dialog/search_image.item")(e);this.$(".js-render-results").append(listItem)}},this)}else{var emptyItem=ul.util.t("dialog/search_image.emptyitem");this.$(".js-render-results").append(emptyItem)}},clearResults:function(){this.spinner.stop()},failedResults:function(data){this.clearResults();var errorItem=ul.util.t("dialog/search_image.erroritem");this.$(".js-render-results").append(errorItem)},selectImage:function(e){var rawImgURL=$(e.target).find("img").attr("data-fullsrc"),author=$(e.target).find("img").attr("data-authorurl"),tunnel=API_ROOT+"redirect?url=";this.selectedImage={url:tunnel+rawImgURL,author:author};$(e.target).addClass("active").siblings().removeClass("active")},subrender:function(){var template=ul.util.t("dialog/search_image"),$html=$(template());return $html},submitForm:function(){this.$("form").submit()},submit:function(){if(this.selectedImage)this.trigger("select-image",this.selectedImage.url,this.selectedImage.author)}});view.dialog.EditUrl=Backbone.Dialog.extend({dialogClass:"edit-url",template:ul.util.t("dialog/edit_url"),subevents:{"click .js-delete-url":"deleteUrlCallback"},subinitialize:function(){this.listenTo(this.model,"destroy",this.unbindAll)},deleteUrlCallback:function(e){var dialog=new view.dialog.DeleteUrl({model:this.model,closeOnOverlay:true});dialog.render();return false},submit:function(){var target={list_hash:this.model.getUrlist().get("hash"),url_hash:this.model.get("hash")},payload=_.purge({title:this.$("input[name='title']").val(),description:this.$("textarea[name='description']").val()});UL.Broker.push("update-url",target,payload)}});view.dialog.Contributors=Backbone.Dialog.extend({subevents:{"keypress input.js-input-contributor":"contributorSubmitOnEnter","click button.js-add-contributor":"contributorSubmit","click .js-contributor-delete":"contributorRemove"},dialogClass:"contributors",subinitialize:function(){this.listenTo(this.model.get("contributors"),"add",this.eventAddContributor);this.listenTo(this.model.get("contributors"),"remove",this.eventRemoveContributor);this.listenTo(this.model,"destroy",this.unbindAll)},contributorSubmitOnEnter:function(e){if(e.keyCode!=13)return;return false},contributorSubmit:function(){var store=this.$("input.js-input-contributor-store"),text=this.$("input.js-input-contributor");if(isEmail(text.val())){UL.Broker.push("add-contributor-by-email",{list_hash:this.model.get("hash")},{email:text.val()})}else{UL.Broker.push("add-contributor",{list_hash:this.model.get("hash")},{user_id:store.val()})}store.val("");text.val("");return false},contributorRemove:function(e){var contributorId=$(e.target).closest(".js-contributor").attr("data-user-id"),contributorModel=new model.Contributor({user_id:contributorId},{parse:true});var dialog=new view.dialog.DeleteContributor({model:contributorModel,urlistModel:this.model});dialog.render();return false},eventAddContributor:function(contributorModel){var $html=this.subrenderContributor(contributorModel);this.$(".js-contributors").append($html)},eventRemoveContributor:function(contributorModel){var userId=contributorModel.get("user_id"),$el=this.$(".js-contributor[data-user-id='{0}']".format(userId));$el.fadeOut()},subrenderContributor:function(contributorModel,options){var tmp=$("<li />"),that=this;contributorModel.whenReady().done(function(){var json=contributorModel.toJSON(),template=ul.util.t("dialog/contributors.item");if(options)_.extend(json,options);tmp.html($(template(json)))});return tmp},fetchContributors:function(request,response){var contributorsIds=this.model.get("contributors").pluck("user_id");contributorsIds.push(this.model.get("author").get("user_id"));var success=function(data){var filtered=_.reject(data.results,function(val){return _.indexOf(contributorsIds,val.user_id)>=0});response($.map(filtered,function(item){return{id:item.user_id,value:item.username,label:item.screen_name,avatar_url:item.profile_image}}))};$.ajax({url:API_ROOT+"search/users.json",dataType:"json",data:{q:request.term},success:success})},subrenderInputContributor:function($html){var that=this;$html.find(".js-input-contributor").autocomplete({minLength:3,source:_.bind(this.fetchContributors,this),open:function(){$("ul.ui-autocomplete").removeAttr("style").css({"z-index":"999999",position:"absolute"}).appendTo(".collaborators-find").fadeIn(100)},close:function(event,ui){},focus:function(event,ui){$html.find(".js-input-contributor-store").val(ui.item.id);$(".js-input-contributor").val(ui.item.value)},select:function(event,ui){var user_id=$(".js-input-contributor-store").val();$(".js-input-contributor").val("");$(".js-input-contributor-store").val("");UL.Broker.push("add-contributor",{list_hash:that.model.get("hash")},{user_id:user_id});event.preventDefault()}}).data("uiAutocomplete")._renderItem=function(ul,item){var itemTmpl="<a><img src='"+item.avatar_url+"'> "+item.label+" <i>("+item.value+")</i></a>";return $("<li class='clearfix'></li>").data("item.autocomplete",item).append(itemTmpl).appendTo(ul)}},subrender:function(){var me=C.get("user"),author=this.model.get("author"),json=this.model.toJSON(),template=ul.util.t("dialog/contributors"),$html=$(template()),$author=this.subrenderContributor(author,{author:true}),$me=this.subrenderContributor(me,{itsme:true});$html.find(".js-contributors").append($author);if(me.get("user_id")!=author.get("user_id"))$html.find(".js-contributors").append($me);this.model.get("contributors").forEach(function(contributorModel){if(contributorModel.get("user_id")!=me.get("user_id"))$html.find(".js-contributors").append(this.subrenderContributor(contributorModel))},this);this.subrenderInputContributor($html);return $html}});view.dialog.RecoverPassword=Backbone.Dialog.extend({dialogClass:"dialog-password-recover",subrender:function(){var template=ul.util.t("dialog/recover_password"),json=C.get("user").toJSON();return template(json)},success:function(){var template=ul.util.t("dialog/recover_password.success");this.$(".dialog-content").empty();this.$(".dialog-actions").remove();this.$(".dialog-content").append(template())},submit:function(){var email=this.$("input[name='email']").val();if(!view.utils.validateInput(this.$("input[name='email']")))return false;UL.Broker.push("recover-password",{email:email}).done(_.bind(this.success,this));return false}});view.dialog.RelistUrl=Backbone.Dialog.extend({dialogClass:"relist-url",subinitialize:function(){this.selectedList=null;this.selectedSection=null},subrender:function(){var json=this.model.toJSON(),template=ul.util.t("dialog/relist_url"),$html=$(template(json)),listSelector=new view.utils.ListSelector({el:$html.find(".js-list-selector")});this.listenTo(listSelector,"update",this.updateSelector);listSelector.render();return $html},updateSelector:function(listModel,section){this.selectedList=listModel;this.selectedSection=section},submit:function(){var that=this;var from_list_hash=this.model.get("from_list_hash");var from_url_hash=this.model.get("from_url_hash");if(!from_list_hash){from_list_hash=this.model.get("list_hash");from_url_hash=this.model.get("hash")}var toListSection=this.selectedSection;var target={list_hash:this.selectedList.get("hash")};var payload=_.purge({section:toListSection,url:this.model.get("url"),title:this.$("input[name='title']").val(),description:this.$("input[name='description']").val(),embed_handler:this.model.get("embed_handler"),from_list_hash:from_list_hash,from_url_hash:from_url_hash});UL.EventOriginator.push(this.getSource());UL.Broker.push("relist-url",target,payload).done(_.bind(this.success,this)).fail(function(){that.unbindAll();view.utils.displayAlert("Ouch, there was error, please give it another try.")});return false},success:function(){var template=ul.util.t("dialog/relist_url.success");this.$(".dialog-content").empty();this.$(".dialog-actions").remove();this.selectedList.superOld();this.$(".dialog-content").append(template(this.selectedList.toJSON()))}});view.dialog.Feedback=Backbone.Dialog.extend({template:ul.util.t("dialog/feedback"),submit:function(){var payload=_.purge({email:this.$("input[name='email']").val(),message:this.$("textarea[name='message']").val(),referral:window.location.href,user_agent:window.navigator.userAgent});$(".js-feedback-status").find(".js-toggle-one").addClass("hide");$(".js-feedback-status").find(".js-toggle-two").removeClass("hide");UL.Broker.push("new-feedback",{},payload)}});view.dialog.DeleteContributor=Backbone.Dialog.extend({dialogClass:"remove-contributor",template:ul.util.t("dialog/delete_contributor"),submit:function(){UL.Broker.push("remove-contributor",{list_hash:this.options.urlistModel.get("hash")},{user_id:this.model.id})}});view.dialog.SettingsList=Backbone.Dialog.extend({subevents:{"click .js-delete-list":"deleteListCallback","click .js-edit-contributors":"editContributorsCallback","click .js-edit-categories":"editCategories"},dialogClass:"settings-list",subinitialize:function(){this.listenTo(this.model,"destroy",this.unbindAll);this.listenTo(this.model,"change:categories",this.changeCategories)},subrender:function(){var json=this.model.toJSON({calculated:true}),template=ul.util.t("dialog/settings_list"),secret_lists_left=C.get("user").get("secret_lists_left"),$html=$(template(_.extend(json,{secret_lists_left:secret_lists_left})));return $html},editContributorsCallback:function(e){var dialog=new view.dialog.Contributors({model:this.model});dialog.render();return false},editCategories:function(e){var dialog=new view.dialog.SelectCategory({model:this.model});dialog.render();return false},changeCategories:function(model,value){this.$(".js-label-categories").text(this.model.getCategories());this.$(".js-category-add").addClass("hide");this.$(".js-category-change").removeClass("hide")},deleteListCallback:function(e){var dialog=new view.dialog.DeleteList({model:this.model,closeOnOverlay:true});dialog.render();return false},submit:function(){var target={list_hash:this.model.get("hash")},payload=_.purge({title:this.$("input[name='title']").val(),slug:this.$("input[name='generated-value']").val(),description:this.$("textarea[name='description']").val()});if(this.model.get("is_secret"))payload.is_secret=!this.$("input[name='secret']").is(":checked");UL.Broker.push("update-list",target,payload)}});view.dialog.GenericDelete=Backbone.Dialog.extend({dialogClass:"remove-list"});view.dialog.NewList=Backbone.Dialog.extend({dialogClass:"new-list narrower",subevents:{"keyup input[name='title']":"validateInput"},subinitialize:function(){this.model=this.model||C.get("user")},subrender:function(){var template=ul.util.t("dialog/new_list"),json=this.model.toJSON({calculated:true});return template(json)},validateInput:function(e){view.utils.validateInput($(e.target))},submit:function(){var target={},payload=_.purge({title:this.$("input[name='title']").val(),description:this.$("textarea[name='description']").val(),is_secret:this.$("input[name='secret']:checked").val()=="true"});if(!view.utils.validateInput(this.$("input[name='title']")))return false;UL.EventOriginator.push(this.getSource());UL.Broker.push("add-list",target,payload,{gotoList:this.options.gotoList})}});view.dialog.SettingsListSections=Backbone.Dialog.extend({subevents:{"click .js-add-section":"newSection","click .js-delete-section":"deleteSection"},dialogClass:"settings-list-sections",subinitialize:function(){this.settingsTemplate=ul.util.t("dialog/settings_list_sections");this.settingsItemTemplate=ul.util.t("dialog/settings_list_sections.item");this.listenTo(this.collection,"remove",this.removeSection);this.listenTo(this.collection,"add",this.addSection);this.listenTo(this.collection,"add remove",this.updateAddSectionVisibility);this.listenTo(this.collection,"add remove",this.updateSectionsLeft)},subrender:function(){var that=this,json={sections:[]},$html=$(this.settingsTemplate({sections_left:this.collection.getSectionsLeft()})),$ul=$html.find(".js-reference-sections");$ul.empty();this.collection.forEach(function(u){$ul.append(that.settingsItemTemplate(u.toJSON({calculated:true})))});$ul.sortable({axis:"y",handle:".label-section",helper:"clone",start:function(){$ul.addClass("sorting");that.movedSections=true},stop:function(){$ul.removeClass("sorting")}});return $html},updateAddSectionVisibility:function(){this.$(".js-add-section").toggleClass("hide",!this.collection.getSectionsLeft())},updateSectionsLeft:function(){this.$(".js-counter-sections-left").text(this.collection.getSectionsLeft())},removeSection:function(m){this.$(".js-section-item[data-cid='{0}']".format(m.cid)).slideUp("slow").fadeOut("slow",function(){$(this).remove()})},newSection:function(e){UL.Broker.push("add-section",{list_hash:this.model.get("hash")})},addSection:function(sectionModel){var $ul=this.$(".js-reference-sections"),$elem;$elem=$(this.settingsItemTemplate(sectionModel.toJSON({calculated:true})));$elem.appendTo($ul).hide().slideDown("slow");if($ul.find("input").length>UL.config.sections_limit){this.$(".js-add-section").addClass("inactive")}return false},deleteSection:function(e){var $ul=this.$(".js-reference-sections"),$this=$(e.target),list_hash=this.model.get("hash"),cid=$this.closest(".js-section-item").attr("data-cid"),id=this.collection.get(cid).id;dialogView=new view.dialog.GenericDelete({template:ul.util.t("dialog/delete_section"),submit:function(e){UL.Broker.push("remove-section",{list_hash:list_hash,section_id:parseInt(id)})}});dialogView.render();return false},submit:function(){var that=this,$inputs=this.$(".js-reference-sections input"),data=[];$inputs.each(function(){var $this=$(this),cid=$this.closest(".js-section-item").attr("data-cid"),id=that.collection.get(cid).id,title=$.trim($this.val());data.push({section_id:parseInt(id),title:title})});UL.Broker.push("update-sections",{list_hash:this.model.get("hash")},{sections:data}).done(function(){if(that.movedSections)that.model.fetch()})}});view.dialog.SignupModal=Backbone.Dialog.extend({dialogClass:"dialog-unlogged signup-modal",subevents:{"keyup input[name='email']":"validateInput","keyup input[name='password']":"validateInput","click .js-toggle":"toggleBlock","click [data-track-source]":"trackSource"},subinitialize:function(){this.options.standalone=true},subrender:function(){var template,url,next,json;if(this.options.aggressive){template=ul.util.t("dialog/signup_aggressive");$(".dialog-placing").addClass("is-aggressive");$(".signup-modal")[0].className="dialog-wrapper dialog-unlogged signup-modal-plain"}else if(this.options.beta){template=ul.util.t("dialog/signup_beta");$(".signup-modal")[0].className="dialog-wrapper dialog-unlogged signup-modal-plain signup-beta"}else{template=ul.util.t("dialog/signup_modal")}if(this.options.nextUrl)url=this.options.nextUrl;else url=window.location.href;next=encodeURIComponent(url);json={facebook_url:API_ROOT+"login/facebook?next={0}".format(next),twitter_url:API_ROOT+"login/twitter?next={0}".format(next),google_url:API_ROOT+"login/google?next={0}".format(next),app_id:CONFIG.fb.app_id};json.onboarding=this.options.onboarding;return template(json)},loginDialog:function(){var dialog=new view.dialog.LoginModal({});dialog.render()},validateInput:function(e){view.utils.validateInput($(e.target))},trackSource:function(){var expires=new Date;expires.setMinutes(expires.getMinutes()+5);if(this.options.source){$.cookie("_ul_signup_source",this.options.source,{expires:expires});$.cookie("_ul_follow_list",this.options.listHash,{expires:expires})}},toggleBlock:function(){this.$(".js-toggle-one").addClass("hide");this.$(".js-toggle-two").removeClass("hide");this.$(".js-toggle-two input:first").focus();$(".signup-modal").animate({top:"-100px"});return false},loginSuccess:function(){window.location.reload()},error:function(response){console.debug("response:",response);if(response==="InvalidPassword"){this.$(".error-message[data-error='invalid-password']").removeClass("hide")}else if(response==="Mail address already associated with an Urlist account."){this.$(".error-message[data-error='already-exists']").removeClass("hide")}else{view.utils.displayAlert("Sorry, something went wrong here. Try again, please","error")}},submit:function(){var payload={email:this.$("input[name='email']").val(),password:this.$("input[name='password']").val()},emailIsValid=view.utils.validateInput(this.$("input[name='email']")),passwIsValid=view.utils.validateInput(this.$("input[name='password']"));this.$(".error-message").addClass("hide");if(payload.password.length<5){this.$(".error-message[data-error='too-short']").removeClass("hide");return false}if(emailIsValid&&passwIsValid){var that=this;UL.Broker.push("new-profile",{},payload).done(function(){UL.Broker.push("authenticate",{},payload).done(that.loginSuccess).fail(function(){view.utils.displayAlert("Sorry, something went wrong here. Try again, please","error")})}).fail(_.bind(this.error,this))}return false},cancel:function(){$.removeCookie("_ul_signup_source");$.removeCookie("_ul_follow_list")}});view.dialog.Report=Backbone.Dialog.extend({dialogClass:"report",template:ul.util.t("dialog/report"),submit:function(){var payload=_.purge({email:this.$("input[name='email']").val(),message:this.$("textarea[name='message']").val(),user_agent:window.navigator.userAgent});UL.Broker.push("report-list",{list_hash:this.model.get("hash")},payload).done(function(){view.utils.displayAlert("Report submitted")})}});view.dialog.SuggestLink=Backbone.Dialog.extend({dialogClass:"suggest-link",template:ul.util.t("dialog/suggest_link"),subevents:{},subinitialize:function(){},subrender:function(){var json=this.model.toJSON();var sections=this.model.get("sections").toJSON();json.sections=sections.length>1?sections:null;json.suggested_url=$.cookie("ul.suggest.url");json.suggested_description=$.cookie("ul.suggest.description");var $html=$(this.template(json));return $html},documentScript:function(){this.$("select").niceSelect()},manageAnon:function(){var listHash=this.model.get("hash"),url=normalizeUrl(this.$("input[name='url']").val()),description=this.$("textarea[name='description']").val(),sectionId=this.$("select[name='section_id']").val();ul.dialog.signupContinue();$.cookie("_ul_suggest_list_hash",listHash,{expires:1});$.cookie("_ul_suggest_url",url,{expires:1});$.cookie("_ul_suggest_description",description,{expires:1});$.cookie("_ul_suggest_section_id",sectionId,{expires:1})},suggestUrl:function(){var that=this,target={list_hash:this.model.get("hash")},payload={url:normalizeUrl(this.$("input[name='url']").val()),description:this.$("textarea[name='description']").val(),section_id:this.$("select[name='section_id']").val()};this.toggleActions(false);return UL.Broker.push("suggest-url",target,payload).done(_.bind(this.success,this)).fail(function(){that.toggleActions(true);view.utils.displayAlert("Ouch, there was error, are you sure it was a link?")})},submit:function(){if(C.get("user").isAnonymous()){this.manageAnon();return false}var that=this,a=view.utils.validateInput(this.$("input[name='url']"));if(!a){this.$(".error-message").removeClass("hide");return false}this.suggestUrl();return false},success:function(){var template=ul.util.t("dialog/suggest_link.success");this.$(".dialog-content").empty();this.$(".dialog-actions").remove();this.$(".dialog-content").append(template(this.model.toJSON()))}});view.dialog.EditPassword=Backbone.Dialog.extend({dialogClass:"dialog-password-edit",template:ul.util.t("dialog/edit_password"),success:function(){view.utils.displayAlert("Password saved!","confirm");this.unbindMe()},error:function(data){this.$(".js-error-message[data-error='wrong-password']").removeClass("hide")},submit:function(){var payload={old_password:this.$("input[name='old_password']").val(),new_password:this.$("input[name='new_password']").val()};this.$(".js-error-message").addClass("hide");if(payload.new_password.length<5){this.$(".js-error-message[data-error='too-short']").removeClass("hide");return false}if(payload.new_password!=this.$("input[name='confirm_password']").val()){this.$(".js-error-message[data-error='not-match']").removeClass("hide");return false}UL.Broker.push("change-password",{},payload).done(_.bind(this.success,this)).fail(_.bind(this.error,this));return false}});view.dialog.ShowListFollowers=Backbone.Dialog.extend({subevents:{},dialogClass:"dialog-mini dialog-list-followers",renderFollower:function($html,modelFollower){var template=ul.util.t("dialog/show_list_followers.item");
modelFollower.whenReady().done(function(){$html.find(".js-followers").append(template(modelFollower.toJSON()))})},subrender:function(){var that=this,template=ul.util.t("dialog/show_list_followers"),$html=$(template({title:this.options.title}));this.collection.each(function(modelFollower){this.renderFollower($html,modelFollower)},this);return $html},submit:function(){}});view.dialog.MigrateList=Backbone.Dialog.extend({dialogClass:"remove-list",template:ul.util.t("dialog/migrate_list")});view.dialog.DeactivateAccount=Backbone.Dialog.extend({dialogClass:"dialog-deactivate-account",subrender:function(){var json=this.model.toJSON(),template=ul.util.t("dialog/deactivate_account");return template(json)},submit:function(){}});view.dialog.AddPassword=Backbone.Dialog.extend({dialogClass:"dialog-password-add",subrender:function(){var json=this.model.toJSON(),template=ul.util.t("dialog/add_password");return template(json)},submit:function(){}});view.dialog.ImageUrlDialog=Backbone.Dialog.extend({subrender:function(){var template=ul.util.t("dialog/image_url_dialog"),$html=$(template());return $html},submit:function(){var val=this.$(".js-url-input").val();tunnel=API_ROOT+"redirect?url="+val;if(val)this.trigger("select-image",tunnel,val)}});view.dialog.ShowListFollowing=Backbone.Dialog.extend({subevent:{},renderFollowing:function($html,modelFollowing){var template=ul.util.t("dialog/show_list_following.item");modelFollowing.whenReady().done(function(){$html.find(".js-following").append(template(modelFollowing.toJSON()))})},subrender:function(){var that=this;var template=ul.util.t("dialog/show_list_following");var $html=$(template({title:this.options.title}));this.collection.each(function(modelFollowing){this.renderFollowing($html,modelFollowing)},this);return $html},submit:function(){}});view.dialog.ShareList=Backbone.Dialog.extend({dialogClass:"dialog-share_list",subevents:{"click .js-trigger-share--email":"renderShareEmail","click .js-trigger-share--gplus":"shareListToGoogle","click .js-trigger-share--twitter":"shareListToTwitter","click .js-trigger-share--facebook":"shareListToFacebook","click .js-toggle-advanced-embedding":"toggleAdvancedEmbedding"},subrender:function(){var json=this.model.toJSON({calculated:true});var template=ul.util.t("dialog/share_list");var author_screenname=this.model.get("userauthor").get("screen_name");var author_username=this.model.get("userauthor").get("username");var embedRoot="//"+window.location.host;var $html=$(template(_.extend(json,{author_screenname:author_screenname,author_username:author_username,embedroot:embedRoot,embed:this.options.embed})));return $html},success:function(){var template=ul.util.t("dialog/share_list_email.success");this.$(".js-dialog--hook").empty();this.$(".js-dialog--hook").append(template())},renderShareEmail:function(){if(ul.dialog.requireSignup())return false;var json=this.model.toJSON(),template=ul.util.t("dialog/share_list_email");this.$(".js-dialog--hook").empty();this.$(".js-dialog--hook").append(template(json));return false},shareListToTwitter:function(){twitterShare(this.model.toTweet());UL.Broker.trigger("share-list",{list_hash:this.model.get("hash")},null,null,{channel:"twitter"});return false},shareListToFacebook:function(){facebookShare(this.model.fullUrl());UL.Broker.trigger("share-list",{list_hash:this.model.get("hash")},null,null,{channel:"facebook"});return false},shareListToGoogle:function(){googleShare(this.model.fullUrl());UL.Broker.trigger("share-list",{list_hash:this.model.get("hash")},null,null,{channel:"google"});return false},toggleAdvancedEmbedding:function(e){var parentToggle=$(e.target).parents(".js-toggle");parentToggle.toggleClass("js-switch");parentToggle.find("textarea:visible").trigger("click").select()},afterRender:function(){this.$("input[autofocus]").focus();this.$("textarea[autofocus]").select()},submit:function(){var that=this,payload={emails:this.$("input[name='emails']").val(),message:this.$("textarea[name='message']").val()},isValid=_.chain(payload.emails.split(",")).map($.trim).all(isEmail).value();this.$(".js-recipients-error").not(isValid).toggleClass("hide");if(!isValid)return false;UL.Broker.push("share-list",{list_hash:this.model.get("hash")},payload,{channel:"email"}).done(_.bind(this.success,this)).fail(function(){view.utils.displayAlert("There was an error sending the email :(","error")})}});view.dialog.SuggestedLinks=Backbone.Dialog.extend({dialogClass:"suggested-links",template:ul.util.t("dialog/suggested_links"),subevents:{"click .js-trigger-accepted":"acceptLink","click .js-trigger-noaccept":"declineLink"},subinitialize:function(){},fillUser:function($el,user){user.whenReady().done(function(){$el.attr("href","/library/"+user.get("username"));$el.text(user.get("screen_name"))})},subrender:function(){var json=this.model.toJSON(),$html=$(this.template(json)),users=$html.find("[data-user_id]"),i,$user;for(i=0;i<users.length;i++){$user=$(users[i]);this.fillUser($user,new model.User({user_id:$user.data("user_id")}))}return $html},acceptLink:function(e){var suggestionId=$(e.target).closest("[data-suggestion_id]").data("suggestion_id");UL.Broker.push("suggested-url-accept",{list_hash:this.model.get("hash")},{suggestion_id:suggestionId}).done(function(){$(e.target).parents(".js-actions_link").find(".js-accepted").siblings().addClass("hide");$(e.target).parents(".js-actions_link").find(".js-accepted").removeClass("hide")}).fail(function(error){if(error=="UrlExists"){view.utils.displayAlert("The suggested link is already listed.");$(e.target).parents(".js-actions_link").find(".js-accepted").siblings().addClass("hide");$(e.target).parents(".js-actions_link").find(".js-accepted").removeClass("hide")}else{view.utils.displayAlert("Ouch, there was error, please reload the page.","error")}});return false},declineLink:function(e){var suggestionId=$(e.target).closest("[data-suggestion_id]").data("suggestion_id");UL.Broker.push("suggested-url-decline",{list_hash:this.model.get("hash")},{suggestion_id:suggestionId}).done(function(){$(e.target).parents(".js-actions_link").find(".js-noaccept").siblings().addClass("hide");$(e.target).parents(".js-actions_link").find(".js-noaccept").removeClass("hide")}).fail(function(){view.utils.displayAlert("Ouch, there was error, please give it another try.","error")});return false},_unbindMe:function(){this.model.fetch()}});view.dialog.MoveUrl=Backbone.Dialog.extend({dialogClass:"move-url",template:ul.util.t("dialog/move_url"),subinitialize:function(){this.selectedList=null;this.selectedSection=null},subrender:function(){var json=this.model.toJSON();var $html=$(this.template(json));var listSelector=new view.utils.ListSelector({el:$html.find(".js-list-selector")});this.listenTo(listSelector,"update",this.updateSelector);listSelector.render();return $html},updateSelector:function(listModel,section){this.selectedList=listModel;this.selectedSection=section},submit:function(){var fromListHash=this.model.getUrlist().get("hash");var fromUrlHash=this.model.get("hash");var toListSection=this.selectedSection;var toListHash=this.selectedList.get("hash");var that=this;if(fromListHash===toListHash){UL.Broker.push("move-url",{list_hash:toListHash,url_hash:fromUrlHash,section:toListSection},{}).done(function(){view.utils.displayAlert("Link is moved. All is good.");var movedLink=$("[data-hash='{0}']".format(fromUrlHash));$("[data-section_id='{0}']".format(toListSection)).prepend(movedLink)}).fail(function(){view.utils.displayAlert("Whoops! Something went wrong. Try again?")})}else{var target={from_list:{list_hash:fromListHash,url_hash:fromUrlHash},to_list:{list_hash:toListHash,section:toListSection}};UL.Broker.push("move-url-to-another-list",target,{}).done(function(){view.utils.displayAlert("The link is moved. <a href='/{0}' class='js-navigate' >Go there</a>".format(toListHash))}).fail(function(data){if(data==="UrlExists"){view.utils.displayAlert("That link is already there. No need to worry :)")}else{view.utils.displayAlert("Oh gosh. Something went wrong. We are super sorry")}})}}});view.dialog.DeleteUrl=Backbone.Dialog.extend({dialogClass:"remove-url",template:ul.util.t("dialog/delete_url"),submit:function(){var list_hash=this.model.collection.urlist.get("hash"),url_hash=this.model.get("hash");UL.Broker.push("remove-url",{list_hash:list_hash,url_hash:url_hash},{})}});view.dialog.SelectCategory=Backbone.Dialog.extend({dialogClass:"dialog--select_category",subevents:{"click input[name='category']":"updateCategory"},subinitialize:function(){},subrender:function(){var template=ul.util.t("dialog/select_category"),json=this.model.toJSON({calculated:true});json.all_categories=UL.ORDERED_CATEGORIES;return template(json)},updateCategory:function(e){var $check=$(e.target),checkedLength=this.$("input[name='category']:checked").length;if(checkedLength>0){this.$("input[type='submit']").removeAttr("disabled");this.$("input[type='submit']").removeClass("inactive")}else{this.$("input[type='submit']").attr("disabled","disabled");this.$("input[type='submit']").addClass("inactive")}if(checkedLength>2)return false},validateInput:function(e){view.utils.validateInput($(e.target))},submit:function(){var target={list_hash:this.model.get("hash")},payload={categories:_.map(this.$("input[name='category']:checked"),function(e){return $(e).val()})};UL.EventOriginator.push(this.getSource());UL.Broker.push("update-categories",target,payload)}});view.dialog.DeleteList=Backbone.Dialog.extend({dialogClass:"remove-list",template:ul.util.t("dialog/delete_list"),submit:function(){var list=this.model,user=C.get("user");UL.Broker.push("remove-list",{list_hash:list.get("hash")})}});view.dialog.LoginModal=Backbone.Dialog.extend({dialogClass:"dialog-unlogged login-modal",subevents:{"keyup input[name='username']":"validateInput","keyup input[name='password']":"validateInput"},subinitialize:function(){this.options.standalone=true},subrender:function(){var template=ul.util.t("dialog/login_modal"),next=encodeURIComponent(window.location.href),json={facebook_url:API_ROOT+"login/facebook?next={0}".format(next),twitter_url:API_ROOT+"login/twitter?next={0}".format(next),google_url:API_ROOT+"login/google?next={0}".format(next)};return template(json)},validateInput:function(e){view.utils.validateInput($(e.target))},success:function(){window.location.reload()},error:function(){this.$(".js-login-error").removeClass("hide")},submit:function(){var payload={email:this.$("input[name='username']").val(),password:this.$("input[name='password']").val()},a=view.utils.validateInput(this.$("input[name='username']")),b=view.utils.validateInput(this.$("input[name='password']"));if(a&&b){UL.Broker.push("authenticate",{},payload).done(_.bind(this.success,this)).fail(_.bind(this.error,this))}return false}});router.Main=Backbone.Router.extend({routes:{"":"root",activity:"activity","discover/top":"discoveryTop","discover/network":"discoveryNetwork","discover/network/links":"discoveryNetworkLinks","discover/follow":"discoveryFollow",discover:"discovery","user/:args":"compUser",dashboard:"dashboard",library:"dashboard","library/":"dashboard","library/:user/created":"dashboardAuthored","library/:user/joined":"dashboardJoined","library/:user/bookmarks":"dashboardBookmarks","library/:user":"dashboardAll","search/me/:query/links":"searchMyLibraryLinks","search/me/:query":"searchMyLibrary","search/network/:query/links":"searchNetworkLinks","search/network/:query":"searchNetwork","search/:query/links":"searchGlobalLinks","search/:query":"searchGlobal",settings:"settings","settings/:dialog":"settings","error/404":"error404",landing:"landingPage","resources/:page":"resource","category/:name":"category","category/:name/popular":"category","category/:name/new":"categoryNew","category/:name/network":"categoryNetwork","hashtag/:hashtag":"hashtag","hashtag/:hashtag/popular":"hashtag","hashtag/:hashtag/new":"hashtagNew","hashtag/:hashtag/network":"hashtagNetwork",logout:"logout",":list_hash/:url_hash":"listNavigation",":list_hash/":"listNavigation",":hash":"list"},initialize:function(){this.current={}},root:function(){if(C.get("user").isAnonymous()){this.landingPage()}else{this.discoveryNetwork()}},getNavigation:function(urlistModel){if(this.current.name!="navigation."+urlistModel.get("hash")){this.cleanUp();this.current.view=new view.navigation.Navigation({el:$("#content"),model:urlistModel});this.current.name="navigation."+urlistModel.get("hash");this.current.view.render()}V=this.current.view;this.finalize();return this.current.view},manageDialog:function(){var name=getLocationParameter("d"),that=this;if(name=="recover"){var recoverCode=getLocationParameter("recover_code"),dialog=new view.dialog.ResetPassword({dialogClass:"dialog-reset-password",recoverCode:recoverCode,onlySubmit:true});dialog.render()}else if(name=="onboarding"){new view.dialog.NewList({model:C.get("user"),closeOnOverlay:false,gotoList:true,onboarding:true}).render()}else if(name=="categorize"){this.current.view.model.whenReady().done(function(){new view.dialog.SelectCategory({model:that.current.view.model}).render()})}},cleanUp:function(){ul.view.util.clearMessages();$(".tooltip").remove();$(".search_cta-list").removeClass("show");$(".dropdown").removeClass("is--active");$(".js-app-navigation li").removeClass("active");if(this.current.view){this.current.view.unbindMe();$("#header").after("<div id='content' />")}$("#header").show();$("body").removeClass("landing-page");$(".sticker-scrollTop").removeClass("hide");$("#footer").addClass("hide");UL.DialogStack.cleanAll()},finalize:function(){this.manageDialog()},scrollToTop:function(){$("html, body").animate({scrollTop:0},200)},landingPage:function(){this.cleanUp();var landingPageView=new view.LandingPage({el:$("#content")});landingPageView.render();$("#header").hide();setDocumentTitle("Curate your World");this.current.view=landingPageView;UL.Broker.trigger("view-landing");this.finalize()},getDiscovery:function(){this.cleanUp();this.current.view=new view.discovery.Discovery({el:$("#content")});this.current.name="discovery";this.current.view.render();setDocumentTitle("Discovery");return this.current.view},discovery:function(){var discoveryView=this.getDiscovery();discoveryView.renderMain();setDocumentTitle("Popular");this.scrollToTop();this.finalize()},discoveryNetwork:function(name){if(!C.get("user").isAnonymous()){var discoveryView=this.getDiscovery();discoveryView.renderNetwork();setDocumentTitle("Your Network");UL.Broker.trigger("view-discovery");this.finalize()}else{this.root()}},discoveryNetworkLinks:function(name){var discoveryView=this.getDiscovery();discoveryView.renderNetworkLinks();setDocumentTitle("Your Network");UL.Broker.trigger("view-discovery");this.finalize()},discoveryFollow:function(name){var discoveryView=this.getDiscovery();discoveryView.renderFollow();setDocumentTitle("Follow More");UL.Broker.trigger("view-discovery");this.finalize()},category:function(name,sort,network){network=network===true;sort=sort||"popularity";this.cleanUp();var inUse=_.findWhere(UL.CATEGORIES,{slug:name})!=undefined;if(inUse){var categoryModel=new model.Category({name:name,network:network,sort:sort}),categoryView=new view.Category({model:categoryModel,el:$("#content")}),categoryLabel=_.findWhere(UL.CATEGORIES,{slug:name}).label;categoryView.render();$(".js-toolbar li").removeClass("acive");$(".js-toolbar .js-"+sort).parent().addClass("active");setDocumentTitle("Explore {0}".format(categoryLabel));this.current.name="category-"+name;this.current.view=categoryView;UL.Broker.trigger("view-category",name);this.finalize()}else{this.error404()}},categoryNew:function(name){return this.category(name,"-creation_time")},categoryNetwork:function(name){return this.category(name,"network",true)},hashtag:function(hashtag,sort,network){network=network===true;sort=sort||"popularity";this.cleanUp();var hashtagModel=new model.Hashtag({hashtag:hashtag,network:network,sort:sort});var hashtagView=new view.Hashtag({model:hashtagModel,el:$("#content")});hashtagView.render();$(".js-toolbar li").removeClass("acive");$(".js-toolbar .js-"+sort).parent().addClass("active");setDocumentTitle("Discover {0}".format(hashtag));this.current.view=hashtagView;UL.Broker.trigger("view-hashtag",hashtag);this.finalize()},hashtagNew:function(hashtag){return this.hashtag(hashtag,"-creation_time")},hashtagNetwork:function(hashtag){return this.hashtag(hashtag,"network",true)},getDashboard:function(profileModel){profileModel=profileModel||ul.util.getCurrentProfile();if(this.current.name!="profile."+profileModel.get("username")){this.cleanUp();this.current.view=new view.dashboard.Dashboard({el:$("#content"),model:profileModel});this.current.name="profile."+profileModel.get("username");this.current.view.render()}setDocumentTitle(profileModel.get("screen_name")+"'s Profile");UL.Broker.trigger("view-profile",profileModel);this.finalize();return this.current.view},compUser:function(args){return UL.Router.navigate("/library/{0}".format(args),{trigger:true})},dashboard:function(username,what,params){var profileModel,that;if(!username){return UL.Router.navigate("/library/{0}".format(C.get("user").get("username")),{trigger:true})}what=what||"all";profileModel=new model.Profile({username:username});that=this;profileModel.whenReady().done(function(){var funcName="render"+what.toTitleCase();that.getDashboard(profileModel)[funcName](params)}).fail(function(){UL.Router.error404()});this.finalize()},dashboardAll:function(username){this.dashboard(username,"all")},dashboardAuthored:function(username){this.dashboard(username,"authored")},dashboardJoined:function(username){this.dashboard(username,"joined")},dashboardBookmarks:function(username){this.dashboard(username,"bookmarks")},activity:function(){if(ul.dialog.requireSignup())return false;this.getDiscovery().renderActivity()},search:function(query,scope,display){this.cleanUp();var searchModel=new model.Search({query:query,scope:scope});var searchView=new view.search.Search({el:$("#content"),model:searchModel,display:display});this.current.view=searchView;this.current.name=["search",query,scope,display].join("-");searchView.render();this.scrollToTop();this.finalize();UL.Broker.trigger("search",query)},searchMyLibraryLinks:function(query){return this.search(query,"me","links")},searchMyLibrary:function(query){return this.search(query,"me","lists")},searchNetworkLinks:function(query){return this.search(query,"network","links")},searchNetwork:function(query){return this.search(query,"network","lists")},searchGlobalLinks:function(query){return this.search(query,"global","links")},searchGlobal:function(query){var hashtagRegex=/^#\w+$/;if(hashtagRegex.test(query)){var hashtag=query.substring(1,query.length);UL.Router.navigate("/hashtag/{0}".format(hashtag),{trigger:true});return false}else{return this.search(query,"global","lists")}},logout:function(){$.get(API_ROOT+"logout").done(function(){window.location="/"})},resource:function(page){this.cleanUp();var pageView=new view.Resource({el:$("#content"),page:"/_resources/"+page});this.current.view=pageView;this.current.name="resource";switch(page){case"about":setDocumentTitle("About");break;case"jobs":setDocumentTitle("Jobs");break;case"button":setDocumentTitle("Urlist Button");break;case"privacy":setDocumentTitle("Privacy Policies");break;case"terms":setDocumentTitle("Terms of service")}$("body").attr("data-view","page:"+page);pageView.render();this.finalize()},error404:function(){this.cleanUp();this.current.view=new ul.bbext.View({template:ul.util.t("error/404"),el:$("#content")});$("#main").removeClass("content-app");this.current.view.render();this.finalize()},settings:function(dialog){if(ul.dialog.requireSignup())return false;this.cleanUp();var settingsModel=C.get("user");var settingsView=new view.Settings({el:$("#content"),model:settingsModel});this.current.view=settingsView;this.current.name="settings";settingsView.render();setDocumentTitle("Your Settings");this.scrollToTop();this.finalize()},listNavigation:function(list_hash,url_hash){var list_hash=list_hash.split("-")[0],url_hash=url_hash&&url_hash.split("-")[0],that=this,urlistModel=new ul.model.Urlist({hash:list_hash});urlistModel.whenReady().done(function(){var urlModel;if(!url_hash)url_hash=urlistModel.get("urls").at(0).get("hash");urlModel=urlistModel.getUrlByHash(url_hash);that.getNavigation(urlistModel).goHash(url_hash);UL.Broker.trigger("view-url",urlistModel,urlModel)})},list:function(hash,refresh){this.cleanUp();this.scrollToTop();var urlistModel=typeof hash==="string"?new ul.model.Urlist({hash:hash.split("-")[0]}):hash,urlistView=new view.urlist.List({el:$("#content"),model:urlistModel});this.current.view=urlistView;this.current.name="urlist";window.currentView=urlistView;var that=this;urlistModel.fetch().done(function(){urlistView.render();if(!refresh){UL.Broker.trigger("view-list",urlistModel)}that.finalize()}).fail(function(){that.error404()})}});(function(broker){var UrlistAction=actions.Action.extend({events:{"add-contributor":"addContributor","remove-contributor":"removeContributor"},addContributor:function(target,payload){var contributorModel=new model.Contributor({user_id:payload.user_id,status:"pending"},{parse:true}),contributors=new ul.model.Urlist({hash:target.list_hash}).get("contributors");contributors.add(contributorModel)},removeContributor:function(target,payload){var contributorModel=new model.Contributor({user_id:payload.user_id}),contributors=new ul.model.Urlist({hash:target.list_hash}).get("contributors");contributors.remove(contributorModel)}});var urlistAction=new UrlistAction(broker);urlistAction.bindToBroker()})(UL.Broker);(function(broker){var UserActions=actions.Action.extend({events:{"add-list":"addList","remove-list":"removeList","follow-user":"followUser","unfollow-user":"unfollowUser","follow-list":"followList","unfollow-list":"unfollowList","update-profile":"updateProfile","accept-contrib-request":"acceptContribRequest","decline-contrib-request":"declineContribRequest"},addList:function(target,payload,deferred,extras){deferred.done(function(payload){var listModel,user=C.get("user");if(payload.is_secret)user.inc("secret_lists_left",-1);listModel=new ul.model.Urlist(payload,{parse:true});listModel.set("__is_new",true);user.get("lists").add(listModel,{at:0});if(extras.gotoList)UL.Router.navigate("/{0}".format(listModel.get("hash")),{trigger:true})})},removeList:function(target,payload){var listModel=new ul.model.Urlist({hash:target.list_hash});delete Backbone.Pool["models.Urlist:{0}".format(listModel.get("hash"))];C.get("user").get("lists").remove(listModel);listModel.destroy()},followUser:function(target,payload,deferred,extras){var user=new model.User({user_id:target.user_id}),myself=new model.User({user_id:C.get("user").get("user_id")}),profile=extras?new model.Profile({username:extras.username}):null,following=C.get("user").get("following_users");if(profile)profile.whenReady().done(function(){profile.set("following",true);profile.get("followed_by_users").add(myself)});following.add(user)},unfollowUser:function(target,payload,deferred,extras){var user=new model.User({user_id:target.user_id}),myself=new model.User({user_id:C.get("user").get("user_id")}),profile=new model.Profile({username:extras.username}),following=C.get("user").get("following_users");profile.set("following",true);profile.get("followed_by_users").remove(myself);following.remove(user)},followList:function(target){var urlist=new ul.model.Urlist({hash:target.list_hash}),myself=new model.User({user_id:C.get("user").get("user_id")}),followed=C.get("user").get("followed_lists");urlist.whenReady().done(function(){urlist.set("following",true);urlist.inc("followers_amount");urlist.get("followers").add(myself);followed.add(urlist)})},unfollowList:function(target){var urlist=new ul.model.Urlist({hash:target.list_hash}),myself=new model.User({user_id:C.get("user").get("user_id")}),followed=C.get("user").get("followed_lists");urlist.set("following",false);urlist.inc("followers_amount",-1);urlist.get("followers").remove(myself);followed.remove(urlist)},updateProfile:function(target,payload){C.get("user").set(payload);var me=new model.Profile({username:C.get("user").get("username")});me.set(payload)},acceptContribRequest:function(target){var notifications=C.get("notifications").get("notifications"),user=C.get("user"),request=_.find(notifications,function(n){return n.data&&n.data.notification_id==target.notification_id}),urlistModel=request&&new ul.model.Urlist({hash:request.data.list_hash});if(urlistModel)urlistModel.whenReady().done(function(){contrib=urlistModel.get("contributors").get(user.get("user_id"));user.get("lists").unshift(urlistModel);contrib.set("status","accepted")});request.status="accepted"},declineContribRequest:function(target){var notifications=C.get("notifications").get("notifications"),user=C.get("user"),request=_.find(notifications,function(n){return n.data&&n.data.notification_id==target.notification_id}),urlistModel=request&&new ul.model.Urlist({hash:request.data.list_hash});if(urlistModel)urlistModel.whenReady().done(function(){urlistModel.get("contributors").remove(user.get("user_id"))});request.status="declined"}});var userAction=new UserActions(broker);userAction.bindToBroker()})(UL.Broker);(function(broker){var UrlistAction=actions.Action.extend({events:{"update-sections":"updateSections","add-section":"addSection","remove-section":"removeSection"},updateSections:function(target,payload){var listModel=new ul.model.Urlist({hash:target.list_hash}),sections=listModel.get("sections");_.each(payload.sections,function(s){var sectionModel=sections.get(s.section_id);if(!sectionModel){sectionModel=new model.Section(s,{urlist:listModel,urls:listModel.get("urls"),sections:sections});sections.add(sectionModel)}else{sectionModel.set(s)}})},addSection:function(target,payload,deferred){var listModel=new ul.model.Urlist({hash:target.list_hash}),sections=listModel.get("sections"),sectionModel=new model.Section(_.extend(payload,{position:sections.length+1}),{urlist:listModel,urls:listModel.get("urls"),sections:sections});sections.add(sectionModel);deferred.done(function(payload){sectionModel.set(payload)})},removeSection:function(target){var listModel=new ul.model.Urlist({hash:target.list_hash}),section=listModel.get("sections").where({section_id:target.section_id})[0],urls=section.getLocalUrls();_.each(urls,function(url){url.destroy()});section.destroy()}});var urlistAction=new UrlistAction(broker);urlistAction.bindToBroker()})(UL.Broker);(function(broker){var MyAction=actions.Action.extend({events:{"add-list":"addList","add-url":"addUrl"},addList:function(target,payload,deferred){deferred.done(function(payload){console.log("[MyAction] add-list",payload.hash)})},addUrl:function(target,payload,deferred){deferred.done(function(payload){console.log("[MyAction] add-url",target.list_hash,payload.hash)})}});var myAction=new MyAction(broker)})(UL.Broker);(function(broker){var UrlistAction=actions.Action.extend({events:{"view-list":"viewList","update-list":"updateList","update-list-cover":"updateListCover","update-categories":"updateCategories","add-url":"addUrl","remove-url":"removeUrl","update-url":"updateUrl","fetch-url-data":"fetchUrlData","check-list":"checkList","move-url":"moveUrl","relist-url":"relistUrl","add-comment":"addComment","remove-comment":"removeComment","move-url-to-another-list":"moveUrlToAnotherList"},moveUrlToAnotherList:function(target,payload,deferred,extras){deferred.done(function(returnedData){var urls=new ul.model.Urlist({hash:target.from_list.list_hash}).get("urls");var urlModel=urls.where({hash:target.from_list.url_hash})[0];var toUrlist=new ul.model.Urlist({hash:target.to_list.list_hash});var targetListCollection=toUrlist.get("urls");targetListCollection.add(urlModel);urls.remove(urlModel);urlModel.set(returnedData)})},viewList:function(urlistModel){urlistModel.set("last_visit",(new Date).toUTCISOString())},updateList:function(target,payload,deferred){var listModel=new ul.model.Urlist({hash:target.list_hash});listModel.set(payload)},updateListCover:function(target,payload){var listModel=new ul.model.Urlist({hash:target.list_hash});listModel.whenReady().done(function(){listModel.set("cover_image",payload.cover_image)})},updateCategories:function(target,payload,deferred){var listModel=new ul.model.Urlist({hash:target.list_hash});listModel.set("categories",payload.categories);deferred.done(function(){view.utils.displayAlert("Changes saved","confirm")})},addUrl:function(target,payload,deferred){var urlist=new ul.model.Urlist({hash:target.list_hash}),urls=urlist.get("urls"),position=payload.position||1,urlModel;payload._status="load";payload.list_hash=target.list_hash;urlModel=new ul.model.Url(payload,{parse:true,collection:urls});urls.add(urlModel,{at:position-1,merge:true});deferred.done(function(payload){payload=_.purge(payload,null);delete payload.position;urlModel.set(payload);urlModel.set("_status","ok")}).fail(function(payload){urlModel.destroy();if(payload=="UrlExists"){view.utils.displayAlert("That link is already in the list!")}else{view.utils.displayAlert("Something went wrong! Are you sure it was a link? Try again","error")}})},fetchUrlData:function(target,payload,deferred){var list,urls,url;list=new ul.model.Urlist({hash:target.list_hash});if(!list.isReady())return;urls=list.get("urls");url=urls.where({hash:target.url_hash})[0]||urls.where({__request_id:requestId})[0];deferred.done(function(payload){url.set(payload)})},updateUrl:function(target,payload,deferred){var urls=new ul.model.Urlist({hash:target.list_hash}).get("urls"),url=urls.where({hash:target.url_hash})[0];url.set(payload)},moveUrl:function(target,payload){var urls=new ul.model.Urlist({hash:target.list_hash}).get("urls"),url=urls.where({hash:target.url_hash})[0],position=payload.position;url.set(payload);urls.move(url,position-1)},removeUrl:function(target){var urls=new ul.model.Urlist({hash:target.list_hash}).get("urls"),url=urls.where({hash:target.url_hash})[0];url.destroy()},checkList:function(target,payload,deferred){var urlistModel=new ul.model.Urlist({hash:target.list_hash});console.debug("[actions.urlist]	","List {0} is {1}ms old, checking".format(urlistModel.id,urlistModel.age()));deferred.done(function(payload){urlistModel.age(true);if(!_.isEmpty(payload)){console.debug("[actions.urlist]	","Got new data for list",urlistModel.id);urlistModel.set(urlistModel.parse(payload));UL.Router.list(urlistModel,true)}else{console.debug("[actions.urlist]	","List {0} is updated".format(urlistModel.id))}})},relistUrl:function(target,payload,deferred){deferred.done(function(){var that=this;var fromUrlistModel=new ul.model.Urlist({hash:payload.from_list_hash});fromUrlistModel.whenReady().done(function(){var fromUrlModel=fromUrlistModel.get("urls").where({hash:payload.from_url_hash})[0];fromUrlModel.inc("relist_amount")})})}});var urlistAction=new UrlistAction(broker);urlistAction.bindToBroker()})(UL.Broker);(function(broker){var DashboardAction=actions.Action.extend({events:{"add-saved-search":"addSearch","remove-saved-search":"removeSearch"},addSearch:function(target,payload,deferred){var query=payload.query;deferred.done(function(payload){var searchModel=new model.SavedSearch({search_id:payload.search_id,query:query}),searchesCollection=C.get("user").get("saved_searches");searchesCollection.add(searchModel);view.utils.displayAlert("Search saved!","info")})},removeSearch:function(target,payload){var searchModel=new model.SavedSearch({search_id:target.search_id});searchModel.destroy()}});var dashboardAction=new DashboardAction(broker);dashboardAction.bindToBroker()})(UL.Broker);(function(broker){var MyAction=actions.Action.extend({events:{all:"log"},log:function(){console.log("EVENT",arguments)}});var myAction=new MyAction(broker)})(UL.Broker);(function(broker){var OnboardingActions=actions.Action.extend({events:{"app-ready":"appReady"},appReady:function(target){var user=C.get("user"),followList;if(user.isAnonymous())return;followList=$.cookie("_ul_follow_list");$.removeCookie("_ul_follow_list");
if(followList)UL.Broker.push("follow-list",{list_hash:followList})}});var onboardingActions=new OnboardingActions(broker);onboardingActions.bindToBroker()})(UL.Broker);(function(broker){var MyAction=actions.Action.extend({events:{"update-list":"updateList","view-list":"viewList","view-url":"viewUrl"},updateList:function(target,payload,deferred){var listModel;listModel=new ul.model.Urlist({hash:target.list_hash});deferred.done(function(data){if(data.slug)UL.Router.navigate("/"+data.slug,{replace:true})})},viewList:function(listModel){var params=window.location.href.split("?")[1];listModel.whenReady().done(function(){var url="/{0}".format(listModel.get("slug"));if(params)url=[url,params].join("?");UL.Router.navigate(url,{replace:true})})},viewUrl:function(listModel,urlModel){var params=window.location.href.split("?")[1];listModel.whenReady().done(function(){var url="/{0}/{1}".format(listModel.get("slug"),urlModel.get("slug"));if(params)url=[url,params].join("?");UL.Router.navigate(url,{replace:true})})}});var myAction=new MyAction(broker);myAction.bindToBroker()})(UL.Broker);(function(broker){var listsToTest="".split(","),anonCounter={},anonLimit=2;var Notifications=actions.Action.extend({events:{"view-list":"viewList","view-url":"viewUrl","view-discovery":"viewDiscovery"},viewUrl:function(urlistModel){var hash=urlistModel.get("hash");if(!C.get("user").isAnonymous()||listsToTest.indexOf(hash)==-1)return;if(!anonCounter[hash])anonCounter[hash]=0;anonCounter[hash]++;if(anonCounter[hash]==anonLimit){ul.dialog.signup({aggressive:true,closeOnOverlay:false,closeOnKey:false,source:"blocking_dialog",listHash:hash});mixpanel.track("TEST:blocking_dialog",{hash:hash})}},viewList:function(target){var listModel=new ul.model.Urlist({hash:target.get("hash")});listModel.whenReady().done(function(){var dialog;if(listModel.toJoin()){new view.message.AskToJoin({model:listModel}).render()}else if(listModel.toCategorize()){if(listModel.get("__is_new")){listModel.unset("__is_new");dialog=new view.dialog.SelectCategory({skipAnimation:true,model:listModel});dialog.render()}else{ul.view.util.displayMessage(ul.util.t("messages/add_category")(listModel.toJSON()))}}})}});var notifications=new Notifications(broker);notifications.bindToBroker()})(UL.Broker);(function(broker){var StartActions=actions.Action.extend({events:{"app-ready":"appReady"},appReady:function(target){var user=C.get("user");if(user.isAnonymous())return;if(user.get("pending_onboarding"))return;var listHash=$.cookie("_ul_suggest_list_hash"),url=$.cookie("_ul_suggest_url"),description=$.cookie("_ul_suggest_description"),sectionId=$.cookie("_ul_suggest_section_id"),doneMsg=function(){view.utils.displayAlert("Thanks for making this list even more awesome!")},failError=function(){view.utils.displayAlert("Ouch, there was error, please suggest the link again.","error")};$.removeCookie("_ul_suggest_list_hash");$.removeCookie("_ul_suggest_url");$.removeCookie("_ul_suggest_description");$.removeCookie("_ul_suggest_section_id");if(!url||!listHash){setTimeout(function(){var goodbye='<div class="message message-alert is--error">Urlist will be discontinued on Dec 31, <a href="https://medium.com/@vrde/epilogue-18698396094" target="_blank">learn more</a><div class="button-group"><a href="/goodbye" class="button small action">download your data</a><a href="#" class="button-close js-message-close">&times;</a></div> </div>';ul.view.util.displayMessage(goodbye)},1e3);return}UL.Broker.push("suggest-url",{list_hash:listHash},{url:url,description:description}).done(doneMsg).fail(failError)}});var startActions=new StartActions(broker);startActions.bindToBroker()})(UL.Broker);(function(broker){var TRACK=window.CONFIG.mixpanel.track;if(!TRACK)return;var MyAction=actions.Action.extend({events:{"profile-loaded":"profileLoaded","global-search":"globalSearch","local-search":"localSearch","view-landing":"viewLanding","start-onboarding":"startOnboarding","view-list":"viewList","view-url":"viewUrl","view-discovery":"viewDiscovery","add-list":"addList","add-url":"addUrl","relist-url":"relistUrl","add-comment":"addComment","add-contributor":"addContributor","suggest-url":"suggestUrl","suggested-url-accept":"acceptSuggestedUrl","suggested-url-decline":"declineSuggestedUrl","share-list":"shareList","share-url":"shareUrl","follow-user":"followUser","unfollow-user":"unfollowUser","follow-list":"followList","unfollow-list":"unfollowList","view-profile":"viewProfile","update-profile":"updateProfile","update-categories":"updateCategories","update-list-cover":"updateListCover","accept-contrib-request":"acceptContribRequest","decline-contrib-request":"declineContribRequest","preboarding-slide":"preboardingSlide","preboarding-submit":"preboardingSubmit"},profileLoaded:function(profile){var u=profile.toJSON(),signupSource;if(u.__notrack&&!window.CONFIG.mixpanel.force_all){console.log("disable mixpanel");mixpanel.disable();return}if(window.CONFIG.mixpanel.debug)mixpanel.set_config({debug:true});mixpanel.unregister("is_anonymous");mixpanel.identify(u.origin_id||u.user_id);mixpanel.register_once({ab_group:profile.ABGroup()});mixpanel.name_tag("{0} - {1}".format(u.username,u.email));if(u.is_anonymous){mixpanel.register_once({is_anonymous:true})}else{mixpanel.people.set(_.purge({$name:u.screen_name,$email:u.email,$created:u.creation_time,profile:"http://urli.st/library/"+u.username,links:u.links_amount,lists:u.lists_amount,location:u.location,google:u.google_username,facebook:"https://www.facebook.com/"+u.facebook_username,twitter:"https://twitter.com/"+u.twitter_username}))}if(u.welcome){var source=$.cookie("_ul_signup_source");$.removeCookie("_ul_signup_source");mixpanel.track("User:signup",_.purge({source:source},null))}},globalSearch:function(query){mixpanel.track("Search:global",{query:query})},localSearch:function(query){mixpanel.track("Search:local",{query:query})},viewLanding:function(){mixpanel.track("Landing:view")},startOnboarding:function(){if(C.get("user").isNewbie())mixpanel.track("Onboarding:start")},viewList:function(urlistModel,originator){urlistModel.whenReady().done(function(){var properties={is_owner:urlistModel.isMine()};_.extend(properties,originator);mixpanel.track("List:view",properties)})},viewUrl:function(urlistModel){urlistModel.whenReady().done(function(){mixpanel.track("Url:view",{is_owner:urlistModel.isMine()})})},viewDiscovery:function(){mixpanel.track("Discovery:view")},addList:function(target,payload,deferred,extras,originator){var properties={list_index:C.get("user").getListsByMe().length,is_secret:payload.is_secret};_.extend(properties,originator);mixpanel.track("List:new",properties)},addUrl:function(target,payload,deferred,extras){var urlist=new ul.model.Urlist({hash:target.list_hash}),d={source:_.get(extras,"source"),is_owner:urlist.isMine()};_.extend(d,extras);mixpanel.track("Url:add",d)},moveUrlToAnotherList:function(target,payload,deferred){deferred.done(function(){mixpanel.track("Url:move_to_another_list")})},relistUrl:function(target,payload,deferred,extras,originator){deferred.done(function(){var toUrlistModel=new ul.model.Urlist({hash:target.list_hash}),fromUrlistModel=new ul.model.Urlist({hash:payload.from_list_hash});toUrlistModel.whenReady().done(function(){fromUrlistModel.whenReady().done(function(){var properties={from_is_owner:fromUrlistModel.isMine(),to_is_owner:toUrlistModel.isMine()};_.extend(properties,originator);mixpanel.track("Url:relist",properties)})})})},addComment:function(target,payload,deferred){var urlistModel=new ul.model.Urlist({hash:target.list_hash});mixpanel.track("List:comment_add",{is_owner:urlistModel.isMine()})},addContributor:function(target,payload){var urlistModel=new ul.model.Urlist({hash:target.list_hash});mixpanel.track("List:contributor_add",{is_owner:urlistModel.isMine()})},suggestUrl:function(target){mixpanel.track("List:suggest_url")},acceptSuggestedUrl:function(target){mixpanel.track("List:suggested_url_accept")},declineSuggestedUrl:function(target){mixpanel.track("List:suggested_url_decline")},shareList:function(target,payload,deferred,extras){var urlistModel=new ul.model.Urlist({hash:target.list_hash});mixpanel.track("List:share",{is_owner:urlistModel.isMine(),channel:extras.channel,source:extras.source})},shareUrl:function(target,payload,deferred,extras){var urlistModel=new ul.model.Urlist({hash:target.list_hash});mixpanel.track("Url:share",{is_owner:urlistModel.isMine(),channel:extras.channel,source:extras.source})},followUser:function(target,x,x,x,originator){mixpanel.track("User:follow",originator)},unfollowUser:function(target,x,x,x,originator){mixpanel.track("User:unfollow",originator)},followList:function(target,x,x,x,originator){var urlist=new ul.model.Urlist({hash:target.list_hash});urlist.whenReady().done(function(){var properties={links:urlist.get("urls").length,people:urlist.get("contributors").length};_.extend(properties,originator);mixpanel.track("List:follow",properties)})},unfollowList:function(target,x,x,x,originator){var urlist=new ul.model.Urlist({hash:target.list_hash});urlist.whenReady().done(function(){var properties={links:urlist.get("urls").length,people:urlist.get("contributors").length};_.extend(properties,originator);mixpanel.track("List:unfollow",properties)})},viewProfile:function(profileModel,originator){var properties={is_owner:profileModel.isMine()};_.extend(properties,originator);mixpanel.track("Profile:view",properties)},updateProfile:function(target,payload){mixpanel.track("User:update_profile")},updateCategories:function(target){mixpanel.track("List:update_categories")},updateListCover:function(target){mixpanel.track("List:update_cover")},acceptContribRequest:function(target){mixpanel.track("List:contrib_accept")},declineContribRequest:function(target){mixpanel.track("List:contrib_decline")},preboardingSlide:function(slideId){mixpanel.track("Preboarding:slide",{slide:slideId})},preboardingSubmit:function(title){mixpanel.track("Preboarding:submit")}});var myAction=new MyAction(broker);myAction.bindToBroker()})(UL.Broker);(function(broker){var TRACK=window.CONFIG.ga.track;if(!TRACK)return;var MyAction=actions.Action.extend({events:{"profile-loaded":"profileLoaded","view-list":"viewList","view-url":"viewUrl","add-list":"addList","add-url":"addUrl","app-ready":"pageView","page-view":"pageView"},profileLoaded:function(profile){var u=profile.toJSON();if(u.__notrack&&!window.CONFIG.ga.force_all){console.log("disable google analytics");window._gaq=[]}_gaq.push(["_setCustomVar",1,"user-status",u.is_anonymous?"anonymous":"registered",2]);if(u.welcome){_gaq.push(["_trackEvent","user","signup"])}},viewList:function(){_gaq.push(["_trackEvent","list","view"])},viewUrl:function(){_gaq.push(["_trackEvent","url","view"])},addList:function(){_gaq.push(["_trackEvent","list","new"])},addUrl:function(){_gaq.push(["_trackEvent","url","add"])},pageView:function(){if(window.location.pathname=="/"){if(C.get("user").get("is_anonymous")){_gaq.push(["_trackPageview","/?page=landing"])}else{_gaq.push(["_trackPageview","/?page=network"])}}else{_gaq.push(["_trackPageview"])}}});var myAction=new MyAction(broker);myAction.bindToBroker()})(UL.Broker);(function(broker){var Tracker=function(source){this.source=source;this.active=true};_.extend(Tracker.prototype,{t:function(tracker,d){if(!this.active)return;d.source=this.source;d.tracker=tracker;$.ajax({url:API_ROOT+"tracker",type:"POST",data:JSON.stringify(_.purge(d)),contentType:"application/json",dataType:"json",xhrFields:{withCredentials:true}})},disable:function(){this.active=false}});var ut=new Tracker("web");UT=ut;var TRACK=CONFIG.ut.track;if(!TRACK)return;var MyAction=actions.Action.extend({events:{"profile-loaded":"profileLoaded","global-search":"globalSearch","local-search":"localSearch","app-ready":"pageView","page-view":"pageView","view-list":"viewList","view-url":"viewUrl","view-discovery":"viewDiscovery","add-list":"addList","add-url":"addUrl","relist-url":"relistUrl","add-contributor":"addContributor","suggest-url":"suggestUrl","suggested-url-accept":"acceptSuggestedUrl","suggested-url-decline":"declineSuggestedUrl","share-list":"shareList","share-url":"shareUrl","follow-user":"followUser","unfollow-user":"unfollowUser","follow-list":"followList","unfollow-list":"unfollowList","view-profile":"viewProfile","update-profile":"updateProfile","update-categories":"updateCategories","update-list-cover":"updateListCover","accept-contrib-request":"acceptContribRequest","decline-contrib-request":"declineContribRequest","preboarding-submit":"preboardingSubmit"},profileLoaded:function(profile){var u=profile.toJSON();if(u.welcome)ut.t("signup",{model:"user"});else ut.t("new_session",{model:"user"})},globalSearch:function(query){ut.t("global_search",{model:"search",target:query})},localSearch:function(query){ut.t("local_search",{model:"search",target:query})},pageView:function(){ut.t("view",{model:"page",target:window.location.href})},viewList:function(urlistModel,originator){ut.t("view",{model:"list",target:urlistModel.get("hash")})},viewUrl:function(urlistModel,urlHash){ut.t("view",{model:"url",target:[urlistModel.get("hash"),urlHash.get("hash")].join("/")})},viewDiscovery:function(){ut.t("view",{model:"site",target:"discovery"})},addList:function(target,payload,deferred,extras,originator){deferred.done(function(data){ut.t("new",{model:"list",target:data.hash})})},addUrl:function(target,payload,deferred,extras){deferred.done(function(data){ut.t("add",{model:"url",target:[target.list_hash,data.hash].join("/")})})},relistUrl:function(target,payload,deferred,extras,originator){ut.t("relist",{model:"list",target:target.list_hash,payload:{from_list_hash:payload.from_list_hash}})},addContributor:function(target,payload){ut.t("add_contributor",{model:"list",target:target.list_hash,payload:{user_id:payload.user_id}})},suggestUrl:function(target,payload){ut.t("suggest_url",{model:"list",target:target.list_hash,payload:{url:payload.url,description:payload.description}})},acceptSuggestedUrl:function(target){ut.t("suggested_url_accept",{model:"list",target:target.list_hash})},declineSuggestedUrl:function(target){ut.t("suggested_url_decline",{model:"list",target:target.list_hash})},shareList:function(target,payload,deferred,extras){ut.t("share",{model:"list",target:target.list_hash,payload:{channel:extras.channel,source:extras.source}})},shareUrl:function(target,payload,deferred,extras){ut.t("share",{model:"url",target:target.list_hash,payload:{channel:extras.channel,source:extras.source}})},followUser:function(target,x,x,x,originator){ut.t("follow_user",{model:"user",target:target.user_id})},unfollowUser:function(target,x,x,x,originator){ut.t("unfollow_user",{model:"user",target:target.user_id})},followList:function(target,x,x,x,originator){ut.t("follow_list",{model:"list",target:target.list_hash})},unfollowList:function(target,x,x,x,originator){ut.t("unfollow_list",{model:"list",target:target.list_hash})},viewProfile:function(profileModel,originator){profileModel.whenReady().done(function(){ut.t("view",{model:"user",target:profileModel.get("user_id")})})},updateProfile:function(target,payload){ut.t("update",{model:"user"})},updateCategories:function(target){ut.t("update_categories",{model:"list",target:target.list_hash})},updateListCover:function(target){ut.t("update_cover",{model:"list",target:target.list_hash})},acceptContribRequest:function(target){ut.t("contrib_accept",{model:"list",target:target.list_hash})},declineContribRequest:function(target){ut.t("contrib_decline",{model:"list",target:target.list_hash})},preboardingSubmit:function(title){ut.t("preboarding",{model:"user",title:title})}});var myAction=new MyAction(broker);myAction.bindToBroker()})(UL.Broker);(function(){helpers.generatePolicy=function(subset,user,obj){var r={},p=policies[subset];for(var name in p)r[name]=p[name](user,obj);return r}})();(function(){function isAdmin(){return C.get("user").get("__notrack")}function isAuthor(user,urlist){return urlist.get("author").get("user_id")===user.get("user_id")}function isContributor(user,urlist){return urlist.get("contributors")!==undefined&&urlist.get("contributors").where({user_id:user.get("user_id"),status:"accepted"}).length==1}var funcs={addUrl:function(user,urlist){return isAuthor(user,urlist)||isContributor(user,urlist)},acceptUrl:function(user,urlist){return isAuthor(user,urlist)||isContributor(user,urlist)},relistUrl:function(user,urlist){return!urlist.get("is_secret")},contribute:function(user,urlist){return isAuthor(user,urlist)||isContributor(user,urlist)},addSection:function(user,urlist){return isAuthor(user,urlist)||isContributor(user,urlist)},addContributor:function(user,urlist){return isAuthor(user,urlist)||isContributor(user,urlist)},removeContributor:function(user,urlist){return isAuthor(user,urlist)||isContributor(user,urlist)},addComment:function(user,urlist){return true},removeComment:function(user,urlist){return isAuthor(user,urlist)},editList:function(user,urlist){return isAuthor(user,urlist)||isAdmin(user)},updateCover:function(user,urlist){return isAuthor(user,urlist)||isAdmin(user)},sortList:function(user,urlist){return isAuthor(user,urlist)||isContributor(user,urlist)},shareUrl:function(user,urlist){return!urlist.get("is_secret")},shareList:function(user,urlist){return!urlist.get("is_secret")},editUrl:function(user,urlist){return isAuthor(user,urlist)||isContributor(user,urlist)},removeUrl:function(user,urlist){return isAuthor(user,urlist)||isContributor(user,urlist)},followList:function(user,urlist){return!isAuthor(user,urlist)}};_.extend(policies,{urlist:{contribute:funcs.contribute,add_url:funcs.addUrl,accept_url:funcs.acceptUrl,relist_url:funcs.relistUrl,add_section:funcs.addSection,add_contributor:funcs.addContributor,add_comment:funcs.addComment,remove_comment:funcs.removeComment,edit_list:funcs.editList,update_cover:funcs.updateCover,sort_list:funcs.sortList,share_url:funcs.shareUrl,share_list:funcs.shareList,edit_url:funcs.editUrl,remove_url:funcs.removeUrl,follow_list:funcs.followList}})})();main.Main=ul.bbext.View.extend({name:"main.Main",events:{"click .js-login":"loginCallback","click .js-signup":"signupCallback","click .js-signup-sticky":"signupStickyCallback","click .js-learn-more":"signupCallback","click .js-recover-password":"recoverPasswordCallback","click .js-noop":"noop","click .js-switch-multiple-master":"switchMultipleMaster","click .js-leave-feedback":"feedbackCallback","click .js-navigate":"navigate","click .js-new-list":"newListCallback","click .js-open-dialog[data-dialog='select-category']":"categoryDialogCallback",click:"mainDispatcherClear","click .js-toggle-menu":"mainDispatcherGet","click .js-scrolltop":"scrollToTop"},initialize:function(){this.user=this.options.user;this.setupNotifications()},render:function(){var $html=$(ul.util.t("layout/main")());this.$el.html($html);var header=new view.Header({el:$("#header"),model:this.user});header.render();$(document).tooltip();return this.$el},start:function(){this.router=new router.Main;UL.Router=this.router;Backbone.history.start({pushState:true})},navigate:function(e){var $anchor=$(e.target).closest("a"),href=$anchor.attr("href"),source=e.getSource();UL.EventOriginator.push(source);this.router.navigate(href,{trigger:true});UL.Broker.trigger("page-view");return false},loginCallback:function(e){ul.dialog.login();return false},signupCallback:function(e){ul.dialog.signup();return false},signupStickyCallback:function(e){ul.dialog.signup({onboarding:true,closeOnOverlay:false,closeOnKey:false});return false},recoverPasswordCallback:function(e){var recoverView=new view.dialog.RecoverPassword;recoverView.render();return false},switchMultipleMaster:function(e){var newMaster=$(e.target).attr("data-mode");console.log("Switching to",newMaster);$.cookie("ul.config.branch",newMaster);window.location.href="/"},feedbackCallback:function(e){var feedbackView=new view.dialog.Feedback;feedbackView.render()},newListCallback:function(e){if(ul.dialog.requireSignup())return false;e.preventDefault();var dialog=new view.dialog.NewList({model:C.get("user"),closeOnOverlay:false,gotoList:true,sourceEvent:e});dialog.render()},noop:function(){return false},categoryDialogCallback:function(e){e.preventDefault();var listModel=new ul.model.Urlist({hash:$(e.target).attr("data-hash")});listModel.whenReady().done(function(){var dialog=new view.dialog.SelectCategory({model:listModel});dialog.render()})},mainDispatcherClear:function(e){var target=$(e.target);if($(e.target).hasClass("dropdown")||$(e.target).hasClass("dropup")||$(e.target).parents(".dropdown, .dropup").length){}else{$(".dropdown.is--active").removeClass("is--active");$(".dropup.is--active").removeClass("is--active")}if(!(target.hasClass("js-search-delete")||target.hasClass("search_cta-list")||target.parents(".search_cta-list").length||target.hasClass("saved-searches")||target.parents(".saved-searches").length||this.$(".js-search-input").is(":focus"))){this.$(".search_cta-list").removeClass("show");this.$(".js-search-input").removeClass("focused")}},mainDispatcherGet:function(e){var $thisMenu=$(e.target).closest("a").siblings(".dropdown, .dropup").toggleClass("is--active");$(".dropdown, .dropup").not($thisMenu).removeClass("is--active");e.preventDefault();e.stopPropagation()},toggleBox:function(e){$(e.target).closest(".js-toggle").toggleClass("js-switch");return false},scrollToTop:function(e){e.preventDefault();$("html, body").animate({scrollTop:0},"250")},setupNotifications:function(){C.set("notifications",new model.Notifications);if(!this.user.get("is_anonymous")){C.get("notifications").fetch();setInterval('C.get("notifications").fetch()',3e4)}}});main.Onboarding=ul.bbext.View.extend({name:"main.Onboarding",events:{"click .js-login":"loginCallback","click .js-signup":"signupCallback"},loginCallback:function(e){ul.dialog.login();return false},signupCallback:function(e){ul.dialog.signup();return false},render:function(){var $html=$(ul.util.t("layout/onboarding")()),onboardingView=new view.Onboarding({el:$html.find("#content"),model:this.options.user});this.$el.html($html);onboardingView.render();return this.$el},start:function(){}});main.Bookmarklet=ul.bbext.View.extend({name:"main.Bookmarklet",events:{"click .js-login":"loginCallback","click .js-signup":"signupCallback","click .js-recover-password":"recoverPasswordCallback","keyup textarea[data-count='chars']":"countChars"},loginCallback:function(e){ul.dialog.login();return false},signupCallback:function(e){ul.dialog.signup();return false},recoverPasswordCallback:function(e){var recoverView=new view.dialog.RecoverPassword;recoverView.render();return false},initialize:function(){this.user=this.options.user;this.model=new ul.bbext.Model({title:getLocationParameter("title","No title"),url:getLocationParameter("url")});$("body").addClass("bookmarklet")},render:function(){var $html=$(ul.util.t("layout/bookmarklet")()),bookmarkletView=new view.Bookmarklet({el:$html.find("#content"),model:this.model});this.$el.html($html);bookmarkletView.render();ul.dialog.requireLogin({onlySubmit:true});return this.$el},start:function(){},navigate:function(e){var href=$(e.target).closest("a").attr("href");this.router.navigate(href,{trigger:true});return false},countChars:function(e){var $me=$(e.target),limitChars=parseInt($me.attr("data-count-limit")),usedChars=$me.val().length,totChars=limitChars-usedChars,charsCounter=$("#"+$me.attr("rel"));charsCounter.html(totChars);totChars<0?charsCounter.addClass("alert-text"):charsCounter.removeClass("alert-text")}});$(function(){if(typeof APPLICATION==="undefined"){APPLICATION="Main"}APPLICATION=getLocationParameter("ul.config.application",APPLICATION);function boot(user,App){C.set("user",user);UL.Broker.trigger("profile-loaded",profile);var application=new App({el:"#urlist-content",user:user});application.render();application.start();UL.Broker.trigger("app-ready")}function shouldOnboard(profile){return profile.get("pending_onboarding")===true}function checkBeta(user){var eligible=user.get("__beta")===true,isAdmin=user.get("__notrack"),cookieSet=$.cookie("ul.config.branch")=="beta",dialog;if(cookieSet&&!isAdmin){$.removeCookie("ul.config.branch","beta");window.location="/"}}var profile=new model.Profile({user_id:"~?t="+Math.random()}),App=main[APPLICATION];profile.whenReady().done(function(){Backbone.Pool["model.Profile:"+profile.get("username")]=profile;checkBeta(profile);if(shouldOnboard(profile))boot(profile,main["Onboarding"]);else boot(profile,App)}).fail(function(){$("html").append(ul.util.t("layout/error"));console.error("Error loading current user")})});
